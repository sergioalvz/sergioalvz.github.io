<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0.preview.7">
<meta name="author" content="Sergio Álvarez Suárez">
<title>Geolocalización de usuarios en medios sociales mediante análisis de contenidos</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden], template { display: none; }
script { display: none !important; }
html { font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a { background: transparent; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }
meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }
meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
.keyseq kbd:first-child { margin-left: 0; }
.keyseq kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }
b.button:before { content: "["; padding: 0 3px 0 2px; }
b.button:after { content: "]"; padding: 0 2px 0 3px; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock pre:not([class]), .listingblock pre:not([class]) { background: none; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }
.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 0.75em 0.75em 0.5em 0.75em; }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
tbody tr th { display: table-cell; line-height: 1.6; background: whitesmoke; }
tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
#toc.toc2 { background: white; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }
</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Geolocalización de usuarios en medios sociales mediante análisis de contenidos</h1>
<span id="author" class="author">Sergio Álvarez Suárez</span><br>
<div id="toc" class="toc">
<div id="toctitle">Tabla de Contenidos</div>
<ul class="sectlevel1">
<li><a href="#_resumen">Resumen</a></li>
<li><a href="#_agradecimientos">Agradecimientos</a></li>
<li><a href="#_palabras_clave">Palabras clave</a></li>
<li><a href="#_introducción">1. Introducción</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_motivación_del_proyecto">1.1. Motivación del proyecto</a></li>
<li><a href="#_alcance">1.2. Alcance</a></li>
<li><a href="#_estado_del_arte">1.3. Estado del arte</a></li>
</ul>
</li>
<li><a href="#_algoritmos_y_aspectos_teóricos">2. Algoritmos y aspectos teóricos</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_visión_general_del_sistema">2.1. Visión general del sistema</a></li>
<li><a href="#_log_likelihood_ratio_test">2.2. Log Likelihood-Ratio test</a></li>
<li><a href="#_términos_discriminativos">2.3. Términos discriminativos</a></li>
<li><a href="#_pseudocódigo_para_ilustrar_el_proceso_completo_de_análisis_de_tuits">2.4. Pseudocódigo para ilustrar el proceso completo de análisis de tuits</a></li>
<li><a href="#_procesando_xml_con_em_pull_parsing_em">2.5. Procesando XML con <em>pull parsing</em></a></li>
<li><a href="#_entrenamiento_del_clasificador">2.6. Entrenamiento del clasificador</a></li>
</ul>
</li>
<li><a href="#_experimentos_y_resultados">3. Experimentos y resultados</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_primeros_experimentos_trabajando_con_grandes_volúmenes_de_datos">3.1. Primeros experimentos: trabajando con grandes volúmenes de datos</a></li>
<li><a href="#_trabajando_con_diferentes_niveles_de_granularidad">3.2. Trabajando con diferentes niveles de granularidad</a></li>
</ul>
</li>
<li><a href="#_conclusiones_y_trabajo_futuro_sobre_el_sistema_de_geolocalización">4. Conclusiones y trabajo futuro sobre el sistema de geolocalización</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_trabajo_futuro">4.1. Trabajo futuro</a></li>
</ul>
</li>
<li><a href="#_aplicación_web_de_geolocalización_como_servicio">5. Aplicación web de geolocalización como servicio</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_análisis_del_sistema">5.1. Análisis del sistema</a></li>
<li><a href="#_diseño_del_sistema">5.2. Diseño del sistema</a></li>
<li><a href="#_planificación_y_presupuesto">5.3. Planificación y presupuesto</a></li>
</ul>
</li>
<li><a href="#_herramientas_utilizadas_durante_el_desarrollo_del_proyecto">6. Herramientas utilizadas durante el desarrollo del Proyecto</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_trello">6.1. Trello</a></li>
<li><a href="#_omnigraffle_y_balsamiq_mockup">6.2. OmniGraffle y Balsamiq Mockup</a></li>
<li><a href="#_desarrollo_de_la_documentación_utilizando_asciidoc">6.3. Desarrollo de la documentación utilizando AsciiDoc</a></li>
</ul>
</li>
<li><a href="#_conclusiones_del_proyecto">7. Conclusiones del Proyecto</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_ampliaciones_y_trabajo_futuro">7.1. Ampliaciones y trabajo futuro</a></li>
</ul>
</li>
<li><a href="#_scala">Appendix A: Scala</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_sbt">sbt</a></li>
</ul>
</li>
<li><a href="#_git">Appendix B: Git</a></li>
<li><a href="#_software_de_aprendizaje_automático_y_vowpal_wabbit">Appendix C: Software de aprendizaje automático y Vowpal Wabbit</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_software_de_aprendizaje_automático">Software de aprendizaje automático</a></li>
<li><a href="#_vowpal_wabbit">Vowpal Wabbit</a></li>
</ul>
</li>
<li><a href="#_falcon_sistema_para_coleccionar_datos_de_la_api_streaming_de_twitter">Appendix D: Falcon, sistema para coleccionar datos de la API Streaming de Twitter</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_almacenamiento_de_datos">Almacenamiento de datos</a></li>
<li><a href="#_parámetros_del_sistema">Parámetros del sistema</a></li>
<li><a href="#_ejemplo_de_resultados">Ejemplo de resultados</a></li>
</ul>
</li>
<li><a href="#_b2pick_aplicación_web_para_seleccionar_bounding_boxes">Appendix E: B2pick, aplicación web para seleccionar Bounding Boxes</a></li>
<li><a href="#_tweetheat_mapas_de_calor_sobre_ficheros_tsv_de_puntuación">Appendix F: TweetHeat, mapas de calor sobre ficheros TSV de puntuación</a></li>
<li><a href="#_código_fuente_de_los_prototipos_y_em_scripts_em_desarrollados">Appendix G: Código fuente de los prototipos y <em>scripts</em> desarrollados</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_falcon">Falcon</a></li>
<li><a href="#_puma_sistema_de_análisis">Puma (sistema de análisis)</a></li>
<li><a href="#__em_scripts_em_de_utilidad"><em>Scripts</em> de utilidad</a></li>
<li><a href="#_vowpal_wabbit_input_translator">Vowpal Wabbit Input Translator</a></li>
<li><a href="#_b2pick">B2pick</a></li>
<li><a href="#_tweetheat">Tweetheat</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_resumen">Resumen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El presente proyecto recoge la implementación de un sistema capaz de inferir la localización de un usuario a través de sus publicaciones en Twitter combinando métodos estadísticos y aprendizaje automático.</p>
</div>
<div class="paragraph">
<p>Para demostrar su efectividad, se han realizado experimentos a distintos niveles de granularidad (país, provincia, área metropolitana y barrio) y con dos idiomas diferentes (inglés y español). El algoritmo ha mostrado niveles de precisión bastante altos (prácticamente siempre superiores al 90%) y un grado de exhaustividad (especialmente para las granularidades de más alto nivel) muy aceptable, identificando aproximadamente un 70% ~ 80% del total de tuits locales recibidos.</p>
</div>
<div class="paragraph">
<p>Para realizar el desarrollo del sistema, el proyecto ha hecho uso de métodos estadísticos como Log-Likelihood Ratio y el software de aprendizaje automático Vowpal Wabbit.</p>
</div>
<div class="paragraph">
<p>Por último, el proyecto recoge el diseño de una aplicación web que utilizaría la tecnología previamente desarrollada para ofrecer un servicio de geolocalización de publicaciones en redes sociales (en este caso, centrado únicamente en Twitter) mediante análisis de contenidos.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agradecimientos">Agradecimientos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Me gustaría dar las gracias, en primer lugar, a mi familia, mis padres, mi hermana y mi novia por el apoyo incondicional que me han brindado durante estos últimos meses para ser capaz de finalizar con éxito mi Trabajo Fin de Máster.</p>
</div>
<div class="paragraph">
<p>También quisiera agradecer a Daniel Gayo Avello, director del proyecto, su ayuda constante durante todo el proceso de creación y desarrollo del proyecto así como su disponibilidad y paciencia para aportar soluciones a todas aquellas dificultades que me pude ir encontrando durante el transcurso del mismo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_palabras_clave">Palabras clave</h2>
<div class="sectionbody">
<div class="paragraph">
<p>twitter, log likelihood ratio test, vowpal wabbit, palabras indicativas de posición, scala, geolocalización, play framework</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introducción">1. Introducción</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_motivación_del_proyecto">1.1. Motivación del proyecto</h3>
<div class="paragraph">
<p>El crecimiento exponencial de las redes sociales durante los últimos años ha despertado un gran interés en los diferentes ámbitos de la informática, siendo un claro objetivo comercial para profesionales del sector, así como un nuevo campo de investigación para los investigadores universitarios.</p>
</div>
<div class="paragraph">
<p>Como consecuencia de todo ello, durante los últimos años han ido apareciendo diversas aplicaciones que, de una u otra manera, se centran en estudiar ciertos aspectos de las redes sociales para poder extraer información acerca de sus usuarios gracias a las diversas publicaciones que estos mismos realizan en sus perfiles.</p>
</div>
<div class="paragraph">
<p>El estudio de la geolocalización de un usuario a partir del contenido publicado por él mismo, sin embargo, es una de las pocas áreas que <em>tan sólo</em> agrupa un pequeño número de estudios, pero en donde no han proliferado herramientas que comprueben de manera empírica los resultados obtenidos por diversos investigadores.</p>
</div>
<div class="paragraph">
<p>La motivación de este proyecto, por tanto, es crear un sistema basado en las investigaciones previas, que permita inferir la geolocalización de un usuario mediante el análisis del contenido de sus publicaciones en Twitter y demostrar empíricamente si las soluciones propuestas pueden ser aceptadas como válidas.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alcance">1.2. Alcance</h3>
<div class="paragraph">
<p>El objetivo principal del proyecto es desarrollar un sistema capaz de inferir la geolocalización de un usuario en base al estudio de sus publicaciones en Twitter. Para ello, se implementará una solución basada en los estudios llevados a cabo por diversos investigadores (tanto universitarios como empresariales) a lo largo de los últimos años.</p>
</div>
<div class="paragraph">
<p>El sistema deberá ser capaz de trabajar sobre diversas granularidades (país, provincia, área metropolitana y barrio) y utilizar tuits escritos en diversos idiomas (como mínimo, deberá funcionar satisfactoriamente con inglés y español). Para inferir la gelocalización de un tuit se basará únicamente en el contenido de la publicación, evitando la comunicación con sistemas de geolocalización externos y siendo capaz de detectar términos discriminativos que ayuden a identificar un tuit como perteneciente a un área geográfica en concreto.</p>
</div>
<div class="paragraph">
<p>Finalmente, el proyecto deberá plantear un sistema que pueda ser integrable en una aplicación web que se aproveche de sus capacidades para ofrecer un servicio de geolocalización de tuits basado en su contenido.</p>
</div>
</div>
<div class="sect2">
<h3 id="_estado_del_arte">1.3. Estado del arte</h3>
<div class="paragraph">
<p>Desde la aparición de Twitter en 2006 y su irrupción como servicio de masas en torno al año 2008, han ido apareciendo de manera exponencial diferentes servicios y vías de investigación centradas en estudiar el comportamiento de los usuarios en la red social en base a sus publicaciones, con el objetivo de poder extraer conclusiones acerca de su tendencia política, opiniones personales y otras características individuales.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Twitter</div>
<div class="paragraph">
<p>Twitter es una red social (también clasificada como servicio de <em>microblogging</em>) creada en 2006 por Jack Dorsey. Su principal característica es el envío de <em>posts</em> de 140 caracteres por parte de los usuarios y la capacidad de que estos mismos formen su propio <em>timeline</em> suscribiéndose a las publicaciones realizadas por el resto de usuarios.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sin embargo, un problema habitual a la hora de trabajar con datos extraídos de Twitter es su falta de estructuración. Si bien es habitual que los usuarios en redes sociales como Facebook mantengan un perfil completo y actualizado con datos reales (en parte gracias al buen hacer de dicha red social por conseguir que así sea), en Twitter lo más habitual es carecer de dicha información. Por tanto, muchos de los esfuerzos realizados en el análisis de contenidos en Twitter vienen para cubrir esa necesidad de obtener información real acerca de los usuarios que realizan las publicaciones.</p>
</div>
<div class="paragraph">
<p>Por poner un ejemplo, la figura <a href="#fb-profile">Captura del perfil del autor en Facebook</a> muestra una captura del perfil del autor en Facebook. En ella, se puede observar como aparece una gran cantidad de información perfectamente estructurada: centros de estudio, lugar de nacimiento, lugar de residencia actual, fecha de nacimiento, sexo e incluso campos que, aunque en este caso no estén completos, podrían aportar muchísima más información sobre el usuario: relación sentimental, ideología política o religiosa, etc.</p>
</div>
<div id="fb-profile" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/introduction/fb_profile.png" alt="fb profile">
</div>
<div class="title">Figure 1. Captura del perfil del autor en Facebook</div>
</div>
<div class="paragraph">
<p>Sin embargo, los perfiles en Twitter son mucho más limitados. Por utilizar el mismo símil, en <a href="#twitter-profile">Captura del perfil del autor en Twitter</a> se muestra una captura del perfil del autor en Twitter. Como se puede observar, en este caso tan sólo se muestra una pequeña biografía en la que el usuario aprovecha para reflejar su perfil más profesional.</p>
</div>
<div id="twitter-profile" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/introduction/twitter_profile.png" alt="twitter profile" height="200px">
</div>
<div class="title">Figure 2. Captura del perfil del autor en Twitter</div>
</div>
<div class="paragraph">
<p>En el caso de la geolocalización de usuarios, Bren Hercht <em>et al.</em> en su artículo <strong>Tweets from Justin Bieber’s Heart: The Dynamics of the "Location" Field in User Profiles</strong>, centrado en estudiar el campo de <strong>Localización</strong> de los perfiles de usuario, realiza la siguiente afirmación acerca de la cantidad de tuits geoposicionados (es decir, con información geográfica adjunta como latitud y longitud) que contenían en su dataset de ejemplo:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>First, our focus is on the geographic information revealed in the “location” field of user profiles, a type of geographic information that is prevalent across the Web 2.0 world. <strong>Second, we found that only 0.77% of our 62 million tweets contained this embedded location information</strong>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>De 62 millones de tuits, únicamente un 0.77% (~= 477.400) contenían información geográfica adjunta. Como se puede deducir de esta afirmación, el problema para geolocalizar usuarios en Twitter es real y su solución sería de gran interés para poder contribuir a un mejor estudio de las publicaciones de los usuarios en la red social, obteniendo la capacidad de situarlos en un espacio geográfico concreto.</p>
</div>
<div class="paragraph">
<p>A continuación, se recogen una serie de artículos de investigación que abordan la problemática anterior y proponen mecanismos para inferir la localización de un usuario en base al contenido de sus publicaciones.</p>
</div>
<div class="sect3">
<h4 id="_estudios_y_artículos_de_investigación">1.3.1. Estudios y artículos de investigación</h4>
<div class="paragraph">
<p>Se pueden encontrar varias tendencias en la investigación de la geolocalización de los tuits y usuarios de Twitter. Por un lado, existen investigadores que basan sus estudios en encontrar términos o entidades con significado geográfico propio, que se puedan cotejar con un <em>gazetteer</em> con el objetivo de poder identificar nombres de lugares o coordenadas geográficas, intuyendo que aquellas que más veces aparezcan en el <em>timeline</em> del usuario son aquellas más próximas a su localización real.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Timeline de Twitter</div>
<div class="paragraph">
<p>El timeline de un usuario en Twitter se puede entender como la vista principal del usuario en la que puede observar, en tiempo real, las publicaciones realizadas por aquellos usuarios a los que está suscrito (o a los que <em>sigue</em>, si se prefiere utilizar la terminología propuesta por Twitter).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Por otro lado, grupos de investigadores han optado por estudiar únicamente el contenido de un tuit con el objetivo de encontrar aquellas palabras más características de un lugar y que puedan ser lo suficientemente discriminativas. En estos casos, se suele tender a buscar aquellos términos con una alta frecuencia y una baja dispersión geográfica.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Gazetteer</div>
<div class="paragraph">
<p>Un gazetteer (o <strong>nomenclátor</strong> en español) es un diccionario geográfico que contiene los nombres de varias localizaciones geográficas referentes a un lugar. Por lo general, es habitual disponer de gazetteers a nivel de país para indicar el conjunto de sus ciudades, comunidades autónomas o provincias. Así como para casi cualquier otra unidad administrativa.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Existen también enfoques donde se ha optado por una estrategia basada en estudiar el comportamiento de un usuario, utilizando técnicas de los dos métodos anteriores y combinándola con la información obtenida a través de servicios de terceros que puedan realizar publicaciones en el <em>timeline</em> del usuario y además adjuntar información geolocalizada (<strong>Foursquare</strong> sería un claro ejemplo de este tipo de servicios).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Foursquare</div>
<div class="paragraph">
<p>Foursquare es una aplicación desarrollada originalmente para dispositivos móviles, que funciona en parte con las características propias de cualquier red social, permitiendo a cada usuario publicar su ubicación actual al resto de sus contactos. A diferencia de otras redes sociales más generales (como Facebook o Twitter), Foursquare tiene como objetivo compartir localizaciones concretas que tienen adjunta información geográfica. Su explosión como servicio se basó en su interoperabilidad con el resto de servicios como Facebook, Twitter o Google+ permitiendo que las publicaciones en Foursquare se pueden observar desde el resto de redes sociales del usuario.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_tweets_from_justin_bieber_s_heart_the_dynamics_of_the_location_field_in_user_profiles">Tweets from Justin Bieber’s Heart: The Dynamics of the "Location" Field in User Profiles</h5>
<div class="paragraph">
<p><em>Por Brent Hecht et al. Northwestern University y Palo Alto Research Center</em></p>
</div>
<div class="paragraph">
<p>El estudio liderado por Brent Hecht demuestra como el uso del campo de Localización disponible en los perfiles de los usuarios en Twitter no es un indicador válido para obtener su posición geográfica real.</p>
</div>
<div class="paragraph">
<p>Entre los datos obtenidos por Brent y su equipo se pueden destacar los siguientes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sólo un 66% de los usuarios utiliza el campo de Localización para aportar información geográfica válida (es decir, localizaciones reales pero que <strong>no tienen porqué indicar su situación real</strong>. Por ejemplo, si una persona de <strong>Oviedo</strong> escribe <strong>California</strong> en el campo de Localización de su perfil, este estudio lo incluye dentro del 66% anterior).</p>
</li>
<li>
<p>Algunos de los usos que los usuarios dentro del 34% restante aplican al campo de Localización se puede observar en <a href="#location-use-type">Tipos de uso del campo de Localización por parte de los usuarios de Twitter</a>.</p>
</li>
<li>
<p>La manera de distinguir entre localización real y ficticia supuso de un proceso manual en el que dos miembros del equipo debieron revisar tuit a tuit el campo de Localización, debido a la habilidad de los usuarios para poder expresar sarcasmo o ironía, así como expresiones comunes que pueden tener asociado un componente geográfico inherente (un ejemplo puede ser referirse al Principado de Asturias como <em>la tierrina</em>).</p>
</li>
</ol>
</div>
<table id="location-use-type" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 1. Tipos de uso del campo de Localización por parte de los usuarios de Twitter</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cultura popular</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.9%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Referencias a su propia privacidad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insultos o contenido violento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Localizaciones no terráqueas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emociones negativas hacia su localización real</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Naturaleza sexual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Como alternativa a los resultados anteriores, y buscando una manera de automatizar el proceso y encontrar resultados más fiables y exhaustivos, se propusieron hacer un primer experimento para comprobar si el estudio de los contenidos publicados por un usuario pueden aportar la información necesaria para permitir inferir su ubicación geográfica.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Clasificador Bayesiano</div>
<div class="paragraph">
<p>De manera simplificada, se podría definir un <strong>clasificador Bayesiano</strong> como un clasificador probabilístico basado en el teorema de Bayes, que permite trabajar con una serie de características de manera independiente, sin asumir que la ausencia o presencia de cada una influya en el valor que se otorga a las demás para calcular la predicción final.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para ello, utilizaron un software de aprendizaje automático y un <strong>clasificador Bayesiano</strong> multinomial que en base a un conjunto de datos obtenidos a partir de aplicar el algoritmo <em>CALGARI</em> (de implementación propia), fuese capaz de predecir a qué área (País y Estado) pertenece un tuit en base a su contenido.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CALGARI</div>
<div class="paragraph">
<p>El algoritmo CALGARI tiene como objetivo normalizar la frecuencia con la que un término ha aparecido dentro de un dataset de tuits para priorizar aquellos que son más específicas de un área (ciudad o estado) en concreto, penalizando palabras comunes como <em>ya, hola, adiós, etc.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Entre los resultados ofrecidos por el estudio destacan un <strong>72.7% de precisión para inferir el país</strong> de un usuario pero tan <strong>sólo un 30% de precisión a nivel de estado</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_where_is_this_tweet_from_inferring_home_locations_of_twitter_users">Where Is This Tweet From? Inferring Home Locations of Twitter Users</h5>
<div class="paragraph">
<p><em>Por Jalal Mahmud et al. IBM Research</em></p>
</div>
<div class="paragraph">
<p>Con el objetivo de poder identificar un tuit a diferentes granularidades: ciudad o estado, el estudio plantea la posibilidad de analizar tres tipos de términos diferentes para localizar una publicación en Twitter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Palabras</strong></p>
</li>
<li>
<p><strong>Hashtags</strong></p>
</li>
<li>
<p><strong>Nombres de lugares</strong> (utilizando un gazetteer geográfico). Puesto que estos términos podía estar compuestos por más de una palabra, se utilizaron bigramas y trigamas, así como un heurístico especializado en reconocer nombres de lugares expresados mediante vocabulario común (un ejemplo sería <em>Red Sox</em> para referirse a la ciudad de Boston).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Hashtag</div>
<div class="paragraph">
<p>Un hashtag es un término que comienza con el literal <code>#</code> y sirve para categorizar el contenido de un tuit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Es interesante observar como empiezan a aparecer pequeñas diferencias entre términos, considerando que en función de su categoría, pueden ofrecer más o menos información geográfica. Esta misma estrategia será también utilizada en el presente proyecto, mediante la extracción de Hashtags, Menciones y N-gramas.</p>
</div>
<div class="paragraph">
<p>Con el objetivo de minimizar la aparición de ruido, normalizaron el contenido de cada tuit eliminando signos de puntuación (a excepción de aquellos que indican una entidad propia cuando se encuentran al principio de una palabra, como <code>#</code> para indicar <em>hashtags</em>) y palabras vacías.</p>
</div>
<div class="paragraph">
<p>También se hace mención a la utilización de un <strong>software de aprendizaje automático</strong>, en este caso WEKA, y su conjunción con un modelo estadístico que realice los cálculos necesarios para el clasificador. El modelo que seleccionaron de manera empírica fue un clasificador Bayesiano multinomial.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">WEKA</div>
<div class="paragraph">
<p>WEKA es una implementación de software de aprendizaje automático realizada en Java por la Universidad de Waikato en Nueva Zelanda. Es uno de los sistemas más utilizados debido a su soporte para aplicar un gran número de algoritmos de aprendizaje automático.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La estrategia propuesta en este trabajo para inferir la localización de un usuario en Twitter fue:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A lo largo de sus tuits, mencionará más veces su ciudad o estado de origen que el resto de ciudades o estados.</p>
</li>
<li>
<p>Visitará más lugares de su ciudad o estado de origen que del resto de ciudades o estados (para detectar este tipo de visitas, se guardan todas las URLs generadas a partir de <em>check-ins</em> compartidos a través de <strong>Foursquare</strong> para luego comprobar su información asociada a través de la propia API de Foursquare).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A partir de estas premisas y de las decisiones anteriores, se crearon 3 modelos diferentes para poder entrenar sobre cada uno de los términos que se quieren extraer: palabras, hashtags y nombres de lugares. Los resultados presentados a nivel de ciudad no fueron realmente positivos, y sólo presentan niveles de precisión superiores al 70% cuando se permiten márgenes de error superiores a 200 millas (~= 322 kilómetros).</p>
</div>
<div class="paragraph">
<p>Por último, no se especifica con exactitud cómo actúa realmente el algoritmo cuando se trabaja con usuarios que no tienen contenido generado por Foursquare o no hacen una referencia explícita a su ciudad, estado o país.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tweolocator_a_non_intrusive_geographical_locator_system_for_twitter">TweoLocator: A Non-Intrusive Geographical Locator System for Twitter</h5>
<div class="paragraph">
<p><em>Por Yi-Shin Chen et al. National Tsing Hua University</em></p>
</div>
<div class="paragraph">
<p>En este estudio, Yi-Shin Chen diseña un sistema que a través de diferentes etapas y aglutinando varios procesos es capaz de inferir la localización de un usuario en Twitter en función del contenido de sus tuits.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Clasificación base</dt>
<dd>
<p>A partir de un gran dataset de usuarios de Twitter, en esta fase se realiza un análisis para comprobar qué perfiles puede ser potencialmente válidos para realizar un análisis de contenidos, eliminando aquellos que puedan pertenecer a <em>bots</em> automáticos o sean perfiles de spam. Una vez se obtiene una masa de usuarios válidos se procede, dentro aún de esta etapa, a analizar todos sus tuits (a excepción de aquellos con información de geolocalización asociada) para volver a categorizarlos en 3 tipos:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Direct subject</strong>: Tuits que hacen referencia al usuario en primera persona.</p>
</li>
<li>
<p><strong>Anonymous subject</strong>: Tuits que no hacen una referencia directa al usuario, pero utilizan otros pronombres personales o la primera secuencia de palabras es un verbo que no es una palabra vacía.</p>
</li>
<li>
<p><strong>Others</strong>: Tuits descartados por no pertenecer a ninguna de las 2 categorías anteriores.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Generación de reglas</dt>
<dd>
<p>Una vez todos los tuits anteriores han sido analizados semánticamente se realiza una normalización de los mismos aplicando técnicas de análisis de texto (utilizando un tokenizador y un stemmer) para luego poder formar n-gramas como los mismos. Durante esta etapa, se intentan inferir reglas que permitan asociar términos comunes a localizaciones específicas como aeropuertos, parques, estaciones de tren, etc.</p>
</dd>
<dt class="hdlist1">Descubrimiento de localizaciones</dt>
<dd>
<p>A partir de los términos de cada tuit, se generan trigramas, bigramas y unigramas y se comparan sobre un gazetteer y las reglas generadas en el paso anterior, obteniendo localizaciones que se pueden agrupar en:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Explicit Specific</strong>: Nombres que hacen una referencia directa a una ciudad o lugar determinado, como por ejemplo «The White House» o «Los Ángeles».</p>
</li>
<li>
<p><strong>Explicit</strong>: Nombres que hacen referencia a localizaciones generales como parques o gimnasios.</p>
</li>
<li>
<p><strong>Implicit</strong>: Combinaciones de palabras que implícitamente sugieren una localización. Estos resultaos se obtienen a partir de las reglas generadas en el paso anterior.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Eliminación de topónimos</dt>
<dd>
<p>Mediante la utilización de un clúster, y partiendo de la premisa de que un usuario nombrará con mayor frecuencia lugares cercanos a su lugar de origen, en esta fase se analizan las menciones realizadas por el usuario sobre ciudades, lugares, países y se refinarán los datos para obtener su lugar de origen.</p>
</dd>
<dt class="hdlist1">Ordenación temporal</dt>
<dd>
<p>Es el último paso en el refinamiento de los datos. En esta fase se intenta minimizar la aparición de ruido detectando aquellas ocasiones en las que el usuario hace referencia a una localización geográfica sin aportar una información real acerca de su posición. Por ejemplo, es habitual que alguien situado en Asturias pueda nombrar la ciudad de Nueva York para hablar de alguna noticia o para mostrar sus ganas por conocer la ciudad, sin que esa mención indique que se encuentre realmente allí. Para resolver este problema, y aceptando que en algunos casos sólo se podrían resolver dichas inconsistencias de manera manual mediante la intervención humana, se diseñó un sistema que a partir de dos tuits con contenido geolocalizado consecutivos (del mismo usuario) compruebe si su diferencia en el tiempo es acorde a la posibilidad de haberse movido entre ambos puntos a una velocidad normal de transporte.</p>
</dd>
<dt class="hdlist1">Localización inferida</dt>
<dd>
<p>De acuerdo a los resultados obtenidos en todas las fases anteriores y de acuerdo al nivel sobre que el que se haya podido inferir su localización, los usuarios son clasificados en los siguientes grupos:</p>
<div class="ulist">
<ul>
<li>
<p><strong>No information</strong>: Si no se ha podido obtener información geográfica válida para inferir la localización del usuario.</p>
</li>
<li>
<p><strong>Just country</strong>: Si sólo se ha podido inferir el país del usuario.</p>
</li>
<li>
<p><strong>Timeline</strong>: Se han podido detectar ubicaciones actuales y previas del usuario, pero no su lugar de origen.</p>
</li>
<li>
<p><strong>Hometown</strong>: Se han podido detectar ubicaciones actuales y previas del usuario y <strong>también</strong> su lugar de origen. Es el grupo con información más completa.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>En las conclusiones que se exponen en el artículo se muestran unos resultados bastante aceptables, donde hay porcentajes de precisión cercanos al 80%. Al igual que en el caso anterior, TweoLocator tiene una gran dependencia de que los usuarios incluyan en el contenido de sus tuits información explícitamente geolocalizable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_a_multi_indicator_approach_for_geolocalization_of_tweets">A Multi-Indicator Approach for Geolocalization of Tweets</h5>
<div class="paragraph">
<p><em>Por Axel Schulz et al. SAP Research</em></p>
</div>
<div class="paragraph">
<p>En este artículo, un equipo de investigación de <strong>SAP AG</strong> presenta un enfoque muy interesante para inferir la localización de un usuario mediante la utilización de formas poligonales en 3D. Los polígonos se superponen, y la intersección de mayor altura es el área con más probabilidades de contener al usuario analizado.</p>
</div>
<div class="paragraph">
<p>La altura de cada polígono viene determinada por pesos específicos que se aplican en función de la fuente utilizada para obtener esa localización. Cada fuente tiene sus propios estándares de calidad y sus propias métricas para indicar más o menos fiabilidad.</p>
</div>
<div class="paragraph">
<p>Para obtener las coordenadas o posiciones geográficas que deben ocupar los polígonos, los investigadores extraen información de los siguientes campos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Contenido del tuit</dt>
<dd>
<p>Se optó por utilizar <strong>DBPedia Spotlight</strong> para extraer las entidades que existían en el tuit. Con los resultados de la extracción, se seleccionaban únicamente aquellas que tenían coordenadas asociadas. Además, se utilizó como calidad de cada predicción la propia confianza aportada por DBPedia Spotlight en su resultado. También se utilizaron las publicaciones realizadas a través de servicios como Foursquare, Flickr o Ubisoft, las cuales tienen adjunta información geográfica precisa mediante la utilización de coordenadas geográficas.</p>
</dd>
<dt class="hdlist1">Localización</dt>
<dd>
<p>Se hizo uso de gazetteers que permitiesen buscar coincidencias textuales en el campo de Localización. Además, se volvió a utilizar DBPedia Spotlight para conseguir trabajar con expresiones comunes como «La gran manzana» y expresiones regulares para detectar si algún usuario incluía coordenadas geográficas directamente en su campo de Localización.</p>
</dd>
<dt class="hdlist1">Web del usuario</dt>
<dd>
<p>Para aquellos usuarios que añaden en su perfil su página web personal se aplican dos estrategias:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extraer el dominio de la página (.com, .es, etc).</p>
</li>
<li>
<p>Utilizar la dirección IP y obtener las coordenadas a través del servicio IPInfoDB.</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Zona horaria</dt>
<dd>
<p>Se asume como cierto que la zona horaria asociada al usuario es la capital de su país de origen.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Los resultados de este estudio presentan mejorías respecto a otras investigaciones basadas en inferir la localidad de un usuario mediante el uso de <strong>múltiples indicadores</strong> con un 37% de precisión con una distancia de error de 10km y un 48% para 25km; así como un 54% cuando el margen se amplía a 50km.</p>
</div>
</div>
<div class="sect4">
<h5 id="_inferring_the_origin_locations_of_tweets_with_quantitative_confidence">Inferring the Origin Locations of Tweets with Quantitative Confidence</h5>
<div class="paragraph">
<p><em>Por Reid Priedhorsky et al. Los Alamos National Laboratory y Northeastern Illinois University</em></p>
</div>
<div class="paragraph">
<p>El artículo parte de la premisa de que no es posible obtener la localización de un tuit con una exactitud total, sino que lo más acertado es ofrecer un modelo probabilístico que muestre las diferentes localizaciones a las que un tuit puede pertenecer asociadas a un grado de confianza (probabilidad).</p>
</div>
<div class="paragraph">
<p>Para obtener un dataset de entrenamiento, se utilizó la API Streaming de Twitter para después realizar un procesamiento de cada tuit extrayendo información de los campos: descripción del usuario, idioma del perfil seleccionado, campo de localización, zona horaria y contenido del tuit. Sobre esta información, se extrajeron bigramas para todos los términos adyacentes (a excepción del campo de zona horaria). Además, también se almacenó la información geográfica adjunta al tuit para poder realizar los experimentos y el entrenamiento del modelo.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Twitter Streaming API</div>
<div class="paragraph">
<p>Conjunto de APIs ofrecidas por Twitter que permiten acceder al streaming real de tuits que gestiona la aplicación. Se ofrecen 3 tipos de streaming en función del contenido que se desee analizar:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stream público</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ofrece un 1% del total de tuits públicos gestionados por la aplicación. Se suele utilizar principalmente para tareas de <em>data mining</em> donde no se requiere establecer ningún filtro en concreto en base a ningún usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stream de usuarios</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permite obtener información en tiempo real acerca de los eventos recibidos por un único usuario de Twitter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stream de <em>Sites</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ofrece la capacidad de obtener información en tiempo real de los eventos recibidos por un conjunto de usuarios. Está pensado para aplicación web o móviles que requieren monitorizar la actividad en Twitter de un conjunto de sus usuarios.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La página web de documentación en Twitter acerca de las APIs de Streaming contiene una mayor información acerca de sus capacidades y la manera de interactuar con ellas: <a href="https://dev.twitter.com/docs/api/streaming">https://dev.twitter.com/docs/api/streaming</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez con toda esta información almacenada, se utilizó una técnica de estimación denominada «gaussian mixture models» en donde cada bigrama que aparezca más de un mínimo número de veces se asocia a las coordenadas del tuit que lo contiene. Cada asociación va vinculada a un peso específico en función del bigrama y la suma de todos los pesos relativos a un mismo tuit resulta en la probabilidad total de que pertenezca a dichas coordenadas.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Gaussian mixture models</div>
<div class="paragraph">
<p>Un modelo Gaussiano mixto es un modelo probabilístico que asume que todos sus datos fueron generados a partir de la unión de un número finito de distribuciones Gaussianas con parámetros desconocidos.</p>
</div>
<div class="paragraph">
<p>— <a href="http://scikit-learn.org/stable/modules/mixture.html">http://scikit-learn.org/stable/modules/mixture.html</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para calcular el peso total de un tuit a partir del peso de cada bigrama, el equipo de Reid Priedhorsky desarrolló tres métodos diferentes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Peso por propiedades de calidad</dt>
<dd>
<p>Se realiza la suma de todos los pesos asignados para cada bigrama y se utiliza su total como el total del tuit.</p>
</dd>
<dt class="hdlist1">Peso por error inverso</dt>
<dd>
<p>Se calcula el error de cada bigrama utilizando el conjunto de datos de entrenamiento y se realiza la suma de todos los errores obtenidos. Después, se aplica el inverso sobre el error total, para obtener un valor que implique que cuanto mayor sea el error, menor sea el peso del tuit.</p>
</dd>
<dt class="hdlist1">Peso por optimización</dt>
<dd>
<p>Aprovechando los dos casos anteriores, se plantea una nueva característica que pueda aportar el peso a cada bigrama utilizando la información que pueden dar tanto sus propiedades de calidad como su valor de error sobre el error total. De esta manera, se calcularía un nuevo valor para cada bigrama que, en conjunto con el del resto de bigramas que componen el tuit, resultaría en el peso total para dicho tuit.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Todos los algoritmos anteriores contienen una alta dosis de componente matemático.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">N-Grama</div>
<div class="paragraph">
<p>En este contexto, un n-grama es una combinación de <strong>n</strong> palabras contenidas en un tuit. A lo largo del proyecto se hará referencia a dos tipos de n-gramas: <strong>unigramas</strong> (combinaciones de 1 palabra) y <strong>bigramas</strong> (combinaciones de 2 palabras).</p>
</div>
<div class="paragraph">
<p>Un ejemplo de la extracción de bigramas sobre el contenido de un tuit sería:</p>
</div>
<div class="paragraph">
<p>«Obviamente todo esto se hace para acabar con la costumbre de nuestra infancia de los álbumes de cromos.»</p>
</div>
<div class="paragraph">
<p>Que se traduciría a:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Obviamente todo, todo esto, esto se, se hace,
hace para, para acabar, acabar con, con la,
la costumbre, costumbre de, de nuestra, nuestra infancia,
infancia de, de los, los álbumes, álbumes de, de cromos</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los resultados del estudio revelaron un precisión del 83% para aquellos tuits que contenían bigramas con contenido explícitamente localizable (nombres de lugares) frente a un 57% de precisión sobre tuits sin información geográfica.</p>
</div>
</div>
<div class="sect4">
<h5 id="_you_are_where_you_tweet_a_content_based_approach_to_geo_locating_twitter_users">You Are Where You Tweet: A Content-Based Approach to Geo-locating Twitter Users</h5>
<div class="paragraph">
<p><em>Por Zhiyuan Cheng et al. Texas A&amp;M University</em></p>
</div>
<div class="paragraph">
<p>En este estudio, Zhiyuan Cheng y su equipo aportan datos interesantes en la investigación de la geolocalización en Twitter. Centrados en buscar un algoritmo capaz de inferir la localización de un usuario <strong>únicamente</strong> con el contenido de sus tuits, establecen tres criterios que serán ampliamente utilizados por el resto de investigaciones posteriores:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se deben buscar términos con un fuerte componente discriminativo mediante la aplicación de algoritmos que sirvan para normalizar la frecuencia de apariciones de un término.</p>
</li>
<li>
<p>El test Likelihood Ratio es capaz de obtener puntuaciones bastante acertadas para este dominio específico.</p>
</li>
<li>
<p>Los términos más altamente discriminativos se caracterizan por una alta frecuencia y una baja dispersión.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Likelihood Ratio test</div>
<div class="paragraph">
<p>El test Likelihood-Ratio es un método estadístico ampliamente utilizado en problemas donde se pretenden comparar dos conjuntos de datos a través de una serie de supuestos. En <a href="#_log_likelihood_ratio_test">Log Likelihood-Ratio test</a> se exponen de manera detallada sus principales características y su aplicación en el proyecto actual.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Entre los resultados que presentaron, afirman ser capaces de localizar correctamente el 51% de los tuits dentro de un radio de error de 100 millas (~= 161 km.).</p>
</div>
</div>
<div class="sect4">
<h5 id="_otros_artículos_de_interés">Otros artículos de interés</h5>
<div class="paragraph">
<p>Los artículos anteriores han sido seleccionados como los más representativos de las principales vías de investigación para inferir la localización de un usuario en redes sociales en base al contenido de sus publicaciones. A continuación, se enumeran otros artículos de interés que pueden ayudar a conocer vías alternativas sobre las investigaciones propuestas así como nuevos resultados.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Location Type Classification Using Tweet Content</strong> <em>por Haibin Liu et al. The Pennsylvania State University</em></p>
</li>
<li>
<p><strong>TweetLocalize: Inferring Author Location in Social Media</strong> <em>por Evan Sparks et al. University of California-Berkeley</em></p>
</li>
<li>
<p><strong>Inferring the Location of Twitter Messages Based on User Relationships</strong> <em>por Clodoveu A. Davis Jr. et al. Universidade Federal de Minas Gerais</em></p>
</li>
<li>
<p><strong>Geolocation Prediction in Social Media Data by Finding Location Indicative Words</strong> <em>por HAN Bo et al. University of Melbourne</em></p>
</li>
<li>
<p><strong>Home Location Identification of Twitter Users</strong> <em>por Jalal Mahmud et al. IBM Research</em></p>
</li>
<li>
<p><strong>Geotagging One Hundred Million Twitter Accounts with Total Variation Minimization</strong> <em>por Ryan Compton et al. HRL Laboratories (Malibu)</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_algoritmos_y_aspectos_teóricos">2. Algoritmos y aspectos teóricos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Las siguientes secciones explican en profundidad los conceptos teóricos clave que se utilizan a lo largo del proyecto. Además, se hace un análisis detallado de los algoritmos aplicados para obtener términos discriminativos y su posterior comunicación con el software de aprendizaje automático.</p>
</div>
<div class="sect2">
<h3 id="_visión_general_del_sistema">2.1. Visión general del sistema</h3>
<div class="paragraph">
<p>Antes de empezar a detallar los conceptos y algoritmos utilizados a lo largo de todo el proceso, esta sección pretende dar una visión general acerca de los pasos que se deberán realizar en el proyecto para la identificación de términos discriminativos y la posterior ejecución de un modelo de aprendizaje automático que permita inferir la geolocalización de una publicación en Twitter.</p>
</div>
<div class="paragraph">
<p>El primer paso, será la identificación de términos discriminativos. Para ello, se utilizará una implementación del método estadístico Log Likelihood Ratio, el cual nos devolverá la puntuación para cada término indicando si pertenecen al conjunto de datos local (es decir, que sea lo suficientemente discriminativo para poder ser etiquetado como perteneciente al área de interés). Esta fase devolverá un conjunto de términos que podrán ayudar a inferir la localización de un tuit en base a los términos que contiene. Para la identificación de términos, será necesario trabajar con dos conjuntos de tuits con características diferentes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Un conjunto de tuits para un área global que utilice el mismo lenguaje que el área local que se quiere analizar.</p>
</li>
<li>
<p>Un conjunto de tuits para el área local sobre el que se quiere realizar el análisis.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/theoretical-aspects/overview/identify-terms.png" alt="identify terms">
</div>
<div class="title">Figure 3. Visión simplificada del proceso de identificación de términos discriminativos</div>
</div>
<div class="paragraph">
<p>Una vez se ha conseguido extraer el conjunto de términos discriminativos y su puntuación obtenida de aplicar el método Log Likehood Ratio, se deberá trabajar con un nuevo conjunto de tuits con coordenadas geográficas adjuntas que permita crear el modelo de entrenamiento para el software de aprendizaje automático. En <a href="#training-vw-process">Flujo de trabajo para procesar los datos y entrenar al clasificador automático</a> se ilustra el proceso necesario para calcular la puntuación de cada tuit y desarrollar el modelo de entrenamiento en base a la división de los resultados en conjuntos de entrenamiento y test.</p>
</div>
<div id="training-vw-process" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/theoretical-aspects/overview/training_vw_process.png" alt="training vw process">
</div>
<div class="title">Figure 4. Flujo de trabajo para procesar los datos y entrenar al clasificador automático</div>
</div>
<div class="paragraph">
<p>Las siguientes secciones entrarán a explicar todos los puntos anteriores en un mayor grado de profundidad.</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_likelihood_ratio_test">2.2. Log Likelihood-Ratio test</h3>
<div class="paragraph">
<p>El test Log Likelihood-Ratio (<a href="http://www.itl.nist.gov/div898/handbook/apr/section2/apr233.htm">http://www.itl.nist.gov/div898/handbook/apr/section2/apr233.htm</a>) es un método estadístico ampliamente utilizado en problemas donde se pretenden comparar dos conjuntos de datos a través de una serie de supuestos.</p>
</div>
<div class="paragraph">
<p>En el caso del presente proyecto, la idea principal es aplicar LLR sobre los dos conjuntos de datos que contienen, por un lado, los tuits que se han recogido para el área local sobre el que se quieren comenzar a inferir tuits, y por el otro, un conjunto de tuits localizado en un área que se podría entender como global respecto al conjunto de datos local (por lo general, las áreas globales son localizaciones donde se habla el mismo idioma que en el área local, pero abarca otros territorios).</p>
</div>
<div class="paragraph">
<p>En este caso, partimos del <strong>supuesto</strong> de que el área local es un caso especializado del área global, el cual se puede diferenciar por los términos que contiene. Sobre este supuesto, el test Log Likelihood-Ratio nos devolverá una puntuación para cada término del área local donde se reflejará su valor discriminativo sobre el conjunto de términos globales. Cuanto más discriminativo sea el término, mayor será su valor LLR. Sin embargo, todos aquellos que no sirvan para diferenciar al conjunto de datos especializado, tendrán un valor negativo.</p>
</div>
<div class="paragraph">
<p>El valor LLR de cada término se utilizará para calcular la puntuación que indique si los nuevos tuits pertenecen o no al área local mediante un sumatorio de todos los valores para cada término que forma el tuit.</p>
</div>
<div class="paragraph">
<p>La explicación acerca de qué se considera <strong>término</strong> en el contexto del presente proyecto se explica en <a href="#_términos_discriminativos">Términos discriminativos</a>, pero se podría definir resumidamente como todo aquel lexema que pueda contener información geolocalizable asociada.</p>
</div>
<div class="sect3">
<h4 id="_log_likelihood_ratio_test_normalizado">2.2.1. Log Likelihood-Ratio test normalizado</h4>
<div class="paragraph">
<p>La implementación del algoritmo Log Likelihood-Ratio utilizado se basa en la interpretación propuesta en el artículo: Java, Akshay, et al. «Why we twitter: understanding microblogging usage and communities». Perteneciente a la novena WebKDD y primer taller SNA-KDD 2007 en minería de datos web y análisis de redes sociales.<span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span></p>
</div>
<div class="paragraph">
<p>Tras los primeros experimentos, aunque se vislumbraron resultados esperanzadores, se observó también como algunos términos que se sabía eran discriminativos, no obtenían una puntuación LLR lo suficientemente alta como para que el sistema los pudiese considerar discriminativos en el futuro. Por tanto, se realizó una nueva implementación <em>normalizada</em> sobre el algoritmo anterior, basada en la siguiente sospecha:</p>
</div>
<div class="quoteblock">
<blockquote>
Términos como «españa», los cuales son muy representativos de tuits españoles, también son relativamente comunes en tuits chilenos, y por tanto no se puede interpretar que vayan a tener la misma importancia para discrimar entre ambos, por mucho que su uso sea mayor en España. Sin embargo, términos como «culín sidra», los cuales no tienen una gran representatividad en tuits españoles y es casi seguro que no tengan ninguna aparición en tuits procedentes de Chile, tienen un gran componente geográfico implícito que hace pensar que tuits que contenga ese término es <strong>muy posible</strong> que provengan de España.
</blockquote>
<div class="attribution">
&#8212; Comunicación personal del director del proyecto.
</div>
</div>
<div class="paragraph">
<p>Para tratar de demostrar la intuición anterior, se desarrolló una normalización basada en tres pasos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>La puntuación LLR de cada término, es normalizada contra el mínimo (negativo) y máximo (positivo) valor teórico que LLR puede alcanzar dados dos datasets.</p>
</li>
<li>
<p>La frecuencia del término en el dataset local y global, es normalizada frente al total de frecuencias en ambos datasets.</p>
</li>
<li>
<p>Por último, el valor LLR normalizado es dividido por el valor correspondiente de la frecuencia local o global dependiendo de si el valor obtenido es positivo o negativo (es decir, si es más posible que pertenezca al dataset A o al dataset B).</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Algoritmo para normalizar el valor LLR de un término</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span style="color: #888888">/*</span>
<span style="color: #888888">   * @param a  frequency of token of interest in dataset A</span>
<span style="color: #888888">   * @param b  frequency of token of interest in dataset B</span>
<span style="color: #888888">   * @param c  total number of observations in dataset A</span>
<span style="color: #888888">   * @param d  total number of observations in dataset B</span>
<span style="color: #888888">   */</span>
  <span style="color: #008800; font-weight: bold">public</span> <span style="color: #888888; font-weight: bold">double</span> <span style="color: #0066bb; font-weight: bold">normalizedLLR</span> (<span style="color: #888888; font-weight: bold">long</span> a, <span style="color: #888888; font-weight: bold">long</span> b, <span style="color: #888888; font-weight: bold">long</span> c, <span style="color: #888888; font-weight: bold">long</span> d) {
    <span style="color: #888888; font-weight: bold">double</span> min, max, a_norm, b_norm, llr;
    min    = getLLR(<span style="color: #0000DD; font-weight: bold">0</span>, d, c, d);
    max    = getLLR(c, <span style="color: #0000DD; font-weight: bold">0</span>, c, d);
    a_norm = a / (<span style="color: #888888; font-weight: bold">double</span>)c;
    b_norm = b / (<span style="color: #888888; font-weight: bold">double</span>)d;
    llr    = getLLR(a, b, c, d);

    <span style="color: #008800; font-weight: bold">return</span> (llr&gt;<span style="color: #0000DD; font-weight: bold">0</span>) ? (llr/(max*a_norm)) : (-llr/(min*b_norm));
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta manera, el valor LLR normalizado se puede usar como <em>proxy</em> para el nivel de confianza que tendremos a la hora de asignar cada término a uno u otro dataset. Por ejemplo, en el supuesto anterior, «españa» obtendría un peso relativamente bajo, mientras que si aparece «culín sidra» su peso sería muy alto. En el caso contrario, donde se querría identificar cuando un término no es lo suficientemente discriminativo para el área local, se aplicaría la misma lógica, y términos como «chile» tendría un peso negativo moderado, mientras que «achunchar» obtendría un peso mucho más negativo para indicar que el vocablo es más discriminativo para el área global.</p>
</div>
<div class="paragraph">
<p>A continuación, se muestran los 10 resultados más discriminativos tras aplicar LLR y LLR normalizado sobre keywords que sirvan para diferenciar tuits de Asturias del resto de España:</p>
</div>
<div class="listingblock">
<div class="title">LLR sin normalizar</div>
<div class="content">
<pre>5.673174267765713    avilés
5.786668335161142    muches
6.55625607825904     gracies
6.9163915469140225   gijon
7.082198151712459    olmo
7.650261596901131    ye
7.8221070414197245   besin
8.673885864488826    gijón
11.355768634976933   asturias
13.541645339239054   oviedo</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">LLR normalizado</div>
<div class="content">
<pre>34.03033586645537    economia
34.83206427341024    escalera
35.896146032001866   moreda
40.13311132890776    héctor
40.13311132890776    celebralos
40.13311132890776    sidra
41.63987088300992    avilés
41.65857127377122    simón
45.94585510324283    presta</pre>
</div>
</div>
<div class="paragraph">
<p>Se puede observar como en el caso del LLR normalizado, se penalizan aquellos términos que podrían aparecer frecuentemente en otros tuits del territorio español: <em>oviedo</em>, <em>gijón</em> y <em>asturias</em>; mientras que se favorecen otros más específicos como <em>sidra</em>, <em>presta</em> o <em>celebralos</em> (escrito como se pronunciaría en asturiano).</p>
</div>
<div class="paragraph">
<p>Como también es evidente, existe cierto ruido a la hora de identificar términos como muy discriminativos. En el caso anterior, a las palabras <em>escalera</em> o <em>economia</em> se les ha otorgado una puntuación LLR bastante elevada pero que puede ser tolerable, por el momento, al tratarse de un proceso totalmente automático que no necesita de ningún conocimiento experto.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_términos_discriminativos">2.3. Términos discriminativos</h3>
<div class="paragraph">
<p>Se consideran términos discriminativos aquellos que son capaces de aportar información muy geolocalizable de manera implícita. Un ejemplo son aquellas palabras muy propias de una localización en concreto, como el caso del término <em>sidra</em> o <em>carbayu</em>, que con mucha probabilidad indican un contenido que ha sido generado en Asturias.</p>
</div>
<div class="paragraph">
<p>La estrategia planteada en este proyecto está basada en descubrir este tipo de términos a través de los tuits que los usuarios publican para una determinada región (país, estado, ciudad, etc.). Para ello, la premisa básica es aceptar que los términos más discriminativos tenderán a tener un epicentro muy significativo donde su frecuencia es muy elevada, para después, no tener apenas dispersión y ser muy poco frecuentes en el resto.</p>
</div>
<div class="paragraph">
<p>Con el objetivo de poder aplicar los algoritmos anteriores, será necesario trabajar siempre con dos datasets sobre los que establecer la comparativa. Por un lado, se trabajará con un conjunto de datos localizados en el área en concreto que se quiera analizar, y por otro lado, otro conjunto de datos que se establezcan en un área más global para ese mismo idioma.</p>
</div>
<div class="paragraph">
<p>A partir de ahí, el análisis de cada dataset extraerá los siguientes términos:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Menciones</dt>
<dd>
<p>Se considerán menciones todos aquellos términos que comienzan con el literal <code>@</code>. En Twitter, se utilizan para hacer referencia a otro usuario en el contenido que se está publicando.</p>
</dd>
<dt class="hdlist1">Hashtags</dt>
<dd>
<p>Un hashtag es un término que comienza con el literal <code>#</code> y sirve para categorizar el contenido de un tuit. Un ejemplo claro es durante los partidos de fútbol del Fútbol Club Barcelona, donde los aficionados que se encuentran comentando el partido en Twitter, suelen acompañar cada publicación con el hashtag <code>#fcblive</code> de manera que clasifican manualmente el contenido de su tuit para poder ser agrupado en una misma conversación.</p>
</dd>
<dt class="hdlist1">Bigramas</dt>
<dd>
<p>En este proyecto, hemos considerado como bigramas todas aquellas combinaciones de 2 palabras que se puedan formar con el contenido de un tuit. Al contrario que en algunos artículos de investigación anteriores donde sólo se consideran términos consecutivos, en este caso hemos realizado todas las combinaciones posibles para cada tuit.</p>
<div class="paragraph">
<p>Algunas consideraciones importantes sobre esto son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se han eliminado todos aquellos bigramas que contienen 2 veces la misma palabra.</p>
</li>
<li>
<p>Se han eliminado todos aquellos bigramas que contienen al menos una palabra vacía.</p>
</li>
<li>
<p>Se han eliminado todos aquellos bigramas con términos inferiores a 2 caracteres.</p>
</li>
<li>
<p>Se han ordenado alfabéticamente todos los bigramas de acuerdo a las 2 palabras que contienen, facilitando así el control de bigramas repetidos.</p>
<div class="paragraph">
<p>Un ejemplo de los bigramas que obtendríamos tras analizar un tuit en base a las condiciones anteriores sería:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Buenos días vamos a trabajar todo el día</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Que generaría las siguientes combinaciones</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(buenos días), (buenos vamos), (buenos trabajar),
(buenos todo), (buenos día), (días vamos),
(días trabajar), (días todo), (día días),
(trabajar vamos), (todo vamos), (día vamos),
(todo trabajar), (día trabajar), (día todo)</pre>
</div>
</div>
<div class="paragraph">
<p>Como se puede observar, la generación de bigramas para cada tuit provoca una explosión de términos que fue necesario controlar (explicado en <a href="#_utilización_de_algoritmos_de_streaming">Utilización de algoritmos de Streaming</a>) para evitar sobrepasar la memoria del sistema.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Keywords</dt>
<dd>
<p>Las keywords son unigramas formados, obviamente, por un único término, cuyo resultado se asemeja a realizar una tokenización sobre el tuit pero aplicando reglas que también se utilizaban en la extracción de bigramas (palabra vacía, longitud inferior a 2 caracteres, etc.).</p>
</dd>
<dt class="hdlist1">Keywords en el campo de Localización</dt>
<dd>
<p>Son el resultado de aplicar la extracción anterior sobre el campo de Localización del perfil del usuario.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A continuación se muestran dos ejemplos de tuits que reflejan como existen ciertos términos que pueden poseer información geográfica implícita a pesar de no estar relacionados a ningunas coordenadas concretas. Los tuits seleccionados pertenecen a un conjunto recogido entre los días 13 y 14 de mayo de 2014 para la ciudad de Madrid.</p>
</div>
<div class="paragraph">
<p>El primer tuit contiene mucha información potencialmente geolocalizable. Nombra varias veces la ciudad de Madrid y, además, hace uso del término <strong>champions</strong> el cual fue, en conjunción con el término <strong>madrid</strong>, uno de los biagramas que localizaban con más fuerza los tuits procedentes de la capital española.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Campo de Localización</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Madrid</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contenido del tuit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primera vez que dos equipos <strong>Madrileños</strong>, se erigen como finalistas de la  <strong>Champions</strong>!! Gane quién gane, <strong>Madrid</strong> gana!! La Copa se queda aquí.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El siguiente tuit, se podría considerar como un claro ejemplo de tuit difícilmente localizable (en base a su contenido). Su campo de localización no hace ninguna referencia a un lugar geográfico y el contenido del tuit tampoco contiene ninguna entidad geográfica:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Campo de Localización</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skateboarding saved my life.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contenido del tuit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Que <strong>Ana Botella</strong> cobre 100.000€ al año en bruto y no sepa hablar inglés no tiene derecho.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Sin embargo, la presencia del bigrama <strong>ana botella</strong> puede aportar alguna pista para identificar que el tuit procede de Madrid. De hecho, los experimentos realizados sobre este mismo conjunto de datos, detectaron que el bigrama <strong>ana botella</strong> efectivamente era bastante significativo para identificar tuits procedentes de Madrid sobre aquellos procedentes del resto de España.<span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span></p>
</div>
<div class="sect3">
<h4 id="_sistema_de_filtros">2.3.1. Sistema de filtros</h4>
<div class="paragraph">
<p>Con el objetivo de poder realizar las extracciones de los términos anteriores de forma flexible, se diseñó un pequeño sistema de filtros que ayudara a combinar varios filtros en una misma ejecución. La implementación de este sistema está basada en el patrón de diseño Decorator<span class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</span>, aunque con la diferencia de que en este caso, la extracción de cada filtro se realiza sobre el tuit original y no sobre el resultado de las extracciones de filtros anteriores (una «decoración» incremental no tendría sentido dado el dominio del problema).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/extractor-filter.png" alt="Representación del patrón Decorator que ilustra el sistema de filtros">
</div>
<div class="title">Figure 5. Representación del patrón Decorator que ilustra el sistema de filtros</div>
</div>
</div>
<div class="sect3">
<h4 id="_utilización_de_algoritmos_de_streaming">2.3.2. Utilización de algoritmos de Streaming</h4>
<div class="paragraph">
<p>Como se ha visto en secciones anteriores, el proceso de extracción de términos genera una gran cantidad de datos que será necesario gestionar en memoria. Para solucionar este problema, se hizo uso de técnicas propias de los algoritmos de Streaming, los cuales tienen varios puntos en común con el problema actual.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Algoritmos de Streaming</div>
<div class="paragraph">
<p>Se conocen como algoritmos de Streaming aquellos problemas donde la capacidad de memoria o procesamiento es menor a la cantidad de datos que se reciben como entrada. Estos datos, se procesan de uno en uno y una única vez, manteniendo un orden secuencial e incremental que implica que sea necesario conocer el dato anterior para poder procesar correctamente el dato actual.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La solución, por tanto, pasa por controlar el número de elementos que se gestionan en cada momento en memoria por el sistema, y plantear una estrategia que sea capaz de liberar memoria sin el riesgo de perder información que pueda adulterar los resultados. Los pasos seguidos en este proyecto para lidiar con el problema fueron los siguientes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Establecer un número máximo de <em>keys</em> que podrán ser gestionadas por el hash. Este valor deberá ser configurado por el desarrollador en función de las características del hardware sobre el que se ejecute el sistema. En las pruebas realizadas en este proyecto, el número máximo de elementos se situó en 500.000.</p>
<div class="paragraph">
<p>Esto también implica que el sistema de generación de puntuaciones LLR podrá trabajar únicamente sobre los <code>n</code> términos que se seleccionen aquí.</p>
</div>
</li>
<li>
<p>Una vez determinado el umbral máximo de elementos, será necesario definir que porcentaje de términos se eliminarán una vez alcanzado el límite anterior. En este caso, se ha optado por seguir una estrategia de poda agresiva en la que se eliminan de manera constante un porcentaje de los elementos con menos frecuencia del hash.</p>
<div class="paragraph">
<p>Esta estrategia implica que siempre que se produzca una situación de poda, se deba ordenar el hash de acuerdo a la frecuencia de sus elementos. De manera experimental, se ha comprobado como la eliminación constante de un 40% de los elementos con menor frecuencia, a pesar de parecer demasiado agresiva, da resultados muy positivos sin existir riesgo de eliminar términos con una frecuencia muy elevada (por supuesto, todo esto dentro del dominio del problema actual).</p>
</div>
</li>
<li>
<p>En el momento de realizar la poda, se debe guardar qué frecuencia es la mayor del grupo de elementos a eliminar. De esta manera, se consigue que términos que vuelvan a aparecer tras la poda, partan de su frecuencia original en vez de volver a empezar de 0. Esto provoca también que muchos términos nuevos, empiecen con una frecuencia más elevada de lo esperado. Sin embargo, la frecuencia mínima que se utilizará después para seleccionar sobre qué términos se aplica el LLR, será lo suficientemente elevada como para evitar situaciones donde este problema pueda adulterar los resultados.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En <a href="#_pseudocódigo_para_ilustrar_el_proceso_completo_de_análisis_de_tuits">Pseudocódigo para ilustrar el proceso completo de análisis de tuits</a>, se muestra un esbozo de la implementación del algoritmo anterior. El control de memoria y proceso de poda agresiva se ilustra a través de los métodos <code>check_memory_status</code> y <code>reduce_map_load</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pseudocódigo_para_ilustrar_el_proceso_completo_de_análisis_de_tuits">2.4. Pseudocódigo para ilustrar el proceso completo de análisis de tuits</h3>
<div class="paragraph">
<p>Los siguientes fragmentos de <em>pseudocódigo</em> muestran los diferentes algoritmos que se han utilizado para obtener la frecuencia de términos en los diferentes datasets, así como el proceso para realizar el cálculo de su Log Likelihood-Ratio asociado y la manera de computar la puntuación total de cada tuit en función de la puntuación de cada uno de los términos que contiene.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Algoritmo para extraer la frecuencia de cada término</div>
<div class="content">
<pre class="pygments highlight"><code class="ruby language-ruby"><span style="color: #008800; font-weight: bold">for</span> each tweet <span style="color: #008800; font-weight: bold">in</span> tweets <span style="color: #008800; font-weight: bold">do</span>
  terms = apply_extractor_filter(tweet)
  check_memory_status()
  <span style="color: #008800; font-weight: bold">for</span> each term <span style="color: #008800; font-weight: bold">in</span> terms <span style="color: #008800; font-weight: bold">do</span>
    <span style="color: #008800; font-weight: bold">if</span> frequencies[term].is_defined <span style="color: #008800; font-weight: bold">then</span>
      frequencies[term] += <span style="color: #0000DD; font-weight: bold">1</span>
    <span style="color: #008800; font-weight: bold">else</span>
      frequencies[term] = minimum_frequency
    <span style="color: #008800; font-weight: bold">end</span>
  <span style="color: #008800; font-weight: bold">end</span>
<span style="color: #008800; font-weight: bold">end</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066bb; font-weight: bold">check_memory_status</span>
  <span style="color: #008800; font-weight: bold">if</span> frequencies.size &gt;= <span style="color: #003366; font-weight: bold">MAXIMUM_EXTRACTED_TERMS</span> <span style="color: #008800; font-weight: bold">then</span>
    reduce_map_load()
  <span style="color: #008800; font-weight: bold">end</span>
<span style="color: #008800; font-weight: bold">end</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066bb; font-weight: bold">reduce_map_load</span>
  items_to_remove   = frequencies.size * <span style="color: #003366; font-weight: bold">FACTOR_TO_REMOVE</span>
  <span style="color: #888888"># Ordenamos el mapa de menor a mayor en función de la frecuencia</span>
  ordered_map       = frequencies.order_by_frequency
  minimum_frequency = ordered_map.get(items_to_remove - <span style="color: #0000DD; font-weight: bold">1</span>)

  ordered_map.slice from items_to_remove - <span style="color: #0000DD; font-weight: bold">1</span> to ordered_map.size
<span style="color: #008800; font-weight: bold">end</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Algoritmo para calcular la puntuación LLR de cada término</div>
<div class="content">
<pre class="pygments highlight"><code class="ruby language-ruby"><span style="color: #008800; font-weight: bold">for</span> each term <span style="color: #008800; font-weight: bold">in</span> locals <span style="color: #008800; font-weight: bold">do</span>
  freq = locals[term]
  <span style="color: #008800; font-weight: bold">if</span> freq &gt; min_frequency <span style="color: #008800; font-weight: bold">then</span>
    global_freq = get_global_freq(term)
    <span style="color: #008800; font-weight: bold">if</span> global_freq &gt; <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">then</span>
      k11 = freq
      k12 = global_freq
      k21 = total_local_frequencies
      k22 = total_global_frequencies
      llr = <span style="color: #003366; font-weight: bold">Dunning</span>.normalized_llr(k11, k12, k21, k22)
      results[term] =&gt; llr
    <span style="color: #008800; font-weight: bold">end</span>
  <span style="color: #008800; font-weight: bold">end</span>
<span style="color: #008800; font-weight: bold">end</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066bb; font-weight: bold">get_global_freq</span>(term)
  globals[term].is_defined ? globals[term] : avg_global_freq(term)
<span style="color: #008800; font-weight: bold">end</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066bb; font-weight: bold">avg_global_freq</span>(term)
  same_freq_in_local = locals.select(
    t =&gt; globals[t].is_defined &amp;&amp; locals[t] == locals[term]
  )
  acc = same_freq_in_local.map(t =&gt; globals[t]).reduce(
    (previous, current) =&gt; previous + current
  )
  <span style="color: #008800; font-weight: bold">return</span> acc / same_freq_in_local.size
<span style="color: #008800; font-weight: bold">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Algoritmo para calcular la puntuación LLR de cada tuit</div>
<div class="content">
<pre class="pygments highlight"><code class="ruby language-ruby"><span style="color: #008800; font-weight: bold">for</span> each tweet <span style="color: #008800; font-weight: bold">in</span> tweets <span style="color: #008800; font-weight: bold">do</span>
  terms = extract_terms(tweet)

  score = <span style="color: #0000DD; font-weight: bold">0</span>
  <span style="color: #008800; font-weight: bold">for</span> each term <span style="color: #008800; font-weight: bold">in</span> terms <span style="color: #008800; font-weight: bold">do</span>
    score += llr_by_term[term]
  <span style="color: #008800; font-weight: bold">end</span>

  results[tweet] = score
<span style="color: #008800; font-weight: bold">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_procesando_xml_con_em_pull_parsing_em">2.5. Procesando XML con <em>pull parsing</em></h3>
<div class="paragraph">
<p>Debido al intenso uso que se hace en el proyecto de datos en XML (ver <a href="#_almacenamiento_de_datos">Almacenamiento de datos</a>), fue necesario desarrollar un sistema de análisis basado en estrategias que evitasen tener que cargar el contenido completo del XML en memoria.</p>
</div>
<div class="paragraph">
<p>Dos de las estrategias más conocidas en contraposición a DOM para analizar grandes colecciones de XML son: <strong>Simple API XML (o SAX)<span class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</span></strong> y <strong>pulling parsing<span class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</span></strong>.</p>
</div>
<div class="paragraph">
<p>En este proyecto, se decidió utilizar la segunda debido a su soporte nativo por parte de las APIs de Scala (en <a href="#_scala">Scala</a> se realiza una breve descripción acerca de este lenguaje de programación así como de las razones que influyeron en su utilización en el desarrollo del presente proyecto) para trabajar con XML a través del paquete <code>xml.pull</code>. Pulling parser se caracteriza por analizar el fichero XML mediante la utilización de eventos. A medida que se van leyendo líneas del documento, van saltando una serie de eventos de acuerdo a la especificación: <em>comienzo de elemento, fin de elemento, comienzo de nodo de texto, fin de nodo de texto, etc</em>. Cada uno de estos eventos, puede tener asignado un <em>listener</em> que contenga la lógica a ejecutar.</p>
</div>
<div class="paragraph">
<p>El fragmento de código posterior muestra un ejemplo de uso para analizar un fichero XML mediante <em>pulling parser</em>. En primer lugar se define el fichero sobre el que realizar el análisis y se crea una nueva variable que nos ayudar a controlar cuando estamos dentro del elemento que queremos analizar. Utilizando <em>pattern matching</em> nos aseguramos de seleccionar aquellos elementos cuya etiqueta coincida con la del campo sobre el que debe actuar el filtro que deseamos aplicar. En caso de encontrar un elemento de apertura para ese nodo, indicamos en la variable booleana <code>in</code> que nos encontramos en el elemento deseado y los eventos encargados de detectar nodos de texto la consultarán para saber si sobre ese texto deben aplicar o no el filtro.</p>
</div>
<div class="paragraph">
<p>El evento para detectar que hemos salido del nodo deseado se encarga de volver a <em>setear</em> el valor de la variable <code>in</code> a <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de código para analizar un documento XML utilizando <em>pulling parser</em></div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java">val reader = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">XMLEventReader</span>(Source.<span style="color: #336699">fromFile</span>(xmlFile))
var in = <span style="color: #008800; font-weight: bold">false</span>
reader.<span style="color: #336699">foreach</span>({
  <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemStart <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> == _filter.<span style="color: #336699">field</span> =&gt; in = <span style="color: #008800; font-weight: bold">true</span>
  <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvText</span>(text) <span style="color: #008800; font-weight: bold">if</span> in =&gt; applyFilter(text)
  <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemEnd <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> == _filter.<span style="color: #336699">field</span> =&gt; in = <span style="color: #008800; font-weight: bold">false</span>
  <span style="color: #008800; font-weight: bold">case</span> _ =&gt; ;
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entrenamiento_del_clasificador">2.6. Entrenamiento del clasificador</h3>
<div class="paragraph">
<p>Después de todos los algoritmos y procesos anteriores, el último paso es entrenar al software de aprendizaje automático (ver <a href="#_software_de_aprendizaje_automático_y_vowpal_wabbit">Software de aprendizaje automático y Vowpal Wabbit</a>) para proporcionarle la información necesaria para que pueda inferir la localización de un tuit de manera automática.</p>
</div>
<div class="paragraph">
<p>Partiendo del punto en el que ya se tienen una serie de ficheros TSV con la puntuación LLR de cada término y que han servido para generar un último fichero TSV con la puntuación LLR asociada para cada tuit (mediante el sumatorio del conjunto de términos que lo forman) de una nueva colección de 24 horas, será necesario traducir esa información a un input válido para Vowpal Wabbit. Para ello, se utiliza el sistema explicado en <a href="#_normalización_de_datos">Normalización de datos</a>.</p>
</div>
<div class="paragraph">
<p>Una vez hecho esto, y como se explica también en <a href="#_división_de_datos_en_conjuntos_de_entrenamiento_y_test">División de datos en conjuntos de entrenamiento y test</a> será necesario dividir el fichero de entrada en un 80% de usuarios para entrenar al clasificador, y un 20% para realizar tests. Serán este 20% restantes los que se usarán para medir la precisión y exhaustividad de los modelos que se creen para realizar los experimentos a diferentes granularidades.</p>
</div>
<div class="paragraph">
<p>Es importante señalar que los ficheros de entrada que se utilizan para entrenar a Vowpal Wabbit han sido refinados para eliminar aquellos tuits cuya puntuación era negativa aunque se sabía (ya que contiene información geográfica adjunta por tratarse de tuits utilizados en procesos de entrenamiento) que su localización pertenecía al área local y viceversa. De este modo, se garantiza que el clasificador se entrene siempre en base a resultados correctos.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_experimentos_y_resultados">3. Experimentos y resultados</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para comprobar la validez de los algoritmos anteriores se plantearon una serie de experimentos que trabajasen sobre conjuntos de tuits escritos tanto en inglés como en español, con el objetivo de poder obtener resultados positivos a nivel de país, provincia, área metropolitana y barrio.</p>
</div>
<div class="paragraph">
<p>La selección de los idiomas inglés y español como base para los experimentos se realizó a tenor de ser los dos lenguajes, a priori, más complejos de analizar debido a que son hablados en muchas partes del mundo. Por ejemplo, haber escogido como idioma el italiano, haría que las posibilidades de geolocalización se viesen reducidas prácticamente a Italia; ídem en el caso de haber utilizado alemán, que tan sólo es hablado en Alemania, Austria, Suiza y parte de Luxemburgo.</p>
</div>
<div class="sect2">
<h3 id="_primeros_experimentos_trabajando_con_grandes_volúmenes_de_datos">3.1. Primeros experimentos: trabajando con grandes volúmenes de datos</h3>
<div class="paragraph">
<p>Los primeros experimentos se basaron en establecer diferencias a nivel de país. Para ello, se realizó un proceso de recolección de tuits durante una semana para los siguientes casos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tuits de España escritos en español</p>
</li>
<li>
<p>Tuits del mundo escritos en español</p>
</li>
<li>
<p>Tuits del Reino Unido escritos en inglés</p>
</li>
<li>
<p>Tuits del mundo escritos en inglés</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En total esta fase duró 4 semanas, recolectando en torno a <code>2 x 8GB</code> de datos para los tuits globales, así como <code>2 x 1GB</code> para los tuits localizados en España y el Reino Unido.</p>
</div>
<div class="paragraph">
<p>Estos primeros conjuntos de datos permitieron que se desarrollasen los algoritmos de puntuación LLR y se empezase a comprobar empíricamente qué resultados aportaban los términos utilizados (menciones, hashtags, bigramas) así como investigar que otros campos o términos del perfil del usuario podrían ayudar a encontrar pistas acerca de su geolocalización. Durante esta fase se añadió el uso de <em>keywords</em> tanto a nivel de contenido de un tuit como sobre el campo de localización del usuario, sospechando que podrían aportar más información útil en base a los resultados LLR que se estaban observando a nivel de bigramas.</p>
</div>
<div class="paragraph">
<p>Sobre estos conjuntos de datos no llegaron a establecerse pruebas que involucrasen software de aprendizaje automático, puesto que el uso de grandes volúmenes de datos quedó descartado al comprobar empíricamente que los términos que implican contenido geolocalizable no tienen que ser uniformes en el tiempo para una determinada región. Esta apreciación se realizó al trabajar con nuevos conjuntos de datos más pequeños, donde aparecieron como términos muy significativos aquellos que tenían que ver con un evento temporal muy concreto, el fallecimiento del seleccionador de fútbol nacional, Luis Aragonés.</p>
</div>
<div class="listingblock">
<div class="title">Puntuación LLR para algunos términos recogidos en conjuntos de datos entre el 1 y 2 de febrero de 2014</div>
<div class="content">
<pre>48.958529065415576  aragonés gran
49.17093149031471   aragonés selección
50.049053227619474  aragonés descanse
50.049053227619474  grandes luis
50.739417608310795  luis roja
50.97596629207029   luis nunca
50.97596629207029   luis mas
51.215854517258855  aragones hoy
51.215854517258855  aragonés historia
51.45916160893309   fútbol hombre
51.95636312422304   aragonés hombre
52.21042998468123   siempre aragones
52.46826083659376   luis mejor
52.46826083659376   dep sabio
56.28098057747021   descanse paz
81.59614077426396   fútbol grande
102.31617863438613  entrenador gran
107.56036254304512  bernabéu santiago
107.5697695101089   noticia triste
107.87375147152346  hoy madrid
111.68234684538564  hizo hombre
111.93538868096397  dep triste
115.39967536884996  fútbol va
116.50155357908382  futbol hoy
119.45187311362997  día fútbol</pre>
</div>
</div>
<div class="paragraph">
<p>Como se puede observar, términos vinculados al fallecimiento del seleccionador aportaban una gran información geográfica que hacía que todos los tuits que los contenían prácticamente fuesen vinculados a España (lo cual en este caso sería correcto). Pero, ¿qué sucede si ocurre sobre un evento que se pueda aplicar sobre cualquier otro lugar del mundo en cualquier momento?</p>
</div>
<div class="paragraph">
<p>Por ejemplo, es habitual que durante los meses de verano en el hemisferio sur, términos relativos a la estación estival sean más habituales en países como Argentina, Chile, etc. que en España. Lo cual sería justamente al revés en épocas de verano en el hemisferio norte. Por tanto, es importante tener en cuenta que los términos y el vocabulario tienen una importancia temporal, y el hecho de obtener grandes volúmenes de datos no tiene porque beneficiar el entrenamiento de un modelo de aprendizaje automático para inferir la localización de un tuit.</p>
</div>
<div class="paragraph">
<p>Por ello, se optó por trabajar siempre con conjuntos de datos recogidos en periodos de 24 horas, para evaluarlos contra colecciones de tuits que se recogerían en las 24 horas siguientes. De esta manera se puede aprovechar la repercusión de ciertos términos ante cualquier evento.</p>
</div>
</div>
<div class="sect2">
<h3 id="_trabajando_con_diferentes_niveles_de_granularidad">3.2. Trabajando con diferentes niveles de granularidad</h3>
<div class="sect3">
<h4 id="_conceptos_previos">3.2.1. Conceptos previos</h4>
<div class="sect4">
<h5 id="_precisión_y_exhaustividad">Precisión y exhaustividad</h5>
<div class="paragraph">
<p>Para entender los siguientes resultados, será necesario explicar dos conceptos clave que se repetirán a lo largo de las diferentes tablas resumen. El concepto de <strong>precisión</strong> se puede entender como el número de predicciones que coinciden con los resultados reales sobre el total de las predicciones realizadas.</p>
</div>
<div class="paragraph">
<p>Por tanto, si tenemos un total de 20 predicciones y 18 de las mismas han coincidido con su valor real, se consideraría que el porcentaje de precisión sería:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(18/20) * 100 = 90% de precisión</pre>
</div>
</div>
<div class="paragraph">
<p>El concepto <strong>exhaustividad</strong> se explica como el porcentaje de tuits locales que se han identificado sobre el conjunto de tuits locales reales. En este caso, partiendo de un ejemplo en el que se hubiesen etiquetado 25 tuits como locales de manera correcta y sabiendo que en el conjunto a evaluar existían 30 tuits locales, el porcentaje de exhaustividad de nuestro modelo sería de:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(25/30) * 100 = 83.33%</pre>
</div>
</div>
<div class="paragraph">
<p>Entendiendo este porcentaje como que para cada 100 tuits que sabemos son locales, nuestro modelo es capaz de detectar ~ 83 satisfactoriamente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_umbral_de_precisión">Umbral de precisión</h5>
<div class="paragraph">
<p>Una característica que permite manejar el grado de exhaustividad de cada modelo es el valor que se determine como <strong>umbral de precisión</strong>.</p>
</div>
<div class="paragraph">
<p>Por defecto, Vowpal Wabbit devuelve un valor entre 0 y 1 con la probabilidad de que ese ejemplo pertenezca al conjunto de tuits locales o no (entendiendo 1 como que <strong>sí</strong> pertenece al conjunto local y 0 como que <strong>no</strong>).  Por tanto, es habitual que muchos valores que son realmente 1, no aparezca en los resultados de la predicción de manera tan absoluta, sino que se muestren con valores cada vez más cercanos a 1 en función del grado de confianza del clasificador en su predicción: <em>0.5, 0.6, 0.7, etc.</em></p>
</div>
<div class="paragraph">
<p>Ese valor que determinemos como umbral permitirá que más o menos valores sean etiquetados por el clasificador como locales y, por tanto, que más o menos tuits locales puedan ser potencialmente etiquetados. Sin embargo, cuanto más bajo pongamos el umbral de precisión, más baja será la precisión y por tanto se encontrará más ruido en los resultados finales.</p>
</div>
<div class="paragraph">
<p>Para los siguientes ejemplos se ha tomado como umbral el valor <strong>0.5</strong>, el cual demuestra tener, de manera empírica, un buen comportamiento en la relación precisión - exhaustividad.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_resultados_a_nivel_de_país">3.2.2. Resultados a nivel de país</h4>
<div class="paragraph">
<p>De acuerdo con los objetivos establecidos al comienzo del proyecto, se realizaron dos experimentos a nivel de país para poder trabajar tanto con tuits escritos en español como con aquellos escritos en inglés.</p>
</div>
<div class="paragraph">
<p>Por un lado, se realizó un experimento que pudiese discriminar tuits procedentes de España en un conjunto de tuits globales escritos en español. Por el otro, se realizó un segundo experimento enfocado en detectar qué tuits escritos en inglés desde las islas británicas procedían de la República Irlandesa.</p>
</div>
<div class="paragraph">
<p>Los resultados para ambos experimentos se pueden observar en las tablas <a href="#experiment-spain-global">Resultados de la ejecución para detectar tuits procedentes España</a> y <a href="#experiment-uk-ireland">Resultados de la ejecución para detectar tuits procedentes de la República Irlandesa</a>.</p>
</div>
<table id="experiment-spain-global" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 2. Resultados de la ejecución para detectar tuits procedentes España</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">93.16%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">89.48%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96.13%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90.35%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-uk-ireland" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 3. Resultados de la ejecución para detectar tuits procedentes de la República Irlandesa</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.17%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">71.17%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.56%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.20%</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_resultados_a_nivel_de_provincia">3.2.3. Resultados a nivel de provincia</h4>
<div class="paragraph">
<p>Para realizar los experimentos a nivel de provincia se seleccionaron las siguientes tres regiones del estado español: <strong>Principado de Asturias</strong>, <strong>Madrid y</strong> <strong>Barcelona</strong>.</p>
</div>
<div class="paragraph">
<p>En este caso, se consideró como área local cada una de las tres regiones anteriores y como área global, el total del territorio español a excepción de la provincia evaluada. Así pues, para realizar el experimento sobre el Principado de Asturias se consideró:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Área local</strong>: Principado de Asturias</p>
</li>
<li>
<p><strong>Área global</strong>: Todo el territorio español a excepción del Principado de Asturias.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Siguiendo el mismo mecanismo en el resto de provincias.</p>
</div>
<div class="paragraph">
<p>Las tablas <a href="#experiment-spain-asturias">Resultados de la ejecución para detectar tuits procedentes del Pricipado de Asturias</a>, <a href="#experiment-spain-madrid">Resultados de la ejecución para detectar tuits procedentes de Madrid</a> y <a href="#experiment-spain-barcelona">Resultados de la ejecución para detectar tuits procedentes de Barcelona</a> muestran los resultados de la ejecución para esta granularidad.</p>
</div>
<table id="experiment-spain-asturias" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 4. Resultados de la ejecución para detectar tuits procedentes del Pricipado de Asturias</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.89%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53.53%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">89.83%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.00%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-spain-madrid" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 5. Resultados de la ejecución para detectar tuits procedentes de Madrid</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">92.27%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72.70%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86.78%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">93.39%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-spain-barcelona" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 6. Resultados de la ejecución para detectar tuits procedentes de Barcelona</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.25%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">65.73%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.09%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.29%</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_barcelona_y_el_impacto_del_catalán">Barcelona y el impacto del catalán</h5>
<div class="paragraph">
<p>Uno de los aspectos más curiosos de los resultados y puntuaciones generadas por el algoritmo Log Likelihood-Ratio fue comprobar como entre los términos más discriminativos para la provincia de Barcelona se encontraban, en su mayoría, vocablos en catalán.</p>
</div>
<div class="paragraph">
<p>Esto certifica de manera empírica las intuiciones acerca de la validez del algoritmo para este tipo de problema, siendo capaz de detectar que los términos en catalán, con una frecuencia muy baja a nivel global y relativamente alta en Barcelona, son los más significativos para identificar al territorio.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="listingblock">
<div class="title">Bigramas más discriminativos para tuits procedentes de la provincia de Barcelona</div>
<div class="content">
<pre>94.52274667047315   per tres
100.19650868429694  per dos
100.19650868429694  salón barcelona
100.19650868429694  ara per
100.19650868429694  acuerdo leo
100.19650868429694  gracias horas
100.19650868429694  debat els
101.79780787750204  buenos barcelona
111.11339666895931  catalunya és
111.11339666895931  avui amb</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_resultados_a_nivel_de_área_metropolitana">3.2.4. Resultados a nivel de área metropolitana</h4>
<div class="paragraph">
<p>Para la granularidad a nivel de área metropolitana, se utilizaron las tres metrópolis más importantes del Reino Unido: <strong>Londres</strong>, <strong>Manchester</strong> y <strong>Birminghan</strong>. El proceso para generar los conjuntos de datos utilizados para el análisis se basa en los mecanismos utilizados a nivel de provincia.</p>
</div>
<div class="paragraph">
<p>Las tablas <a href="#experiment-uk-london">Resultados de la ejecución para detectar tuits procedentes de Londres</a>, <a href="#experiment-uk-manchester">Resultados de la ejecución para detectar tuits procedentes de Manchester</a> y <a href="#experiment-uk-birminghan">Resultados de la ejecución para detectar tuits procedentes de Birminghan</a> muestran los resultados para esta granularidad.</p>
</div>
<table id="experiment-uk-london" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 7. Resultados de la ejecución para detectar tuits procedentes de Londres</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">91.69%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">70.98%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86.43%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">92.77%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-uk-manchester" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 8. Resultados de la ejecución para detectar tuits procedentes de Manchester</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96.68%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">51.10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">88.53%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">96.97%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-uk-birminghan" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 9. Resultados de la ejecución para detectar tuits procedentes de Birminghan</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.22%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47.05%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.95%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.20%</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_resultados_a_nivel_de_barrio">3.2.5. Resultados a nivel de barrio</h4>
<div class="paragraph">
<p>Por último, se realizó un experimento a nivel de barrio, siendo la granularidad más baja analizada en el proyecto. Para ello, se utilizaron los 3 barrios más importantes de Londres como área local (<strong>Wandsworth</strong>, <strong>Lambeth</strong> y <strong>Southwark</strong>), así como la ciudad de Londres como área global. Los resultados de este experimento se pueden consultar en las tablas <a href="#experiment-london-wandsworth">Resultados de la ejecución para detectar tuits procedentes de Wandsworth</a>, <a href="#experiment-london-lambeth">Resultados de la ejecución para detectar tuits procedentes de Lambeth</a> y <a href="#experiment-london-southwark">Resultados de la ejecución para detectar tuits procedentes de Southwark</a>.</p>
</div>
<table id="experiment-london-wandsworth" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 10. Resultados de la ejecución para detectar tuits procedentes de Wandsworth</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.54%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.18%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100.0%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.54%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-london-lambeth" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 11. Resultados de la ejecución para detectar tuits procedentes de Lambeth</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.20%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24.13%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">87.5%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.23%</p></td>
</tr>
</tbody>
</table>
<table id="experiment-london-southwark" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 12. Resultados de la ejecución para detectar tuits procedentes de Southwark</caption>
<colgroup>
<col style="width: 75%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">98.98%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25.0%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90.0%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precisión en predicciones globales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99.01%</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusiones_y_trabajo_futuro_sobre_el_sistema_de_geolocalización">4. Conclusiones y trabajo futuro sobre el sistema de geolocalización</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A raíz de las tablas resumen mostradas en <a href="#_experimentos_y_resultados">Experimentos y resultados</a> se puede concluir que la geolocalización de usuarios en base a sus contenidos es realmente posible y, además, con un alto grado de precisión (para todos los niveles de granularidad el porcentaje de precisión es superior al 90%).</p>
</div>
<div class="paragraph">
<p>Los niveles de exhaustividad se mantienen en un alto porcentaje para los casos de país (por encima del 70%) y empiezan a decaer a medida que se intentan estudiar granularidades más pequeñas y restrictivas. Lo cual, continúa suponiendo una notable mejoría sobre la situación actual, donde la falta de herramientas de este tipo para geolocalizar tuits que no contengan información geográfica adjunta hace que su grado de exhaustividad sea 0. Además, el sistema es lo suficientemente flexible como para poder aumentar el porcentaje de exhaustividad sacrificando los niveles de precisión colocando el umbral por debajo de 0.5.</p>
</div>
<div class="paragraph">
<p>Los diferentes prototipos que se han desarrollado utilizando los algoritmos anteriores, prueban como no es necesario recurrir a agentes externos para obtener información geográfica para geolocalizar a un usuario. En muchos de los artículos de investigación comentados en el <strong>Estado del arte</strong> era habitual que se hiciera referencia a <strong>gazetteers</strong> y sistemas de terceros como <em>Foursquare</em>, para obtener información geográfica en base al reconocimiento de entidades. Este proyecto se ha centrado en desarrollar un proceso automático que permita inferir qué términos son más o menos discriminativos para identificar la localidad de un usuario, partiendo de una premisa que ha sido corroborada en base a los resultados anteriores:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Existen términos con una alta frecuencia para un determinado área geográfica y una muy baja dispersión que sirven para inferir la localización de casi cualquier tuit que los contenga.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="_trabajo_futuro">4.1. Trabajo futuro</h3>
<div class="paragraph">
<p>De cara al futuro, sería muy interesante realizar un mayor número de experimentos para mejorar los resultados a nivel de barrio, los cuales, aunque tienen unos buenos niveles de precisión, se quedan en porcentajes de exhaustividad muy limitados. Una opción sería recoger datos únicamente a nivel de área metropolitana, para obtener una cantidad de tuits muy elevada en su granularidad inmediatamente superior, y realizar los experimentos a nivel de barrio utilizando dicho conjunto.</p>
</div>
<div class="paragraph">
<p>Otra vía de investigación interesante, podría ser utilizar algoritmos de aprendizaje automático multiclase. De esa manera, podríamos etiquetar cada tuit con distintos niveles de granularidad en función del número de decimales utilizados en sus coordenadas geográficas, pudiendo ofrecer predicciones con márgenes de error de 1, 10 ó 100 kilómetros. Aunque las últimas versiones de Vowpal Wabbit permiten la aplicación de este tipo de algoritmos, la manera en que se devolvían las predicciones no se ajustaba a las condiciones del experimento, puesto que no era capaz de retornar las probabilidades de que su predicción perteneciese a una clase u otra. Por tanto, este trabajo debería realizarse utilizando otro software de aprendizaje automático, como por ejemplo <strong>WEKA</strong>.</p>
</div>
<div class="paragraph">
<p>Por último, sería necesario comprobar como evolucionan las puntuaciones LLR de cada término a lo largo del tiempo. Aunque se ha demostrado como el contexto temporal en el que se produce un experimento influye fuertemente en la identificación de los términos más discriminativos (como sucedió en el caso del fallecimiento de Luis Aragonés), no se ha podido investigar si, a la larga, los términos identificados en los primeros meses de ejecución de un sistema podrían mermar la precisión del mismo a la hora de realizar nuevas ejecuciones.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aplicación_web_de_geolocalización_como_servicio">5. Aplicación web de geolocalización como servicio</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A continuación se muestran una serie de secciones que explicarán de manera aproximada la manera de implementar una aplicación web que ofrezca un servicio de geolocalización de tuits en base a su contenido utilizando la tecnología explorada en los prototipos y experimentos anteriores.</p>
</div>
<div class="paragraph">
<p>Es importante aclarar que, puesto que no se ha implementado la aplicación, los conceptos de diseño y análisis que se exponen en el presente proyecto podrían diferir de una aplicación real, en donde nunca se optaría por un enfoque <em>en cascada</em> sino que se utilizaría una metodología ágil basada en iteraciones, donde se irían añadiendo <strong>user stories</strong> con nuevas características que sirvan a su vez para refinar el diseño e implementación del sistema en cada iteración.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_análisis_del_sistema">5.1. Análisis del sistema</h3>
<div class="sect3">
<h4 id="_definición_y_alcance_del_sistema">5.1.1. Definición y alcance del Sistema</h4>
<div class="paragraph">
<p>A partir de las tecnologías y experimentos desarrollados en las secciones anteriores, las próximas páginas recogen el análisis y diseño de una posible aplicación web que, basándose en los trabajos anteriores, sirva para ofrecer un servicio de geolocalización de tuits en base a su contenido.</p>
</div>
<div class="paragraph">
<p>El sistema deberá ser capaz de permitir a los usuarios la creación de <strong>proyectos</strong> en los que identificar sobre qué idioma, localización y términos desean realizar la monitorización. Y ofrecer una interfaz web sencilla en la que puedan consultar los resultados y recuperar la información para poder trabajar posteriormente con ella (es decir, se debe brindar la capacidad de descargar los datos en algún tipo de fichero con información estructurada como CSV, JSON o XML).</p>
</div>
<div class="paragraph">
<p>El <em>back-end</em> de la aplicación deberá utilizar la experiencia de los experimentos anteriores para poder repetir los resultados obtenidos. Por tanto, deberá ser capaz de recuperar tuits de manera ininterrumpida a partir de algún streaming de datos con el objetivo de tener constantemente la información necesaria para poder ejecutar los proyectos de los usuarios. Además, debe ser capaz de comunicarse con software de aprendizaje automático y crear (o reutilizar) modelos de clasificación <em>al vuelo</em> para cada uno de los proyectos generados.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requisitos_del_sistema">5.1.2. Requisitos del Sistema</h4>
<div class="sect4">
<h5 id="_requisitos_funcionales">Requisitos Funcionales</h5>
<table id="user-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 13. Requisitos de Usuario - R1.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crear cuenta en el Sistema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe ser capaz de crear una cuenta en el sistema mediante la inserción de información básica como: <strong>e-mail</strong>, <strong>nombre</strong> y <strong>contraseña</strong> a través de un formulario de registro disponible en la aplicación web.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identificarse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todo aquel usuario con una cuenta creada en el sistema, deberá ser capaz de identificarse a través de un formulario de <em>login</em> accesible desde la aplicación web.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crear proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe ser capaz de crear un proyecto sobre el que obtener datos geolocalizados aportando de manera sencilla toda la información necesaria para su evaluación: idioma, palabras a monitorizar, área local y global y fecha de evaluación.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selección de <em>bounding boxes</em> de manera gráfica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe ser capaz de seleccionar <em>bounding boxes</em> de manera gráfica a través de un mapa.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluar un proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe ser capaz de evaluar un proyecto para las fechas seleccionadas en el momento de su creación.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descargar resultados de ejecución</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe disponer de un mecanismo para descargar los datos de cada ejecución en, al menos, formato XML y JSON.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acceso a histórico de proyectos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe tener acceso a su historial de proyectos a través de la aplicación web. Deberá ser capaz de reevaluar un proyecto anterior o consultar su información.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cerrar sesión</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario deberá poder cerrar su sesión en la aplicación de manera sencilla a través de la interfaz web.</p></td>
</tr>
</tbody>
</table>
<table id="project-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 14. Requisitos a nivel de Proyecto - R2.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fechas de ejecución</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los proyectos deben tener asignada una fecha sobre la que se desea realizar la ejecución. Esta fecha siempre tiene que ser igual o posterior al día de creación del proyecto (en función de si se quiere trabajar con datos ya almacenados en el sistema o con datos futuros respectivamente).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Múltiples idiomas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los proyectos deben poder trabajar con múltiples idiomas. Cómo mínimo se debe ofrecer la posibilidad de trabajar con <strong>inglés</strong> y <strong>español</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Términos a monitorizar personalizables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los proyectos deben poder trabajar sobre una lista de términos propuesta por el usuario y encontrar y geolocalizar aquellos tuits que los contengan. Estos términos se deberán añadir en el momento de la creación del proyecto y deberán cumplir unas condiciones concretas: se debe incluir una fila por cada término que se desee monitorizar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Localización local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los proyectos deben ser capaces de trabajar sobre un área local de la que obtener tuits.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Localización global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">De manera análoga al requisito de localización local, los proyectos debe ser capaces también de trabajar con otras áreas en los que se puedan encontrar tuits escritos en el mismo idioma seleccionado. De esta manera se aportará al sistema de los mecanismos adecuados para poder buscar términos discriminativos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reevaluar un proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El sistema debe ofrecer la posibilidad de reevaluar un proyecto a partir de una nueva fecha de ejecución que cumpla las mismas condiciones que las establecidas en el momento de su creación (se debe seleccionar una fecha igual o posterior a la del momento de la reevaluación).</p></td>
</tr>
</tbody>
</table>
<table id="execution-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 15. Requisitos a nivel de Ejecución - R3.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exhaustividad variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Las ejecuciones deben poder trabajar con diferentes niveles de exhaustividad con el objetivo de procesar más o menos tuits a distintos niveles de confianza.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exportar resultados</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los resultados de una ejecución deben poder ser exportados a <strong>XML</strong> y <strong>JSON</strong>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_requisitos_no_funcionales">Requisitos No Funcionales</h5>
<table id="information-retrival-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 16. Requisitos de acceso a la información - RNF1.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recolección de datos de manera ininterrumpida</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El sistema deberá de crear un flujo de comunicación constante que abastezca de información ininterrumpidamente.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recolección de datos parametrizable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se deberá de trabajar con un sistema de <em>streaming</em> de datos que acepte parámetros para devolver información de manera selectiva.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilización de un sistema de <em>streaming</em> que aporte más de un 1% de los datos disponibles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Con el objetivo de poder ofrecer el mejor servicio posible, será necesario trabajar con un sistema de <em>streaming</em> que sea capaz ofrecer el mayor número de datos posibles, es decir, que no limite como en el caso de la API Streaming de Twitter, su flujo a únicamente un 1% del total del <em>streaming</em> público.</p></td>
</tr>
</tbody>
</table>
<table id="security-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 17. Requisitos de Seguridad - RNF2.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La aplicación deberá funcionar sobre <strong>HTTPS</strong> y <strong>SSL</strong> mediante un certificado válido que asegure que la información no pueda ser interceptada por terceras partes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hashing para las contraseñas de usuario</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Las contraseñas de los usuarios deberán ser <em>hasheadas</em> mediante el algoritmo <strong>bcrypt</strong>.</p></td>
</tr>
</tbody>
</table>
<table id="technologies-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 18. Requisitos Tecnológicos - RNF3.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se utilizará el lenguaje de programación <strong>Scala</strong> con el objetivo de aprovechar la experiencia previa de la etapa de experimentación y prototipado. Su soporte para programación funcional dará al sistema la flexibilidad necesaria en materia de escalabilidad y concurrencia de cara al futuro.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play! Framework</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play! será el framework web utilizado para desarrollar la aplicación. Su soporte nativo para Scala, desarrollo de trabajos asíncronos e imposición de la arquitectura <strong>Modelo-Vista-Controlador</strong> encaja a la perfección con los requisitos del sistema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF3.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vowpal Wabbit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vowpal Wabbit y su ejecución como <em>daemon</em> del sistema, velocidad y buenos resultados en la etapa de prototipado, será el software de aprendizaje automático utilizado.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF3.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mercurial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se utilizará Mercurial como sistema de control de versiones distribuido apoyado sobre <strong>Bitbucket</strong> como hosting del proyecto. Mercurial es un SCVD similar a Git, pero que simplifica varias de las acciones habituales en el flujo de trabajo de un desarrollador: <code>pull</code>, <code>push</code>, <code>merge</code>, etc. A pesar de no tener un sistema de ramas tan potente como Git, permite un funcionamiento <em>similar</em> mediante el uso de <strong>bookmarks</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF3.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cola de mensajes con características TTL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La implementación del estándar AMQP seleccionada, deberá ofrecer la capacidad de seleccionar el <strong>Time To Live</strong> tanto a nivel de cola como a nivel de mensaje, para evitar que se acumulen excesivos tuits en el sistema de colas. Para ello, lo ideal es que cada mensaje expire en el mismo momento de llegar a la cola a no ser que algún consumidor este disponible para procesarlo.</p></td>
</tr>
</tbody>
</table>
<table id="storage-requirements" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 19. Requisitos de Almacenamiento - RNF4.x</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Código</th>
<th class="tableblock halign-left valign-top">Nombre del Requisito</th>
<th class="tableblock halign-left valign-top">Descripción del Requisito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF4.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48h de tuits.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debido a que los experimentos realizados han funcionado bien con datos recogidos en periodos de 24 horas, se almacenarán datos únicamente sobre periodos de 48h. eliminando todos aquellos tuits más antiguos con el objetivo de minimizar el tamaño de disco utilizado.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RNF4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Máximo número de tuits por ejecución.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Para prevenir un abuso de la capacidad de disco, que podría llegar a almacenar ficheros de cientos de megabytes en resultados, es necesario limitar el número máximo de tuits que se podrán guardar por ejecución para generar los ficheros XML y JSON. Este valor se deberá calcular de manera experimental, pero el fichero de resultados no debería ser superior a <strong>~200MB</strong>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_análisis_de_casos_de_uso_y_escenarios">5.1.3. Análisis de casos de uso y escenarios</h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/use-cases/user-managements.png" alt="user managements">
</div>
<div class="title">Figure 6. Casos de Uso para la Gestión de Usuarios</div>
</div>
<table id="cu-user-system-1-1" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 20. CU Usuario - Gestión Usuarios 1.1 Crear cuenta en el sistema</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en la página principal de la aplicación y no dispone de una cuenta de usuario en el sistema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá completado satisfactoriamente el proceso de creación de cuenta y podrá hacer <em>login</em> en el sistema de manera satisfactoria.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Situándose en la pantalla de inicio de la aplicación, el usuario accederá al formulario de creación de cuenta mediante un enlace o cualquier otro componente de la interfaz de usuario que alerte gráficamente de que se puede crear una nueva cuenta de usuario. Una vez en el formulario, se pedirán datos básicos como: <strong>e-mail</strong>, <strong>nombre</strong> y <strong>contraseña</strong> (con su correspondiente confirmación). Al rellenar el formulario, el sistema deberá procesar la petición y notificar al usuario de que su cuenta se ha creado con éxito.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Si el usuario introduce valores incorrectos en algunos de los campos, el sistema deberá aportar un mecanismo que alerte del error y vuelva a mostrar el formulario de registro.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.1</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-system-1-2" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 21. CU Usuario - Gestión Usuarios 1.2 Identificarse en el sistema</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe tener una cuenta ya creada en el sistema, no debe estar identificado y debe estar situado en la página de inicio de la aplicación.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá podido identificarse satisfactoriamente y acceder a su <strong>dashboard</strong> de proyectos y evaluaciones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desde la pantalla principal de la aplicación, el usuario podrá acceder al formulario de identificación mediante un enlace o elemento identificativo a nivel gráfico en la interfaz web. La página de identificación constará de un pequeño formulario donde el usuario pueda insertar su <strong>e-mail</strong> y <strong>contraseña</strong>. Una vez identificado correctamente, el sistema redireccionará al usuario a su <strong>dashboard</strong> de proyectos y ejecuciones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En caso de que las credenciales introducidas por el usuario sean incorrectas, el sistema mostrará sobre el mismo formulario de identificación que existe un problema con las credenciales indicando que no son válidas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.2</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-system-1-3" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 22. CU Usuario - Gestión Usuarios 1.3 Cerrar sesión en el sistema</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra identificado en el sistema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá conseguido cerrar su sesión actual en el sistema y estará situado en la página de inicio.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estando el usuario identificado en el sistema, y siendo la acción accesible desde cualquier punto de la aplicación a través de un menú superior o elemento gráfico permanente, se podrá seleccionar <em>Cerrar sesión</em> sobre la sesión actual del usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En caso de no poder completar la acción, se deberá notificar al usuario de que ha existido un error a la hora de cerrar su sesión actual.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.8</p></td>
</tr>
</tbody>
</table>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/use-cases/projects-management.png" alt="projects management">
</div>
<div class="title">Figure 7. Casos de Uso para la Gestión de Proyectos</div>
</div>
<table id="cu-user-project-2-1" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 23. CU Usuario - Gestión de Proyectos 2.1 Crear Proyecto</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra identificado y situado en su <strong>dashboard</strong> de proyectos y ejecuciones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario tendrá un nuevo proyecto creado en su cuenta.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desde la pantalla de dashboard, el usuario podrá acceder a la creación de un nuevo proyecto mediante un elemento gráfico visible en la interfaz web que lo conducirá a un formulario de creación. En este formulario se deberá completar información básica como: <strong>nombre</strong>, <strong>fecha</strong>, <strong>área local y global</strong>, <strong>términos a monitorizar</strong> e <strong>idioma</strong> para el nuevo proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En caso de introducir valores incorrectos en el formulario de creación, el sistema deberá notificar sobre el mismo formulario qué errores existen y que no se ha podido completar el proceso de creación.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.3</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-1-1" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 24. CU Usuario - Gestión de Proyectos 2.1.1 Seleccionar idioma</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en el formulario de creación de proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá seleccionado el idioma del proyecto satisfactoriamente.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En el momento de la creación del proyecto, se deberá mostrar un componente visual que permita al usuario seleccionar el idioma del proyecto a partir de una lista de opciones predefinidas. Como mínimo, se deberán mostrar las opciones de <strong>inglés</strong> y <strong>español</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.2</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-1-2" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 25. CU Usuario - Gestión de Proyectos 2.1.2 Añadir términos a monitorizar</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en el formulario de creación de proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá seleccionado una lista de términos a monitorizar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario dispone de un campo en el formulario de creación de proyectos en el que puede seleccionar un fichero de su disco duro para introducir las palabras o términos que desea monitorizar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferiblemente, se debería realizar un análisis del fichero en el momento en que el usuario realiza la subida del mismo para asegurar que cumpla con el formato establecido. En caso de no hacerlo, habría que realizar la notificación en el punto de ejecución del proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.3</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-1-3" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 26. CU Usuario - Gestión de Proyectos 2.1.3 Seleccionar área local</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en el formulario de creación de proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá seleccionado la localización local sobre la que desea realizar la ejecución.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En el formulario de creación de un nuevo proyecto, el usuario podrá seleccionar de manera gráfica a través de un mapa, las localizaciones sobre las que desea realizar la monitorización.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.4; R2.4</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-1-4" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 27. CU Usuario - Gestión de Proyectos 2.1.4 Seleccionar área global</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en el formulario de creación de proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá seleccionado las localizaciones globales que ayudarán a identificar términos del área local.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En el formulario de creación de un nuevo proyecto, el usuario podrá seleccionar de manera gráfica a través de un mapa, las localizaciones globales que ayudarán a reforzar el conocimiento sobre las áreas locales.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aunque no exista ninguna restricción a la hora de señalar las localizaciones globales, se debería indicar al usuario que las localizaciones globales deben ser territorios donde se hable el mismo idioma que en los territorios seleccionados para el área local.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.4; R2.5</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-1-5" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 28. CU Usuario - Gestión de Proyectos 2.1.5 Establecer fecha de ejecución</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en el formulario de creación de proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá establecido una fecha para la ejecución del proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">En el formulario de creación de un nuevo proyecto el usuario deberá seleccionar, a través de un componente diseñado para tal fin (un calendario o similar), la fecha para realizar la ejecución del proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se deberá utilizar algún mecanismo que indique al usuario que no debe seleccionar fechas anteriores al momento actual en el que realiza la creación (por ejemplo, deshabilitando los días anteriores, en caso de tratarse de un componente de tipo Calendario).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.5; R2.1; R.6</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-2" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 29. CU Usuario - Gestión de Proyectos 2.2 Acceder al histórico de proyectos</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario está identificado correctamente en el sistema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario es capaz de visualizar el histórico de proyectos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desde la página del <strong>dashboard</strong> principal del usuario se debe poder acceder a una sección de <strong>Proyectos</strong> donde se recojan todos los proyectos realizados por el usuario así como una breve descripción de sus características.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.7</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-2-2-1" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 30. CU Usuario - Gestión de Proyectos 2.2.1 Consultar proyecto anterior</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario está visualizando el histórico de Proyectos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario está visualizando la vista en detalle de un proyecto anterior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario debe tener un enlace en la página del histórico de proyectos que le permita consultar los detalles del Proyecto así como realizar alguna modificación o reevaluación.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.7; R2.6</p></td>
</tr>
</tbody>
</table>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/use-cases/execution-management.png" alt="execution management">
</div>
<div class="title">Figure 8. Casos de Uso para la Gestión de Ejecuciones</div>
</div>
<table id="cu-user-project-3-1" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 31. CU Usuario - Gestión de Ejecuciones 3.1 Evaluar proyecto</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se encuentra en la vista detallada de un proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá realizado una ejecución con éxito.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario deberá poder ejecutar un proyecto para las fechas indicadas en el momento de su creación. Para ello, se deberá de indicar de manera gráfica cuando una ejecución es posible y los dos mecanismos para empezar y detener dicha ejecución.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Será posible también iniciar la ejecución de un proyecto directamente desde el <strong>dashboard</strong> de proyectos mediante un enlace en la zona del resumen de características.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferiblemente, la ejecución de un proyecto se deberá realizar en una vista independiente de la vista detallada del proyecto donde se origine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.5</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-3-2" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 32. CU Usuario - Gestión de Ejecuciones 3.2 Consultar resultados de ejecución</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario ha realizado una ejecución de manera satisfactoria y se encuentra en el <strong>dashboard</strong> de ejecuciones.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario ha podido descargar satisfactoriamente los resultados de la ejecución.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desde el conjunto de ejecuciones realizadas, se deberá poder acceder a sus resultados obtenidos mediante un enlace para descargar el fichero de resultados en formato <strong>XML</strong> o <strong>JSON</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R1.6; R3.2</p></td>
</tr>
</tbody>
</table>
<table id="cu-user-project-3-3" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 33. CU Usuario - Gestión de Ejecuciones 3.3 Reevaluar proyecto</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Precondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario se debe de encontrar en la vista del histórico de proyectos.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Postcondiciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">El usuario habrá sido capaz de reevaluar un proyecto.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Actores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un usuario.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Descripción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Para reevaluar un proyecto que ya ha sido evaluado anteriormente, será necesario modificar su fecha de evaluación para la nueva fecha sobre la que se desea realizar. En ese momento el sistema volverá a recopilar los datos necesarios para poder realizar una reevaluación. En cuanto los datos estén disponibles, se deberá seguir el mismo escenario presentado para <a href="#cu-user-project-3-1">CU Usuario - Gestión de Ejecuciones 3.1 Evaluar proyecto</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variaciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Notas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Requisitos contemplados</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R2.6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_diseño_e_identificación_preliminar_de_sistemas_y_clases">5.1.4. Diseño e Identificación preliminar de Sistemas y Clases</h4>
<div class="sect4">
<h5 id="_identificación_de_sistemas">Identificación de Sistemas</h5>
<div class="paragraph">
<p>A continuación se realiza una separación del proyecto en varios sistemas y subsistemas. A pesar de que el proyecto será construido en su gran mayoría sobre una única aplicación web, se puede dividir conceptualmente en grupos de clases que trabajarán sobre un objetivo común, como por ejemplo el grupo de clases encargadas de tareas de administración, evaluación, etc.</p>
</div>
<div class="sect5">
<h6 id="_sistema_de_administración">Sistema de Administración</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/administration.png" alt="administration">
</div>
<div class="title">Figure 9. Sistema de Administración</div>
</div>
<div class="paragraph">
<p>El <strong>Sistema de Administración</strong> se encarga de implementar las tareas básicas para la gestión de <strong>usuarios</strong>, <strong>proyectos</strong> y <strong>ejecuciones</strong>. Entre estas tareas, se encuentran las de creación, actualización y borrado; así como el control de las relaciones que se establecen entre los modelos.</p>
</div>
</div>
<div class="sect5">
<h6 id="_sistema_de_evaluación">Sistema de Evaluación</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/evaluation.png" alt="evaluation">
</div>
<div class="title">Figure 10. Sistema de Evaluación</div>
</div>
<div class="paragraph">
<p>En el <strong>Sistema de Evaluación</strong> nos encontramos antes una situación diferente al apartado anterior. Este sistema deberá trabajar conjuntamente con clases propias de la aplicación así como también con un sistema externo que actuará como <em>wrapper</em> sobre el software de aprendizaje automático <strong>Vowpal Wabbit</strong>. La comunicación entre ambos sistemas se realizará a través de un servicio web <strong>RESTful</strong> implementado por el <em>wrapper</em> de Vowpal Wabbit.</p>
</div>
<div class="paragraph">
<p>Por otro lado, el Sistema de Evaluación trabajará en base a <strong>Proyectos</strong> que recibirá a través de su interfaz pública y contendrá a su vez los subsistemas encargados de procesar los datos del proyecto y generar los ficheros de puntuación para entrenar al modelo de aprendizaje automático.</p>
</div>
<div class="paragraph">
<p>Por último, también agrupa el sistema encargado de realizar las ejecuciones sobre los proyectos para obtener el conjunto de resultados geolocalizados en el área de interés. Este sistema se comunicará directamente con el subsistema de aprendizaje automático (<strong>Learning system</strong>) y con el Sistema de Streaming, el cual le proporcionará acceso a un flujo de datos en tiempo real.</p>
</div>
</div>
<div class="sect5">
<h6 id="_sistema_de_streaming">Sistema de Streaming</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/streaming.png" alt="streaming" height="250px">
</div>
<div class="title">Figure 11. Sistema de Streaming</div>
</div>
<div class="paragraph">
<p>El <strong>Sistema de Streaming</strong> será el encargado de implementar la lógica para comunicarse con el Streaming de Twitter y ofrecer tuits al resto de la aplicación. Sus dos principales misiones serán:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Guardar cada tuit recibido en la base de datos.</p>
</li>
<li>
<p>Hacer a su vez de streaming para otros componentes del sistema que necesiten acceso a un streaming de tuits (por ejemplo el sistema de ejecuciones de proyectos necesitará un flujo de datos real para inferir la localización de cada tuit).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dentro de este sistema, se encuentra un último componente denominado <strong>Cleaner</strong> y cuya principal misión será ejecutarse de manera periódica para eliminar todos aquellos tuits de la base de datos recogidos en un plazo mayor de 48h.</p>
</div>
<div class="paragraph">
<p>La interfaz común entre ambos subsistemas será la base de datos en la que se almacenen los tuits obtenidos.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_diseño_de_clases_de_análisis">Diseño de Clases de Análisis</h5>
<div class="sect5">
<h6 id="_sistema_de_administración_2">Sistema de Administración</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/administration-classes.png" alt="administration classes">
</div>
<div class="title">Figure 12. Clases del Sistema de Administración</div>
</div>
<div class="paragraph">
<p>El diagrama de clases para el Sistema de Administración muestra únicamente tres entidades que intentan reflejar lo señalado anteriormente respecto a este mismo sistema. Su única misión será realizar tareas de administración, como por ejemplo la creación de nuevos usuarios y proyectos, agregar a un usuario un proyecto o agregar una ejecución a un proyecto ya existente.</p>
</div>
<div class="paragraph">
<p>Lo más significativo de este diagrama es la representación de las asociaciones entre modelos y su cardinalidad.</p>
</div>
</div>
<div class="sect5">
<h6 id="_sistema_de_evaluación_2">Sistema de Evaluación</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/evaluation-classes.png" alt="evaluation classes">
</div>
<div class="title">Figure 13. Clases del Sistema de Evaluación</div>
</div>
<div class="paragraph">
<p>En el Sistema de Evaluación nos encontramos con el siguiente conjunto de clases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ProjectDataProcessor</code></dt>
<dd>
<p>Esta clase se ejecutará de manera asíncrona y recogerá la lógica para obtener los datos necesarios para la evaluación de un Proyecto. Para ello, utilizará las clases <code>TermFrequencyExtractor</code> para extraer la frecuencia por término de un conjunto de tuits. <code>LogLikelihoodRatioGenerator</code>, que trabajará con dos conjuntos de Término-Frecuencia para tuits pertenecientes al área global y tuits perteneciente al área local; y <code>TweetScoreCalculator</code>, que a partir de las puntuaciones LLR generadas, calculará la puntuación total de un nuevo conjunto de tuits mezcla de área local y global.</p>
</dd>
<dt class="hdlist1"><code>MachineLearningManager</code></dt>
<dd>
<p>Esta clase se utilizará como interfaz común para trabajar con sistemas software de aprendizaje automático. En ella, se recogen los métodos básicos que toda implementación debe definir para poder trabajar correctamente con el sistema:</p>
<div class="ulist">
<ul>
<li>
<p><code>create_training_data</code>: transforma un conjunto de tuits con su puntuación LLR asociada a un input válido para el software de aprendizaje automático que se quiera utilizar. Devolverá una instancia de la clase <code>MachineLearningData</code>.</p>
</li>
<li>
<p><code>create_model</code>: a partir de un objeto de tipo <code>MachineLearningData</code>, creará un modelo de evaluación en el clasificador de tipo <code>MachineLearningModel</code>.</p>
</li>
<li>
<p><code>evaluate</code>: utilizando un objeto de tipo <code>MachineLearningModel</code> y una cadena que represente el tuit a evaluar, devolverá un objeto de tipo <code>MachineLearningPrediction</code> con la predicción devuelta por el clasificador.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>VowpalWabbitManager</code></dt>
<dd>
<p>Implementación de la interfaz anterior para trabajar con el software de aprendizaje automático Vowpal Wabbit. Puesto que Vowpal Wabbit se encontrará en un servicio web externo, será necesario utilizar una biblioteca que permite conectarse a un servicio RESTful para realizar las operaciones necesarias.</p>
</dd>
<dt class="hdlist1"><code>ProjectExecutionService</code></dt>
<dd>
<p>A partir de una instancia de la clase <code>Project</code>, este objeto realizará una ejecución del mismo utilizando los datos almacenados en el modelo del software de aprendizaje automático seleccionado. Esta clase tendrá una asociación con el Sistema de Streaming que le permita obtener un flujo de datos en tiempo real sobre el que realizar la ejecución.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_sistema_de_streaming_2">Sistema de Streaming</h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/systems/streaming-classes.png" alt="streaming classes">
</div>
<div class="title">Figure 14. Clases del Sistema de Streaming</div>
</div>
<div class="paragraph">
<p>El Sistema de Streaming tiene como objetivo comunicarse con un flujo de tuits ofrecido por una API externa y tener la capacidad de procesarlo satisfactoriamente para ofrecer esas mismas capacidades de streaming al resto de la aplicación. La solución que se propone en este caso es utilizar el patrón de diseño <strong>Observer</strong>, en donde la clase <code>TwitterStreamingService</code> realizaría la conexión con el servicio externo, y lanzaría un evento cada vez que recibiera un nuevo tuit. De esta manera, las clases que requieran de un flujo de tuits en tiempo real únicamente tendría que suscribirse como <em>listener</em> de la clase <code>TwitterStreamingService</code>, implementar la interfaz <code>TwitterStreamingListener</code> y redefinir su método <code>on_tweet_received</code> para trabajar con el nuevo tuit recibido.</p>
</div>
<div class="paragraph">
<p>La clase <code>RecollectionService</code>, por ejemplo, implementaría la interfaz anterior para guardar todos los tuits recibidos en la base de datos, actuando así como el recolector de tuits del sistema. Por otro lado, la clase <code>PublicationService</code> realizará una implementación para publicar cada tuit recibido al resto del sistema.</p>
</div>
<div class="paragraph">
<p>Con el objetivo de poder realizar un sistema escalable, el sistema de streaming se ejecutará como un componente externo de la aplicación, puesto que podría presentar problemas a la hora de ejecutar dos instancias de la aplicación con el sistema de streaming integrado (produciendo resultados duplicados en la base de datos por acceder de manera concurrente al mismo flujo de datos).</p>
</div>
<div class="paragraph">
<p>Para comunicar ambos sistemas se utilizará una cola de mensajes (como por ejemplo <strong>RabbitMQ<span class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</span></strong>) que transportará los tuits en un formato intermedio (JSON). En la aplicación web, cada instancia que necesite un flujo de datos necesitará suscribirse a una de las colas para recuperar el mensaje y poder trabajar con él (un caso de uso para esta funcionalidad sería en el momento de ejecutar un proyecto, donde la aplicación web necesitará un flujo en tiempo real de tuits para evaluarlos contra el modelo e identificar aquellos que pertenecen al área local).</p>
</div>
<div class="paragraph">
<p><code>Cleaner</code> es una clase que se ejecutará como <strong>cron</strong> de la aplicación de manera periódica en plazos de 24 horas. Su misión será eliminar tuits más antiguos de 48 horas.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_diseño_de_em_mockups_em_para_interfaces_de_usuario">5.1.5. Diseño de <em>mockups</em> para interfaces de usuario</h4>
<div class="paragraph">
<p>Con el objetivo de crear una interfaz completamente funcional y sencilla de utilizar para el usuario, se han generado una serie de <em>mockups</em> que podrían ayudar en el diseño final de la aplicación.</p>
</div>
<div class="paragraph">
<p>La idea principal es mantener una interfaz de usuario con poco ruido, que muestre únicamente aquellas opciones básicas que el usuario pueda necesitar para realizar cada acción y teniendo en mete que en el futuro se podrían ofrecer operaciones más avanzadas para usuarios especializados utilizando para ello mecanismos más sofisticados.</p>
</div>
<div class="paragraph">
<p>A continuación se muestran un conjunto de <em>mockups</em> para las páginas con una mayor importancia para los usuarios.</p>
</div>
<div class="sect4">
<h5 id="_pantalla_de_inicio_y_login_de_la_aplicación">Pantalla de inicio y login de la aplicación</h5>
<div class="paragraph">
<p>La pantalla de inicio de la aplicación consta de un formulario central donde el usuario deberá introducir sus credenciales si desea poder acceder a su panel de administración.</p>
</div>
<div class="paragraph">
<p>En caso de no tener una cuenta de usuario, se le informa del mecanismo que debe seguir si desea crear una (en este caso, hacer <em>click</em> sobre el enlace informativo).</p>
</div>
<div class="paragraph">
<p>Esta pantalla se mostrará tanto en la página raíz del sitio web para aquellos usuarios sin identificación en el sistema, como cada vez que se intente acceder a una página interior sin haberse identificado previamente.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/mockup/home.png" alt="home">
</div>
<div class="title">Figure 15. Pantalla de login de la aplicación.</div>
</div>
</div>
<div class="sect4">
<h5 id="_pantalla_del_dashboard_de_proyectos">Pantalla del dashboard de Proyectos</h5>
<div class="paragraph">
<p>La pantalla de administración, cuyo objetivo es gestionar el conjunto de proyectos de un usuario, se ha diseñado de tal manera que permita navegar de manera sencilla sobre el histórico de Proyectos, así como disponer de un acceso rápido para crear uno nuevo.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/mockup/dashboard-projects.png" alt="dashboard projects">
</div>
<div class="title">Figure 16. Pantalla que muestra el dashboard del usuario en la sección de proyectos</div>
</div>
<div class="paragraph">
<p>La sección que muestra la información sobre cada proyecto, aglutina también un pequeño resumen con sus características principales:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Nombre</p>
</li>
<li>
<p>Fecha de ejecución</p>
</li>
<li>
<p>Idioma</p>
</li>
<li>
<p>Localización global</p>
</li>
<li>
<p>Localización local</p>
</li>
<li>
<p>Términos a monitorizar</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Además, el color de fondo que acompaña cada sección informa de si el proyecto se puede ejecutar en ese momento (fondo verde y botón para <strong>Comenzar ejecución en tiempo real</strong>) o si su fecha de ejecución ya ha pasado (color de fondo rojo).</p>
</div>
<div class="paragraph">
<p>En la parte superior derecha de cada Proyecto, se presenta un acceso rápido para realizar una edición de sus características.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pantalla_del_dashboard_de_ejecuciones">Pantalla del dashboard de Ejecuciones</h5>
<div class="paragraph">
<p>En el caso del panel de administración de las Ejecuciones de usuario, se muestra una tabla paginada a modo de histórico desde la que es posible consultar los detalles generales de la ejecución así como obtener un enlace a su fichero de resultados.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/mockup/dashboard-executions.png" alt="dashboard executions">
</div>
<div class="title">Figure 17. Pantalla que muestra el dashboard del usuario en la sección de ejecuciones</div>
</div>
</div>
<div class="sect4">
<h5 id="_pantallas_para_la_creación_de_un_nuevo_proyecto">Pantallas para la creación de un nuevo Proyecto</h5>
<div class="paragraph">
<p>Las siguientes imágenes muestran un conjunto de <em>lightboxes</em> que contienen el <em>wizard</em> propuesto para la creación de un nuevo proyecto. La primera imagen contiene el paso número uno, en donde se insertan las características principales del proyecto como su <strong>nombre</strong>, <strong>idioma</strong> o <strong>términos a monitorizar</strong>.</p>
</div>
<div class="paragraph">
<p>Los pasos dos y tres, muestran un mapa en el que el usuario podrá dibujar de manera guiada rectángulos que actuarán como <em>bounding boxes</em> para indicar las áreas local y global sobre las que realizar la ejecución. Un ejemplo real con la interfaz propuesta se puede observar en la aplicación web <strong>B2pick</strong> (ver <a href="#_b2pick_aplicación_web_para_seleccionar_bounding_boxes">B2pick, aplicación web para seleccionar Bounding Boxes</a>).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/mockup/new-project.png" alt="new project" height="650px">
</div>
<div class="title">Figure 18. Lightboxes de creación de un nuevo proyecto</div>
</div>
</div>
<div class="sect4">
<h5 id="_pantalla_de_ejecución">Pantalla de Ejecución</h5>
<div class="paragraph">
<p>Por último, la pantalla de ejecución será el lugar en el que el usuario podrá ejecutar en tiempo real un proyecto y observar qué resultados consigue obtener. Su objetivo principal es ser lo más dinámica y flexible posible para permitir al usuario obtener información inmediata de los resultados de la ejecución. Por tanto, se establecen dos columnas a los laterales de la pantalla (<strong>Dentro</strong> y <strong>Fuera</strong>) donde se irán colocando los tuits que se reciban en función de la localización inferida por el clasificador (se colocarán en la columna de <strong>Dentro</strong> aquellos tuits que el clasificador considere que pertenecen al <strong>área local</strong> y viceversa).</p>
</div>
<div class="paragraph">
<p>Los controles centrales permitirán iniciar y detener la ejecución, y el <em>spinner</em> inferior permitirá al usuario establecer el nivel de confianza que requiere por parte del sistema para etiquetar un tuit como local. Si se indica que el sistema deba tener un grado de confianza muy alto, los resultados para la columna de <strong>Dentro</strong> serán muchos menos, pero su precisión será mucho más elevada.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/analysis/mockup/execution.png" alt="execution">
</div>
<div class="title">Figure 19. Pantalla de ejecución de un proyecto en tiempo real</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diseño_del_sistema">5.2. Diseño del sistema</h3>
<div class="paragraph">
<p>Las siguientes páginas muestran el diseño propuesto para realizar la aplicación web de geolocalización como servicio. Debido a que el objetivo de este capítulo es indicar como se podría integrar en una aplicación web <em>convencional</em> la tecnología estudiada en los capítulos anteriores, se han omitido los detalles acerca de subsistemas y conjuntos de clases que no están relacionados directamente con el problema en cuestión. Específicamente, se han dejado de lado las capas de acceso a datos y las capas de presentación.</p>
</div>
<div class="paragraph">
<p>También es importante señalar que el diseño está pensado para ser implementado utilizando el framework de desarrollo web <strong>Play!</strong> y el lenguaje de programación <strong>Scala</strong>. Las razones de dicha elección, que ya figura como requisito del sistema en la sección de análisis, es que Scala ha sido el lenguaje utilizado para desarrollar los prototipos y experimentos para obtener un algoritmo capaz de inferir la localización de una publicación en medios sociales y su eficacia para tratar con un problema de este tipo, por tanto, ya ha sido probada con anterioridad. Play! es el framework de referencia para realizar aplicaciones web sobre dicho lenguaje, por lo que prácticamente es un requisito implícito al hecho de utilizar Scala como lenguaje principal.</p>
</div>
<div class="paragraph">
<p>A pesar de ello, Play! tiene una serie de características propias que será necesario remarcar para conseguir una mejor comprensión del diseño posterior:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">MVC</dt>
<dd>
<p>Play! adopta de manera muy estricta el patrón de diseño <strong>Modelo-Vista-Controlador</strong>. Por tanto la aplicación se estructura, de manera general, en un conjunto de acciones recogidas en un controlador que se encargan de vincular vistas con modelos de la aplicación. En los siguientes diagramas, los ficheros y clases que representarían las vistas y controladores se han omitido, puesto que el objetivo de esta sección es mostrar como podría ser aplicable e integrable en una aplicación web la tecnología propuesta en los prototipos y experimentos anteriores.</p>
<div class="paragraph">
<p>La filosofía de Play! sigue la estela de otros frameworks de desarrollo web muy populares como <em>Ruby on Rails</em> o <em>Django</em>.</p>
</div>
</dd>
<dt class="hdlist1">Tareas asíncronas</dt>
<dd>
<p>A lo largo de los diferentes diagramas se verá la notación <code>«async»</code> acompañando a algunas de las clases. Esto es debido a que Play! tiene soporte nativo para el desarrollo de tareas y trabajos asíncronos como parte de la aplicación web y, por tanto, debido a que en algunos casos las tareas realizadas por el sistema podrían ocupar varias horas, se ha decidido aprovechar esta característica para representar aquellas tareas que se deberían de ejecutar de manera asíncrona para evitar un bloqueo en la interacción del usuario con la aplicación web.</p>
</dd>
<dt class="hdlist1"><code>trait</code>, <code>object</code> y <code>Unit</code></dt>
<dd>
<p>Puesto que la aplicación se desarrollaría utilizando el lenguaje de programación Scala, se ha intentado mantener su propia notación para referirse a aspectos clave del sistema. Con el objetivo de facilitar el seguimiento de los diagramas y evitando que esta notación pueda provocar una falta de entendimiento de los mismos, se recogen de manera breve algunas definiciones de los términos más frecuentes:</p>
<div class="ulist">
<ul>
<li>
<p><code>trait</code>: De manera simplificada, se podría entender como un concepto equivalente a las <strong>interfaces</strong> en Java.</p>
</li>
<li>
<p><code>object</code>: Cualquier clase acompañada de esta notación, se ejecutará como un <strong>Singleton</strong> por parte del sistema.</p>
</li>
<li>
<p><code>Unit</code>: Equivalente al concepto de <code>void</code> en Java.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_diagrama_de_paquetes">5.2.1. Diagrama de paquetes</h4>
<div class="paragraph">
<p>El siguiente diagrama de paquetes muestra de manera general la relación entre los diferentes grupos de clases de la aplicación web ordenadas de manera conceptual en función de sus responsabilidades.</p>
</div>
<div class="paragraph">
<p>El paquete de <code>models</code> recoge las clases que representan los modelos de la aplicación. En él podremos encontrar las clases <code>User</code>, <code>Project</code>, <code>Execution</code>, <code>Tweet</code> o <code>BoundingBox</code>.</p>
</div>
<div class="paragraph">
<p>En <code>evaluation</code> se agrupan las clases encargadas de realizar la lógica de evaluación de un proyecto: obtención de datos de entrenamiento, cálculo e implementación de los algoritmos de geolocalización o ejecución de un proyecto.</p>
</div>
<div class="paragraph">
<p>El paquete <code>learning</code> contiene las clases encargadas de realizar la comunicación con el software de aprendizaje automático.</p>
</div>
<div class="paragraph">
<p>En <code>streaming</code> se recogen las clases encargadas de suscribirse a la cola de mensajes para recuperar los tuits recibidos por el sistema externo de Streaming y hacerlos accesibles para el resto de la aplicación.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/packages.png" alt="packages">
</div>
<div class="title">Figure 20. Diagrama de paquetes</div>
</div>
</div>
<div class="sect3">
<h4 id="_diagramas_de_clases">5.2.2. Diagramas de clases</h4>
<div class="paragraph">
<p>A continuación, se muestran una serie de diagramas que reflejan la organización de las clases para poder implementar los aspectos más interesantes de la aplicación web.</p>
</div>
<div class="paragraph">
<p>En primer lugar, la figura <a href="#streaming-system-diagram">Diagrama de clases del servicio externo de Streaming</a> muestra el sistema externo (implementado en Scala) encargado de comunicarse con el <em>firehose</em> de Twitter. El paquete <code>com.bonobo.streaming.retriever</code> contiene las clases encargadas de comunicarse con el servicio de streaming y hacer accesibles al resto de la aplicación los tuits obtenidos. Como se comentó en la sección de Análisis, se hace uso del patrón de diseño <strong>Observer</strong> para permitir que múltiples instancias puedan hacer uso del mismo flujo de datos.</p>
</div>
<div class="paragraph">
<p>El resto de paquetes representan la estructura convencional de cualquier sistema informático:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.bonobo.streaming.main</code>: Contiene la clase que inicia la ejecución del sistema.</p>
</li>
<li>
<p><code>com.bonobo.streaming.configuration</code>: Contiene la clase de configuración que permite acceder a las credenciales de Twitter y la configuración de la base de datos.</p>
</li>
<li>
<p><code>com.bonobo.streaming.db</code>: Contiene la clase encargada de serializar los modelos a la base de datos.</p>
</li>
<li>
<p><code>com.bonobo.streaming.model</code>: Contiene el modelo de la aplicación: <code>Tweet</code>.</p>
</li>
</ul>
</div>
<div id="streaming-system-diagram" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/streaming-system.png" alt="streaming system">
</div>
<div class="title">Figure 21. Diagrama de clases del servicio externo de Streaming</div>
</div>
<div class="paragraph">
<p>En cuanto al diseño de la aplicación web, el primer paso será comentar el paquete encargado de gestionar los modelos que contienen la lógica de negocio de la aplicación. En <a href="#models-package-diagram">Diagrama de clases del paquete de modelos</a> se muestran las relaciones entre todos los modelos, pudiendo observar como la clase <code>Project</code> ocupa una posición central en el diseño, manteniendo una relación <strong>1..</strong>* con la clase <code>User</code>, lo que indica que todos los proyectos deben pertenecer a un único usuario, pero un usuario puede disponer de múltiples proyectos.</p>
</div>
<div class="paragraph">
<p>Además, todos los proyectos tendrán una relación <strong>1..</strong>* con la clase <code>BoundingBox</code>, puesto que los proyectos vienen definidos por un conjunto de bounding boxes que definen tanto sus localizaciones globales o locales. La clase <code>BoundingBox</code> contiene la información relativa a las coordenadas del área que representan, así como una operación que será de gran utilidad (en base a la experiencia en el desarrollo de prototipos) para determinar cuando un par de coordenadas se encuentran contenidas en el bounding box actual.</p>
</div>
<div class="paragraph">
<p>La clase <code>Execution</code> también mantiene una relación con la clase <code>Project</code>, en la que se establece que todas las ejecuciones deben pertenecer a un único proyecto, pero este puede contener múltiples ejecuciones (debido al requisito para poder reevaluar un proyecto). <code>Execution</code>, tiene como cometido reflejar los resultados de la ejecución sobre un proyecto, manteniendo una referencia a sus resultados generados y una información general acerca de la ejecución.</p>
</div>
<div class="paragraph">
<p>La clase <code>Tweet</code> se utilizará como entidad para el intercambio de la información recogida a partir del servicio de Streaming. Contiene los atributos necesarios para trabajar con un tuit y realizar las operaciones necesarias.</p>
</div>
<div class="paragraph">
<p>Por último, <code>Term</code> es una representación de los términos que se extraerán más adelante en las tareas de evaluación. En un principio, es un modelo muy sencillo que únicamente sirve como abstracción sobre la cadena en plano que contiene el término extraído. Se decidió su diseño debido a que es una entidad propensa a gozar de un mayor número de responsabilidades en el futuro en caso de que aparezcan nuevos tipos de términos, o se deban realizar operaciones más complejas sobre ellos que una mera comparación de cadenas.</p>
</div>
<div id="models-package-diagram" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/models-package.png" alt="models package">
</div>
<div class="title">Figure 22. Diagrama de clases del paquete de modelos</div>
</div>
<div class="paragraph">
<p>El paquete <code>evaluation</code> recoge las clases implicadas en el proceso de generación de los algoritmos de inferencia así como la clase encargada de realizar las ejecuciones de los proyectos.</p>
</div>
<div class="paragraph">
<p><code>ProjectDataProcessor</code> se sitúa como la pieza central en el proceso de evaluación, se ejecutará de manera asíncrona y será la encargada de invocar al resto de clases encargadas de construir los modelos de clasificación. <code>TermFrequencyExtractor</code> será la clase encargada de extraer la frecuencia de apariciones de cada término para un conjunto de tuits definidos por un objeto <code>QueryBuilder</code>. Este tipo de objetos serán capaces de construir una sentencia SQL para recuperar tuits de la base de datos. El tipo de <em>query</em> que deberán de construir se basa en el tipo de proyecto a evaluar y las localizaciones sobre las que se quieren recuperar (<em>bounding boxes</em> locales o globales) tuits. La razón para diseñar esta clase es la aplicación del <strong>principio de responsabilidad única<span class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</span></strong>, donde se establece que, idealmente, cada clase debe ser diseñada para ocuparse de una única responsabilidad.</p>
</div>
<div class="paragraph">
<p>En <code>TermFrequencyExtractor</code>, con el objetivo de no recuperar una cantidad de objetos en memoria demasiado elevada, se realizará un procesamiento por lotes, analizando de cada vez una cantidad <code>n</code> de tuits. Esta clase devolverá como resultado de la extracción un Hash que relacione una instancia de <code>Term</code> (que actúa como clave) con una frecuencia (representada por un número entero).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/evaluation-package.png" alt="evaluation package">
</div>
<div class="title">Figure 23. Diagrama de clases del paquete de evaluación</div>
</div>
<div class="paragraph">
<p>A partir de los mapas de término-frecuencia obtenidos por <code>TermFrequencyExtractor</code>, se hará uso de la clase <code>LikelihoodRatioGenerator</code> para calcular la puntuación de cada término utilizando el método estadístico Log Likelihood Ratio. El resultado de su ejecución, será un mapa que asocie cada término con su puntuación LLR obtenida (representada por un objeto <code>Double</code>).</p>
</div>
<div class="paragraph">
<p>En <code>TweetsScoreGenerator</code>, se hará uso de las puntuaciones obtenidas por el proceso anterior, y se utilizará un nuevo objeto <code>QueryBuilder</code> que permita recuperar tuits para las localizaciones globales y locales del proyecto con el objetivo de calcular la puntuación de cada tuit en función de los términos que contiene. Para extraer los términos de cada tuit, se utilizará un objeto <code>ExtractionFilter</code>, el cual se implementará utilizando un patrón de diseño <strong>Decorator</strong> que permita reflejar el mismo diseño explicado en <a href="#_sistema_de_filtros">Sistema de filtros</a>. La puntuación de cada tuit, se almacenará como un nuevo objeto en la base de datos (<code>TweetScoreContainer</code>) que mantenga una referencia al identificador del tuit analizado, así como una puntuación representada por un objeto <code>Double</code> y una referencia al proyecto sobre el que se está realizando la evaluación.</p>
</div>
<div class="paragraph">
<p>Las últimas clases pertenecientes al paquete de evaluación son: <code>ProjectExecutionService</code>, <code>ProjectExecutionResultContainer</code> y la jerarquía de clases encargadas de tareas de exportación. La primera, se trata de una clase que se ejecutará de manera asíncrona e implementará la lógica necesaria para realizar la ejecución de un proyecto en base a las evaluaciones realizadas en los pasos anteriores. Así pues, a partir de un objeto <code>Project</code> y utilizando el paquete de <code>streaming</code>, realizará la evaluación de cada tuit recibido sobre el modelo de clasificación vinculado al proyecto e implementado como parte del paquete de <code>learning</code>.</p>
</div>
<div class="paragraph">
<p>Cada tuit positivamente evaluado se almacenará, junto con su <code>Execution</code> asociada, en el objeto <code>ProjectExecutionResultContainer</code>. Los objetos <code>Execution</code> serán instanciados una vez comenzado el proceso de ejecución en <code>ProjectExecutionService</code> y se irán actualizando con los datos de la ejecución en curso.</p>
</div>
<div class="paragraph">
<p>La jerarquía de clases encargadas de la exportación, haría uso de los objetos <code>ProjectExecutionResultContainer</code> relacionados con el objeto <code>Execution</code> recibido como parámetro a la hora de crear una nueva instancia del exportador. En función del tipo de exportación que se quiera realizar se deberá utilizar una u otra de las subclases que implementan el <code>trait</code> de <code>ExecutionResultExporter</code>. El resultado de invocar el método <code>export</code> será la generación de un fichero JSON o XML que contenga los objetos <code>Tweet</code> relacionados a cada <code>ProjectExecutionResultContainer</code> serializados de acuerdo al formato seleccionado. El método retornará el <em>path</em> hacia el fichero generado para facilitar su descarga.</p>
</div>
<div class="paragraph">
<p>En el paquete de <code>learning</code> se agrupan las clases que tienen como misión comunicarse con el software de aprendizaje automático y recoger toda la lógica referente a la creación y evaluación de nuevos modelos. La clase <code>MachineLearningManager</code> sirve como interfaz pública y como la fachada a utilizar por el resto de la aplicación, relegando la implementación de cada método sobre la propia clase <code>...Manager</code> de cada software de aprendizaje automático que se pueda utilizar como parte del sistema. Los métodos recogidos por esta clase son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createModel</code>: creará un modelo de evaluación para el proyecto pasado como parámetro. La clase <code>MachineLearningModel</code> representa la entidad de un modelo de aprendizaje automático y únicamente contiene un <code>id</code> que permita identificar al modelo y el proyecto al que pertenece. Su misión es crear una entidad común para representar los modelos de cualquier software de aprendizaje automático.</p>
</li>
<li>
<p><code>addTrainingData</code>: añadirá la un nuevo ejemplo al modelo de aprendizaje automático.</p>
</li>
<li>
<p><code>evaluate</code>: evaluará el tuit recibido sobre el modelo asociado al proyecto que se pasa como parámetro. Se devolverá una instancia de <code>MachineLearningPrediction</code> que utilizará la propiedad <code>isPositive</code> para indicar si el tuit pertenece o no al área de estudio.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En el caso de <code>VowpalWabbitManager</code> se deberá de realizar una comunicación con el servicio web RESTful que albergará el ejecutable de Vowpal Wabbit.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/learning-package.png" alt="learning package">
</div>
<div class="title">Figure 24. Diagrama de clases del paquete de aprendizaje automático</div>
</div>
<div class="paragraph">
<p>El paquete de <code>streaming</code> contiene las clases que esperan comunicarse con el sistema de cola de mensajes utilizado para transferir los tuits del sistema externo a la aplicación web. Además, su segunda responsabilidad es proveer un mecanismo que permita hacer accesibles esos mismos tuits al resto de clases de la aplicación. Para ello, el sistema propuesto se basa en una implementación del patrón de diseño <strong>Observer</strong> muy similar a lo propuesto también en el servicio externo de recolección de tuits.</p>
</div>
<div class="paragraph">
<p>En este caso, la clase <code>TwitterStreamingSubscriber</code> se ejecutará de manera asíncrona y estará suscrita a la cola de mensajes esperando recibir nuevos mensajes. Cada vez que recibe un nuevo mensaje, recorrerá la lista de listeners que tenga suscritos e invocará al método <code>onTweetReceived</code> con el nuevo tuit recibido. Todos los listeners de la clase <code>TwitterStreamingSubscriber</code> deberán implementar el <code>trait</code>: <code>TwitterStreamingListener</code>. En este caso, un ejemplo podría ser la clase <code>ProjectExecutionListener</code>, que se podría utilizar a la hora de ejecutar un nuevo proyecto, y en donde su método <code>onTweetReceived</code> realizaría la comunicación con el software de aprendizaje automático que evaluaría el nuevo tuit recibido en directo.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/streaming-package.png" alt="streaming package">
</div>
<div class="title">Figure 25. Diagrama de clases del paquete de streaming</div>
</div>
</div>
<div class="sect3">
<h4 id="_diagrama_de_despliegue">5.2.3. Diagrama de despliegue</h4>
<div class="paragraph">
<p>El diagrama de despliegue en <a href="#deployment-diagram">Diagrama de despliegue</a> muestra la propuesta para desplegar el sistema presentado en los diagramas previos en un conjunto de servidores alojados, principalmente, en un proveedor de servicios Cloud. Puesto que lo habitual en este tipo de servicios es ofrecer unidades de procesamiento individuales<span class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</span> (de diversos tamaños y características) se ha intentado representar cada pieza independiente del sistema en un servidor que se instalaría en cada una de las unidades de procesamiento adquiridas.</p>
</div>
<div id="deployment-diagram" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/design/deployment.png" alt="deployment">
</div>
<div class="title">Figure 26. Diagrama de despliegue</div>
</div>
<div class="paragraph">
<p>El servidor web <strong>Apache</strong> serviría a su vez como balanceador de carga sobre el conjunto de aplicaciones web que podrían estar instaladas en varios servidores independientes. El proceso para configurar Apache como servidor <em>front end</em> de la aplicación podría seguir los pasos propuestos en la propia documentación del framework Play!: <a href="http://www.playframework.com/documentation/2.4.x/HTTPServer">http://www.playframework.com/documentation/2.4.x/HTTPServer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_desarrollo_dirigido_por_pruebas">5.2.4. Desarrollo dirigido por pruebas</h4>
<div class="paragraph">
<p>Aunque el objetivo de este capítulo es mostrar un diseño capaz de ofrecer la posibilidad de aplicar la tecnología estudiada en los capítulos anteriores dentro de la estructura de una aplicación web <em>convencional</em>, a continuación se muestra una reflexión acerca del proceso para desarrollar un sistema basado en el diseño anterior de manera que presente el mayor grado de fiabilidad.</p>
</div>
<div class="paragraph">
<p>Existe mucha literatura acerca de los beneficios de realizar desarrollo dirigido por pruebas (conocido como <strong>Test Driven Development<span class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</span></strong> en inglés). Principalmente, es un proceso que permite una mejor compresión del sistema que se va a implementar, puesto que es necesario conocer los requisitos en profundidad para poder establecer las pruebas antes de comenzar la implementación <em>per se</em>. Además, permite añadir un mayor número de capas de seguridad que facilitarán el desarrollo de un código más robusto (y, por supuesto, aporta el único mecanismo posible para realizar labores de <strong>Refactoring</strong> sin riesgo de introducir nuevos <em>bugs</em> en el sistema).</p>
</div>
<div class="paragraph">
<p>A la hora de desarrollar la aplicación se recomendaría encarecidamente el uso de esta metodología, acompañada del framework <strong>ScalaTest<span class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</span></strong>, para ejecutar pruebas unitarias de todos los modelos y clases anteriormente descritas de manera automática.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_planificación_y_presupuesto">5.3. Planificación y presupuesto</h3>
<div class="paragraph">
<p>Con el objetivo de aportar un estimación acerca del tiempo necesario para realizar un sistema basado en el diseño anterior, a continuación se ofrece una planificación y presupuesto basada en los siguientes supuestos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debido a que el desarrollo de una aplicación web de estas características siempre estaría sujeta a una mejora continua del producto (para poder captar nuevos usuarios así como mantener a los más antiguos mediante la adición de nuevas funcionalidades), la siguiente planificación muestra los tiempos estimados para desarrollar únicamente los diseños mostrados en la sección anterior (lo que resultaría en el desarrollo del núcleo de la aplicación).</p>
</li>
<li>
<p>Para asegurar un escenario más real que el ofrecido en un Trabajo Fin de Máster, se supondrá que el desarrollo de la aplicación web será realizado por el equipo de I+D+i de una empresa del sector informático. El grupo estará formado por 3 Ingenieros Informáticos, en donde 2 de ellos serán los encargados de llevar el peso del desarrollo, mientras que el tercero hará las funciones de líder del proyecto y tareas de supervisión y diseño generales.</p>
<div class="paragraph">
<p>Los costes por hora para la empresa de los 3 ingenieros están recogidos en <a href="#workers-costs">Costes para la empresa de cada trabajador</a>.</p>
</div>
</li>
<li>
<p>Todos los participantes en el proyecto, habrán sido los encargados de realizar los experimentos y prototipos previos explicados en los puntos anteriores de este proyecto, por lo que se supone que todos ellos tienen un conocimiento en profundidad del problema y sus posibles soluciones.</p>
</li>
</ul>
</div>
<table id="workers-costs" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 34. Costes para la empresa de cada trabajador</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trabajador</th>
<th class="tableblock halign-left valign-top">Coste</th>
<th class="tableblock halign-left valign-top">Años de experiencia</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingeniero Informático 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 euros / hora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingeniero Informático 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 euros / hora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ingeniero Informático 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 euros / hora</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_planificación">5.3.1. Planificación</h4>
<div class="paragraph">
<p>En <a href="#tasks-table">Tareas propuestas para el desarrollo del sistema propuesto</a> se recogen el conjunto de tareas de desarrollo planificadas para realizar la implementación del sistema propuesto. Además, en <a href="#gantt">Diagrama de Gantt para la planificación del diseño propuesto</a> se muestra un diagrama de Gantt donde se puede observar la distribución temporal de las tareas, así como una expresión gráfica de su longitud.</p>
</div>
<div style="page-break-after: always;"></div>
<table id="tasks-table" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 35. Tareas propuestas para el desarrollo del sistema propuesto</caption>
<colgroup>
<col style="width: 7%;">
<col style="width: 30%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#</th>
<th class="tableblock halign-left valign-top">Tarea</th>
<th class="tableblock halign-left valign-top">Duración</th>
<th class="tableblock halign-left valign-top">Predecesora</th>
<th class="tableblock halign-left valign-top">Recursos</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Iteración 1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10,13 días</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preparación del entorno de desarrollo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 horas</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuración y diseño de base de datos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comunicación con el servicio de Firehose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación del sistema de recolección</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integración con RabbitMQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creación del modelo de Proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación de TermFrequencyExtractor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación de LikelihoodRatioGenerator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación de TweetScoreCalculator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuración inicial de controladores, vistas y modelos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versión inicial de pantalla de home</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrospectiva y planificación de la siguiente iteración</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12;10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2;Ing. Informático 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Iteración 2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10,5 días</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creación del formulario de registro de usuarios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creación del formulario de login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lógica front-end para el dashboard de usuarios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formularios para la creación de nuevo Proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instalación y configuración de Vowpal Wabbit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desarrollo del wrapper RESTful sobre Vowpal Wabbit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creación de la clase VowpalWabbitManager y comunicación con el sistema RESTful</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comunicación con RabbitMQ para obtener tuits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación de TwitterStreamingService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrospectiva y planificación de la siguiente iteración</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23;20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2;Ing. Informático 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Iteración 3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7 días</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación de ProjectExecutionService y ProjectExecutionListener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2[50%]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementar interfaz para la presentación de resultados de la ejecución</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2[50%]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lógica para presentar los resultados de la ejecución en formato JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26;27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lógica para presentar los resultados de la ejecución en formato XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26;27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pruebas de aceptación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 horas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ing. Informático 1;Ing. Informático 2;Ing. Informático 3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Para diseñar la planificación, se ha optado por una metodología basada en iteraciones donde se vayan completando historias de usuario independientes que puedan originar que en el fin de cada iteración el sistema se encuentre en un estado estable con la adición de nuevas características.</p>
</div>
<div class="paragraph">
<p>La planificación resultante, en base a los supuestos explicados al comienzo de esta sección, muestra un conjunto de tareas que abarca 27 días de desarrollo útiles, lo que acabaría resultando en, aproximadamente, mes y medio del calendario natural. Alcanzado ese periodo, el sistema desarrollado debería de cubrir la funcionalidad básica recogida a través de los diferentes diagramas del capítulo de Diseño.</p>
</div>
<div class="paragraph">
<p>En la planificación, se ha procurado paralelizar al máximo el conjunto de tareas para potenciar que los dos ingenieros encargados del desarrollo pudieran realizar el máximo número de acciones de manera concurrente. En el caso del <strong>Ingeniero Informático 3</strong>, sus actuaciones se han reducido a las tareas más afines a aspectos de gestión y dirección de proyectos (retrospectiva de cada iteración, planificación de la iteración siguiente, pruebas de aceptación) así como a una de las tareas de desarrollo que podría necesitar de sus 10 años de experiencia en el desarrollo de software (<em>Configuración y diseño de base de datos</em>).</p>
</div>
<div id="gantt" class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/application/planning/gantt.png" alt="gantt" height="650px">
</div>
<div class="title">Figure 27. Diagrama de Gantt para la planificación del diseño propuesto</div>
</div>
<div class="paragraph">
<p>En <a href="#planning-overview">Estadísticas de la planificación del proyecto propuesta</a> se recoge una visión general de la planificación, indicando también el coste total por parte de los trabajadores.</p>
</div>
<table id="planning-overview" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 36. Estadísticas de la planificación del proyecto propuesta</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fecha de inicio</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lunes 30/06/2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fecha de fin</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">miércoles 06/08/2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Duración</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">479 horas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Coste total de los trabajadores</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.347,50 euros</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_presupuesto">5.3.2. Presupuesto</h4>
<div class="paragraph">
<p>Además del costo por horas de los trabajadores, será necesario tener en cuenta las siguientes variables a la hora de preparar un presupuesto para realizar el proyecto:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Firehose de Twitter</dt>
<dd>
<p>Uno de los requisitos principales del proyecto es la obtención de un flujo de datos constante sobre el streaming público de Twitter. Para ello, las opciones pasan por contratar a un distribuidor oficial de Twitter con permiso para realizar tareas de <em>firehosing</em> comerciales a partir de su streaming (Twitter únicamente aporta un 1% de su flujo de datos público a través de su API de Streaming y el acceso a su servicio de Firehose está restringido a un número muy reducido de clientes<span class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</span>).</p>
<div class="paragraph">
<p>Los precios ofrecidos por este tipo de distribuidores son, aparentemente, bastante flexibles y ajustables a la cantidad de datos necesarios. Por ello, no ha sido posible obtener de manera oficial ninguna información acerca de los precios ofrecidos por los distribuidores más conocidos: <strong>Gnip<span class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</span></strong> (adquirido por Twitter en Abril de 2014) y <strong>DataSift<span class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</span></strong>. En el caso de Gnip, se ha podido obtener cierta información investigando acerca de su modelo de negocio por Internet:</p>
</div>
<div class="quoteblock">
<blockquote>
Gnip will offer the Halfhose (50 percent of Tweets at a cost of <strong>$30,000</strong> per month), the Decahose (10 percent of Tweets for <strong>$5,000</strong> per month) and the Mentionhose (all mentions of a user including @replies and re-Tweets for <strong>$20,000</strong> per month). All feeds are available in original JSON and Activity Streams JSON formats.
</blockquote>
<div class="attribution">
<cite>http://allthingsd.com/20101117/gnip-becomes-twitters-first-authorized-data-reseller/</cite><br>
&#8212; Gnip Becomes Twitter's First Authorized Data Reseller - November 2010
</div>
</div>
<div class="paragraph">
<p>Para el presente proyecto, es posible que la opción del <strong>Decahose</strong> sea suficiente, por lo que se debería incluir un coste mensual de 5.000 $ (<strong>~3.668 €</strong>).</p>
</div>
</dd>
<dt class="hdlist1">Tecnologías Open Source</dt>
<dd>
<p>Para el desarrollo del proyecto se ha propuesto un <em>stack</em> tecnológico basado en tecnologías Open Source las cuales no conllevan ningún coste adicional implícito.</p>
</dd>
<dt class="hdlist1">Proveedor de infraestructura Cloud</dt>
<dd>
<p>Los precios para este tipo de servicios varían mucho en función del tipo de requisitos necesarios para desplegar la aplicación. En el caso de escoger el servicio ofrecido por <strong>Amazon Web Services</strong>, y viendo que, a priori y en función del Diagrama de Despliegue diseñado, harían falta un mínimo de 6 máquinas de una potencia moderada pero con una alta capacidad de almacenamiento (especialmente para el caso de la base de datos y el requisito de almacenar 48 horas de tuits), se podría estimar un coste mensual de:</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 28%;">
<col style="width: 14%;">
<col style="width: 57%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nodo</th>
<th class="tableblock halign-left valign-top">Coste</th>
<th class="tableblock halign-left valign-top">Coste por hora de la instancia escogida</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servidor de base de datos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~450 €</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.625 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servidor de servicio de streaming</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~73 €</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.102 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servidor para la cola de mensajes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~221 €</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.308 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servidores para Apache y dos instancias de la aplicación web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~665 €</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.308 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.409 €</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>En <a href="#budget-costs">Costes mensuales de mantenimiento y desarrollo de la aplicación web</a> se recoge el total presupuestado por cada mes que la aplicación se encuentre desplegada, así como los costes mensuales de mantener a los trabajadores <strong>Ingeniero Informático 1</strong> e <strong>Ingeniero Informático 2</strong> realizando labores de desarrollo para añadir nuevas funcionalidades a la aplicación web.</p>
</div>
<table id="budget-costs" class="tableblock frame-all grid-all" style="width: 100%;">
<caption class="title">Table 37. Costes mensuales de mantenimiento y desarrollo de la aplicación web</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firehose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.668 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infraestructura Cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.409 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Costes por mano de obra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.840 €</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.917 €</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_herramientas_utilizadas_durante_el_desarrollo_del_proyecto">6. Herramientas utilizadas durante el desarrollo del Proyecto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Además de las tecnologías utilizadas para el desarrollo de los prototipos y experimentos presentados en capítulos anteriores, el presente proyecto ha hecho uso de una serie de herramientas que facilitaron el desarrollo del mismo desde las fases iniciales hasta el desarrollo de la documentación final.</p>
</div>
<div class="sect2">
<h3 id="_trello">6.1. Trello</h3>
<div class="paragraph">
<p><strong>Trello</strong> (<a href="https://trello.com/">https://trello.com/</a>) es una aplicación web desarrollada por <strong>Fog Creek</strong> con el objetivo de ofrecer una herramienta eficaz para la gestión de tareas (y en cierta medida, proyectos) de manera sencilla y muy colaborativa que potencie los procesos de desarrollos ágiles.</p>
</div>
<div class="paragraph">
<p>Trello basa su funcionamiento en establecer una serie de tablones en donde los diferentes usuarios de una organización o equipo puedan ir colocando tareas (en forma de tarjeta) en un conjunto de columnas totalmente personalizables. Su funcionamiento se basa en metodologías ágiles como <strong>Scrum<span class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</span></strong>, donde el <em>Scrum Board</em> se utiliza para recoger todas las tareas <strong>Pendientes</strong>, <strong>En progreso</strong> o <strong>Terminadas</strong> para el <em>sprint</em> en curso.</p>
</div>
<div class="paragraph">
<p>En este caso se ha utilizado como herramienta para organizar y controlar el progreso de las tareas en las estaciones de experimentación y prototipado.</p>
</div>
</div>
<div class="sect2">
<h3 id="_omnigraffle_y_balsamiq_mockup">6.2. OmniGraffle y Balsamiq Mockup</h3>
<div class="paragraph">
<p>Ambas herramientas se han utilizado a la hora de realizar la documentación del proyecto con la misión de realizar gráficos que permitan reflejar, en el caso de <strong>OmniGraffle</strong> los diagramas UML necesarios para explicar el análisis y diseño de la aplicación web propuesta y, en el caso de <strong>Balsamiq Mockup</strong> ejemplos de interfaces de usuario que se podrían implementar para facilitar la interacción del usuario con la aplicación web.</p>
</div>
</div>
<div class="sect2">
<h3 id="_desarrollo_de_la_documentación_utilizando_asciidoc">6.3. Desarrollo de la documentación utilizando AsciiDoc</h3>
<div class="paragraph">
<p><strong>AsciiDoc</strong> (<a href="http://www.methods.co.nz/asciidoc/">http://www.methods.co.nz/asciidoc/</a>) ha sido el lenguaje de marcado seleccionado para realizar la documentación del proyecto, apoyado sobre el procesador <strong>Asciidoctor</strong> (<a href="http://asciidoctor.org/">http://asciidoctor.org/</a>).</p>
</div>
<div class="paragraph">
<p>La herramienta seleccionada para realizar la documentación debía de cumplir con las siguientes seis condiciones:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Trabajar en un formato de texto simple, preferiblemente texto plano, que lo hiciera independiente de la plataforma sobre la que realizar la documentación.</p>
</li>
<li>
<p>Trabajar con un lenguaje de marcado sencillo (similar a <strong>Markdown<span class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</span></strong>) que simplificara el proceso de escritura ante alternativas como <strong>LaTeX</strong>.</p>
</li>
<li>
<p>Capacidad de dividir la documentación en varios ficheros que se pudiesen estructurar en base a directorios internos del proyecto de documentación.</p>
</li>
<li>
<p>Permitir el uso de un repositorio de código (como Bitbucket o Github) como sistema de control de versiones (utilizando para ello Mercurial o Git).</p>
</li>
<li>
<p>Ser Open Source, libre y gratuito.</p>
</li>
<li>
<p>Ser capaz de generar un documento en formato PDF con un resultado similar al de sistemas como LaTeX.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>AsciiDoc, mediante la utilización de Asciidoctor y el procesador <strong>asciidoctor-fopub</strong> (<a href="https://github.com/asciidoctor/asciidoctor-fopub">https://github.com/asciidoctor/asciidoctor-fopub</a>) permitió generar de manera sencilla un pequeño proyecto basado en tecnologías Ruby que cumpliera con todos los requisitos anteriores.</p>
</div>
<div class="paragraph">
<p>A través de una serie de ficheros en texto plano escritos con AsciiDoc y respaldados por un repositorio en Bitbucket, se realizaba un compilado de los ficheros fuente utilizando Asciidoctor y <strong>Guard<span class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</span></strong> para producir un documento <strong>DocBook<span class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</span></strong> válido en XML que se pudiera transformar automáticamente en el PDF resultado utilizando asciidoctor-fopub.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusiones_del_proyecto">7. Conclusiones del Proyecto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A título personal, considero que el resultado final del proyecto ha constituido una experiencia muy satisfactoria que me ha permitido trabajar en áreas en las que no había tenido la oportunidad de profundizar anteriormente.</p>
</div>
<div class="paragraph">
<p>La experiencia de trabajar en base a estudios y artículos de investigación, me ha permitido completar mi formación profesional mediante la adición de aspectos más cercanos a los campos de I+D+i los cuales también podrían suponer una oportunidad laboral en el futuro.</p>
</div>
<div class="paragraph">
<p>Además, el estudio de Twitter y la capacidad para procesar grandes volúmenes de datos mediante la aplicación de algoritmos más o menos complejos, ha resultado en una experiencia muy enriquecedora dentro del ámbito actual de la Ingeniería Informática e Ingeniería Web.</p>
</div>
<div class="paragraph">
<p>Todo lo anterior acompaña a los buenos resultados cosechados durante las etapas de experimentación y prototipado, donde se ha conseguido alcanzar el objetivo del proyecto al ser capaces de ofrecer un algoritmo capaz de inferir la localización de un usuario en base, únicamente, al contenido de sus publicaciones en Twitter. Además, se ha aprovechado la tecnología utilizada para ofrecer una posible solución a la hora de querer integrarla en una aplicación web capaz de utilizarla para vender un nuevo servicio de geolocalización de publicaciones en medios sociales.</p>
</div>
<div class="paragraph">
<p>Este último punto, también ha supuesto un reto debido, especialmente, a la complejidad de diseñar parte de una aplicación web sin haber tenido nunca la experiencia de trabajar en un entorno similar (tanto por las tecnologías propuestas como por lo complejo del problema a solucionar), lo que ha conllevado un estudio paralelo acerca de los diferentes <em>frameworks</em> existentes y conceptos como las colas de mensajes o programación asíncrona.</p>
</div>
<div class="paragraph">
<p>Por último, este proyecto me ha dado la oportunidad de trabajar con Scala y, por tanto, acercarme al paradigma de programación funcional que, sin duda, ha cambiado mi manera de desarrollar. Antes de esta experiencia, nunca me había planteado, por ejemplo, los conceptos funcionales que van tan intrínsecamente unidos a lenguajes populares como JavaScript o Ruby y que me ha aportado nuevas soluciones para resolver problemas comunes.</p>
</div>
<div class="sect2">
<h3 id="_ampliaciones_y_trabajo_futuro">7.1. Ampliaciones y trabajo futuro</h3>
<div class="paragraph">
<p>Además de las ampliaciones propuestas en <a href="#_trabajo_futuro">Trabajo futuro</a>, la ampliación más natural del proyecto sería realizar un prototipo de la aplicación web propuesta sobre la tecnología estudiada anteriormente y comprobar su viabilidad.</p>
</div>
<div class="paragraph">
<p>Dentro de la construcción de esta nueva aplicación web, habría que comenzar realizando el análisis y diseño de los aspectos que se han omitido en los capítulos anteriores de este proyecto (por entenderse que no se ajustaban al propósito del mismo), entre ellos podríamos encontrar:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Análisis y diseño de la base de datos</p>
</li>
<li>
<p>Diseño de interfaces de usuario</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Accesibilidad</p>
</li>
<li>
<p>Interacción del usuario</p>
</li>
</ol>
</div>
</li>
<li>
<p>Diseño de plan de negocio</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>División de usuarios por grupos</p>
</li>
<li>
<p>Creación de diferentes planes de precios con características de uso propias</p>
</li>
</ol>
</div>
</li>
<li>
<p>Diseño del plan de pruebas</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scala">Appendix A: Scala</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El lenguaje de programación <strong>Scala</strong> (en su versión 2.11.0) fue la tecnología utilizada para desarrollar todos los prototipos y scripts que se realizaron como parte del ejercicio para poder inferir la localización de un usuario.</p>
</div>
<div class="paragraph">
<p>Scala (<a href="http://scala-lang.org/">http://scala-lang.org/</a>) es un lenguaje de programación orientado a objetos, fuertemente tipado y con un gran soporte para realizar programación funcional. Está construido sobre la Java Virtual Machine y por tanto compila al mismo <em>bytecode</em> que compilan el resto de lenguajes de la misma plataforma (Java, Groovy, etc.) permitiendo que la interoperabilidad entre bibliotecas escritas en estos lenguajes sea total.</p>
</div>
<div class="paragraph">
<p>Scala ha sido desarrollado con el objetivo de mejorar la experiencia de los programadores habituados a desarrollar en la JVM sobre Java, aportando características que permiten un desarrollo más potente mediante la inferencia de tipos dinámica, <em>closures</em>, <em>pattern matching</em>, sobrecarga de operadores y, por lo general, un código menos verboso.</p>
</div>
<div class="paragraph">
<p>Las principales razones de escoger Scala como el lenguaje de programación principal en el desarrollo de prototipos fueron:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Introducirme en los conceptos de la programación funcional con un lenguaje que también tiene soporte para un tipo de programación estructurada más tradicional.</p>
</li>
<li>
<p>Soporte nativo para trabajar con XML, tecnología sobre la que se basa gran parte del proyecto.</p>
</li>
<li>
<p>Compatibilidad total con bibliotecas desarrolladas en Java que hace que sea un complemento perfecto para mi preparación académica anterior.</p>
</li>
<li>
<p>Posibilidad de utilizarlo como un lenguaje de <em>scripting</em>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_sbt">sbt</h3>
<div class="paragraph">
<p><strong>sbt</strong> (o <strong>Simple Build Tool</strong>) es una herramienta de gestión de dependencias y sistema de <em>building</em> (similar a <strong>Maven</strong> o <strong>Ant</strong>) muy popular en la comunidad de desarrolladores de Scala (aunque también se puede utilizar sobre Java).</p>
</div>
<div class="paragraph">
<p>sbt (<a href="http://www.scala-sbt.org/">http://www.scala-sbt.org/</a>) fue desarrollado por <strong>Typesafe Inc.</strong> con el objetivo de dotar a Scala de una herramienta sencilla para realizar una compilación incremental de los proyectos y ofrecer un <em>shell</em> interactivo sobre el que realizar ciertas acciones como: <code>clean</code>, <code>compile</code>, <code>assembly</code>, etc. Su uso está muy vinculado también a todos aquellos proyectos desarrollados sobre el framework de desarrollo web <strong>Play!</strong>.</p>
</div>
<div class="paragraph">
<p>Para varios de los sistemas desarrollados en este proyecto, se ha utilizado sbt para realizar tareas de gestión de dependencias y construcción de los ficheros <code>jar</code> que se utilizarían para su posterior ejecución (es decir, tareas de compilación y ensamblado).</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo del fichero build.sbt para el sistema de análisis <strong>Puma</strong></div>
<div class="content">
<pre>name := "Puma" <i class="conum" data-value="1"></i><b>(1)</b>

version := "1.0" <i class="conum" data-value="2"></i><b>(2)</b>

scalaVersion := "2.11.0" <i class="conum" data-value="3"></i><b>(3)</b>

libraryDependencies ++= List(
  "org.scala-lang.modules" %% "scala-xml" % "1.0.1",
  "com.typesafe.scala-logging" %% "scala-logging-slf4j" % "2.1.2",
  "org.apache.logging.log4j" % "log4j-slf4j-impl" % "2.0-rc1",
  "com.twitter" % "twitter-text" % "1.6.1",
  "org.apache.logging.log4j" % "log4j-api" % "2.0-rc1",
  "org.apache.logging.log4j" % "log4j-core" % "2.0-rc1",
  "com.github.scopt" %% "scopt" % "3.2.0"
) <i class="conum" data-value="4"></i><b>(4)</b>

scalacOptions ++= Seq("-unchecked", "-deprecation") <i class="conum" data-value="5"></i><b>(5)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del proyecto que se está desarrollando</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Versión actual del proyecto</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Versión de Scala que se desea utilizar para compilar el proyecto</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Lista de dependencias que se desea que sean gestionadas por sbt</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Opciones de compilación para el compilador de Scala</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git">Appendix B: Git</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Git</strong> es un <strong>sistema de control de versiones distribuido</strong> desarrollado originalmente por Linus Torvalds para desarrollar el kernel de Linux en 2005. La diferencia con sistemas de control de versiones más tradicionales como SVN, es que en un proyecto con Git, cada desarrollador tiene una copia del proyecto entero en su máquina local, mientras que en SVN todo se basa en un repositorio central donde cada programador puede ir añadiendo o modificando ficheros.</p>
</div>
<div class="paragraph">
<p>Entre las características que hacen de Git un SCVD muy popular son: su velocidad, su capacidad para trabajar con diferentes ramas de manera sencilla, su eficiencia para trabajar con proyectos muy grandes (como queda demostrado en su uso por parte de Linux) y un buen soporte para realizar <em>merges</em> de manera sencilla (habitualmente, debido a la gran información que almacena cada nodo, Git es capaz de realizar los merges de manera automática).</p>
</div>
<div class="paragraph">
<p>En este proyecto, el uso de Git se une a los beneficios de poder trabajar con servicios de hosting como <strong>Github</strong> (<a href="http://www.github.com">http://www.github.com</a>), el cual permite tener un respaldo del código 100% asegurado. De la misma manera que aporta la flexibilidad necesaria para poder seguir trabajando en el proyecto desde diferentes máquinas y ubicaciones.</p>
</div>
<div class="paragraph">
<p>Los enlaces para consultar los diferentes sistemas y repositorios Git utilizados en este proyecto, hospedados en Github, son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Falcon</strong> (<a href="https://github.com/sergio-alvarez/falcon">https://github.com/sergio-alvarez/falcon</a>), es el sistema encargado de recopilar tuits de la API de Streaming de Twitter.</p>
</li>
<li>
<p><strong>Puma</strong> (<a href="https://github.com/sergio-alvarez/puma">https://github.com/sergio-alvarez/puma</a>), realiza los análisis de las colecciones de tuits recopilados por Falcon y calcula las puntuaciones LLR.</p>
</li>
<li>
<p><strong>vw-input-translator</strong> (<a href="https://github.com/sergio-alvarez/vw-input-translator">https://github.com/sergio-alvarez/vw-input-translator</a>), realiza las traducciones del fichero de salida de Puma, al fichero de entrada esperado por Vowpal Wabbit.</p>
</li>
<li>
<p><strong>tfm-utilities</strong> (<a href="https://github.com/sergio-alvarez/tfm-utilities">https://github.com/sergio-alvarez/tfm-utilities</a>), contiene varios <em>scripts</em> que han servido para realizar pequeñas tareas de refinamiento sobre los datos obtenidos.</p>
</li>
<li>
<p><strong>B2pick</strong> (<a href="https://github.com/sergio-alvarez/b2pick">https://github.com/sergio-alvarez/b2pick</a>), es una aplicación web desarrollada para poder seleccionar <em>bounding boxes</em> directamente sobre mapas de Google Maps.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_de_aprendizaje_automático_y_vowpal_wabbit">Appendix C: Software de aprendizaje automático y Vowpal Wabbit</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_software_de_aprendizaje_automático">Software de aprendizaje automático</h3>
<div class="paragraph">
<p>Se denomina software de aprendizaje automático a aquellos sistemas que son capaces de <em>aprender</em> a identificar ciertos modelos a partir de un conjunto de características y métodos de entrenamiento.</p>
</div>
<div class="paragraph">
<p>Su uso es bastante habitual en los campos de investigación más actuales y en los ámbitos de la Inteligencia Artificial. Son muy útiles en una amplia colección de problemas de diferente índole. Por ejemplo, algunas de sus aplicaciones más importantes son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Análisis del mercado de valores.</p>
</li>
<li>
<p>Inteligencia Artificial en el mundo de los videojuegos.</p>
</li>
<li>
<p>Análisis de sentimientos.</p>
</li>
<li>
<p>Fraudes de tarjetas de crédito.</p>
</li>
<li>
<p>Diagnóstico médico.</p>
</li>
<li>
<p>Motores de búsqueda.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El software de aprendizaje automático está siempre supeditado al algoritmo de aprendizaje que utilice por debajo. Es habitual que este tipo de sistemas puedan funcionar con diferentes tipos de algoritmos y permitan a los desarrolladores elegir cual se debe ejecutar para solucionar cada problema. El siguiente enlace contiene una explicación muy interesante acerca de los algoritmos más habituales que se pueden encontrar a la hora de trabajar con software de aprendizaje automático: <a href="http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/">http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/</a></p>
</div>
<div class="paragraph">
<p>En el siguiente apartado se explicará el software de aprendizaje automático utilizado en el presente proyecto: Vowpal Wabbit. A diferencia de la mayoría del software de aprendizaje automático disponible, Vowpal Wabbit utiliza un nuevo algoritmo de aprendizaje automático implementado por ellos mismos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vowpal_wabbit">Vowpal Wabbit</h3>
<div class="paragraph">
<p><strong>Vowpal Wabbit<span class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</span></strong> es un proyecto creado originalmente por <em>Yahoo! Research</em> que fue posteriormente continuado por <em>Microsoft Research</em>, consistente en la creación de un nuevo algoritmo de aprendizaje automático rápido y escalable que permita trabajar con grandes cantidades de datos. A partir de una serie de información específicamente preparada para ser consumida por Vowpal Wabbit, este es capaz de crear un propio modelo de datos que sirva como base de entrenamiento para después, mediante la aplicación de diversos algoritmos, predecir un resultado en base al conocimiento adquirido en ejecuciones anteriores.</p>
</div>
<div class="paragraph">
<p>Además de la velocidad y precisión de los resultados que puede ofrecer Vowpal Wabbit, una de sus características más importantes es la capacidad de funcionar como un demonio del sistema e ir aprendiendo <em>en caliente</em> a través de nuevos modelos de datos. Esto, a diferencia de otros software de aprendizaje automático, permite que el sistema pueda adquirir un conocimiento incremental y ofrecer mejores resultados a medida que pasa el tiempo.</p>
</div>
<div class="sect3">
<h4 id="_normalización_de_datos">Normalización de datos</h4>
<div class="paragraph">
<p>Para aprovechar toda la potencia y velocidad que ofrece Vowpal Wabbit, es necesario generar ficheros de entrada que estén estructurados de acuerdo a un formato optimizado para el clasificador. En este caso, Vowpal Wabbit espera datos de entrada estructurados de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Label] [Importance [Tag]]|Namespace Features |Namespace Features ... |Namespace Features <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://github.com/JohnLangford/vowpal_wabbit/wiki/Input-format">https://github.com/JohnLangford/vowpal_wabbit/wiki/Input-format</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En el presente proyecto, esta estructura generaría datos de la siguiente manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 |Tweet @adrianzenb scl rainer wirth óscar amigos radio quillota
0 |Tweet @thomasuribe medellín colombia celebra día hombre
1 |Tweet @fvminajx @cursiperono mujer ruega punto</pre>
</div>
</div>
<div class="paragraph">
<p>Debido a que un primer momento se consideró la opción de trabajar con modelos multiclase, el sistema que realiza la traducción entre los ficheros de puntuación generados por el sistema Puma y los datos que espera recibir Vowpal Wabbit, debía de ser parametrizable para poder cubrir los siguientes dos casos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Entrenar un modelo de clasificación binario donde sólo se indicara si un tuit pertenece o no a un conjunto de coordenadas (útil para modelos en los que se quiera conocer de manera binaria si una dato pertenece o no a una localización en concreto).</p>
</li>
<li>
<p>Entrenar un modelo de clasificación multiclase donde se agruparan las clases en torno a un número de decimales para la latitud y longitud. Esto haría que se considerasen de la misma clase todos los tuits cuyas coordenadas con 3 decimales sean las mismas, permitiendo obtener predicciones con un grado de precisión de 10 kilómetros (en caso de agrupar por 2 decimales, la precisión sería de 100 y con 1, de 1000 kilómetros).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para ello, se creo un sistema que mediante una interfaz de línea de comandos pudiese ser configurable mediante los siguientes argumentos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vw-input-translator 1.0
Usage: vw-input-translator [options] &lt;file&gt;

  --inout
        Flag for creating an input file for binary classification
  -d &lt;value&gt; | --decimals &lt;value&gt;
        Creates an input file for multi-class classification. Each sample will have the selected number of decimals on latitude and longitude coordinates
  &lt;file&gt;
        Source file</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_división_de_datos_en_conjuntos_de_entrenamiento_y_test">División de datos en conjuntos de entrenamiento y test</h4>
<div class="paragraph">
<p>Con el objetivo de entrenar al clasificador, se desarrolló un script capaz de, a partir de los datos de entrada que recibiría Vowpal Wabbit, dividir el conjunto en dos para dedicar una parte al proceso de entrenamiento y otra a probar el modelo de datos generados.</p>
</div>
<div class="paragraph">
<p>Con el objetivo de generar dos conjuntos consistentes, la división se realizó en base a los usuarios, haciendo que un mismo usuario no pudiese formar parte de ambos grupos. Un 80% de los usuarios sería destinado al grupo de entrenamiento, mientras que el 20% restante iría a parar al conjunto de test.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_falcon_sistema_para_coleccionar_datos_de_la_api_streaming_de_twitter">Appendix D: Falcon, sistema para coleccionar datos de la API Streaming de Twitter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para crear los diferentes datasets que fueron necesarios para desarrollar los prototipos y modelos de datos, se diseñó un sistema capaz de conectarse a la <strong>API Streaming de Twitter</strong> (<a href="https://dev.twitter.com/docs/api/streaming">https://dev.twitter.com/docs/api/streaming</a>) para descargar y almacenar tuits en tiempo real.</p>
</div>
<div class="paragraph">
<p>Este sistema debía ser parametrizable, con el objetivo de poder configurar en cada ejecución el tipo de tuits que se querían obtener de acuerdo a los filtros disponibles a través de la API de Twitter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filtro por idioma del tuit</p>
</li>
<li>
<p>Filtro por localización del tuit (mediante el uso de <em>bounding boxes</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para realizar la conexión entre el sistem Falcon y la API de Twitter se utilizó la biblioteca <strong>Twitter4j</strong> (<a href="http://twitter4j.org/en/index.html">http://twitter4j.org/en/index.html</a>). La ventajas de utilizar una biblioteca construida sobre la API original es que algunos de los problemas más habituales se solucionan a través de nuevas capas de abstracción:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Autenticación OAuth2 simplificada mediante clases propias de la biblioteca</p>
</li>
<li>
<p>Simplificación del proceso para poder utilizar la API de Streaming, aislando al desarrollador de la complejidad para mantener activa la conexión con el servidor de Twitter.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/twitter-streaming-api.png" alt="Modelo de comunicación entre un cliente y la API Streaming de Twitter">
</div>
<div class="title">Figure 28. Comunicación entre un cliente y la API Streaming de Twitter<span class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</span></div>
</div>
<div class="sect2">
<h3 id="_almacenamiento_de_datos">Almacenamiento de datos</h3>
<div class="paragraph">
<p>Uno de los puntos más importantes que planteó el sistema para recolectar tuits era en qué formato sería más adecuado serializar los datos obtenidos.</p>
</div>
<div class="paragraph">
<p>En un primer momento se barajó la posibilidad de utilizar el formato CSV, el cual permitiría acceder de manera rápida al número de tuits guardados y realizar operaciones sencillas en línea de comandos mediante operaciones <code>grep</code>. Esta decisión fue descartada al realizar los primeros experimentos y comprobar como el guardado de ciertos datos en formato CSV presenta muchas dificultades para poder solventar todos los casos esquina que se presentan con la aparición de contenido complejo que pueda incluir comas, comillas y otros signos de puntuación (aún en el caso de utilizar bibliotecas especializadas como OpenCSV - <a href="http://opencsv.sourceforge.net/">http://opencsv.sourceforge.net/</a> ) combinados con caracteres extraños como Emoji (<a href="http://www.unicode.org/faq/emoji_dingbats.html">http://www.unicode.org/faq/emoji_dingbats.html</a>).</p>
</div>
<div class="paragraph">
<p>Como consecuencia de los resultados anteriores, y apoyado en el soporte nativo ofrecido por Scala, se utilizó XML como el lenguaje de estructuración de datos que mejor podría serializar la información obtenida a través de Twitter4j. El siguiente fragmento de código permite ver lo sencillo que es serializar un objeto en Scala a XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Tweet</span>(<span style="color: #336699; font-style: italic">id:</span>String, <span style="color: #336699; font-style: italic">username:</span> String, <span style="color: #336699; font-style: italic">name:</span>String, <span style="color: #336699; font-style: italic">location:</span> String, <span style="color: #336699; font-style: italic">timezone:</span> String, <span style="color: #336699; font-style: italic">createdAt:</span>String, <span style="color: #336699; font-style: italic">latitude:</span> String, <span style="color: #336699; font-style: italic">longitude:</span> String, <span style="color: #336699; font-style: italic">text:</span> String) {
  def toXML =
    &lt;tweet&gt;
      &lt;id&gt;
        {id}
      &lt;/id&gt;
      &lt;username&gt;
        {username}
      &lt;/username&gt;
      &lt;name&gt;
        {name}
      &lt;/name&gt;
      &lt;location&gt;
        {location}
      &lt;/location&gt;
      &lt;timezone&gt;
        {timezone}
      &lt;/timezone&gt;
      &lt;createdAt&gt;
        {createdAt}
      &lt;/createdAt&gt;
      &lt;latitude&gt;
        {latitude}
      &lt;/latitude&gt;
      &lt;longitude&gt;
        {longitude}
      &lt;/longitude&gt;
      &lt;text&gt;
        {text}
      &lt;/text&gt;
    &lt;/tweet&gt;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parámetros_del_sistema">Parámetros del sistema</h3>
<div class="paragraph">
<p>Debido a que Falcon es un sistema sin ánimo de ejecutarse a través de una GUI, la manera de parametrizar la ejecución ha sido a través de una interfaz de línea de comandos. Para ello, se ha utilizado la biblioteca <strong>scopt</strong> (<a href="https://github.com/scopt/scopt">https://github.com/scopt/scopt</a>).</p>
</div>
<div class="paragraph">
<p>scopt permite parsear de manera sencilla los argumentos que se le pasan al programa en el momento de su ejecución. Para ello, simplemente hay que definir un objeto <code>ScoptParser</code> que contenga las reglas necesarias para especificar qué parámetros se esperan, qué tipo deben tener (<code>String</code>, <code>Integer</code>, <code>Boolean</code>, etc.) y si son requeridos u opcionales.</p>
</div>
<div class="paragraph">
<p>A continuación se muestra el mensaje de ayuda de la aplicación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Falcon 1.0
Usage: Falcon [options]

  -l &lt;value&gt; | --language &lt;value&gt;
        Specifies the language, in ISO 639-1 format, for the tweets to collect.
  -k &lt;value&gt; | --keywords &lt;value&gt;
        Specifies the file for the keywords.
  -t &lt;value&gt; | --time-in &lt;value&gt;
        The time measure for collecting tweets (SECONDS, MINUTES, HOURS, DAYS).
  -n &lt;value&gt; | --timestamp &lt;value&gt;
        Units of time for collecting tweets.
  -o &lt;value&gt; | --output &lt;value&gt;
        The output filename where store the collection results.
  -c &lt;value&gt; | --credentials &lt;value&gt;
        Properties file with the Twitter credentials
  -b &lt;value&gt; | --bounding-boxes &lt;value&gt;
        Specifies the file which contains the bounding boxes.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--time-in</code> y <code>--timestamp</code>: permiten establecer al recolector un tiempo de ejecución representado en diferentes magnitudes.</p>
</li>
<li>
<p><code>--output</code>: nombre del fichero de salida.</p>
</li>
<li>
<p><code>--language</code>: idioma en el que se desean obtener los tuits.</p>
</li>
<li>
<p><code>--stopwords</code>: debido a restricciones de Twitter, es necesario proveer una lista de términos cuando se intenta realizar un filtrado por idioma. Con el objetivo de restringir lo mínimo posible el número de tuits a obtener, se provee una lista de <em>stop words</em> del idioma por el que se esté filtrando.</p>
</li>
<li>
<p><code>--bounding-boxes</code>: fichero <code>XML</code> que contiene los <em>bounding boxes</em> sobre los que se realizará el filtrado.</p>
</li>
<li>
<p><code>--credentials</code>: indica el fichero que contiene las credenciales que se utilizarán para conectarse con la API de Twitter y utilizar su servicio de Streaming.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Un ejemplo de uso para obtener datos en español sobre los bounding boxes de España durante un día, podría ser algo como esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>falcon.jar -l es -s es_stop_words.txt -t DAYS -n 1 -o es_tweets_collection -c credentials.properties -b spain_bounding_boxes.xml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejemplo_de_resultados">Ejemplo de resultados</h3>
<div class="paragraph">
<p>Un ejemplo de los resultados obtenidos por el recolector sería el siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span style="color: #bb0066; font-weight: bold">&lt;tweet&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;id&gt;</span>
    469499350327255040
  <span style="color: #bb0066; font-weight: bold">&lt;/id&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;username&gt;</span>
    jessfhickey
  <span style="color: #bb0066; font-weight: bold">&lt;/username&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;name&gt;</span>
    Jessica Hickey
  <span style="color: #bb0066; font-weight: bold">&lt;/name&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;location&gt;</span>
    Ireland
  <span style="color: #bb0066; font-weight: bold">&lt;/location&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;timezone&gt;</span>
    London
  <span style="color: #bb0066; font-weight: bold">&lt;/timezone&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;createdAt&gt;</span>
    2014-05-22 15:25
  <span style="color: #bb0066; font-weight: bold">&lt;/createdAt&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>
    53.3444086
  <span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>
    -6.2649497
  <span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;text&gt;</span>
    In the most beautiful cafe ever. #boulevardcafe
  <span style="color: #bb0066; font-weight: bold">&lt;/text&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/tweet&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_b2pick_aplicación_web_para_seleccionar_bounding_boxes">Appendix E: B2pick, aplicación web para seleccionar Bounding Boxes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Uno de los procesos más habituales durante el desarrollo del proyecto fue la selección de <em>bounding boxes</em> para aplicar filtros sobre el Streaming de Twitter. Un <em>bounding box</em>, se puede definir como un rectángulo que abarca un área geográfica en concreto que queda definida por sus coordenadas suroeste y noreste.</p>
</div>
<div class="paragraph">
<p><strong>B2pick</strong> (<a href="https://github.com/sergio-alvarez/b2pick">https://github.com/sergio-alvarez/b2pick</a>), viene a cubrir la necesidad de poder automatizar el proceso mediante una sencilla aplicación web escrita puramente en JavaScript en la capa de cliente, que mediante la utilización de la API de Google Maps permita dibujar al usuario rectángulos sobre las zonas geográficas que desee.</p>
</div>
<div class="paragraph">
<p>Actualmente, no se conoce ninguna herramienta que ofrezca un servicio similar.</p>
</div>
<div class="paragraph">
<p>Una vez el usuario ha seleccionado los <em>bounding boxes</em> que desea, B2pick ofrece la posibilidad de descargarlos en formato XML (que es el formato que se ha utilizado a la hora de desarrollar los prototipos), siendo posible en el futuro adaptar fácilmente el formato de salida a otros también populares como JSON o CSV.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de la serialización en XML de un conjunto de <em>bounding boxes</em></div>
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span style="color: #bb0066; font-weight: bold">&lt;boundingBoxes&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;boundingBox&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;sw&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>35.75<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>-12.04<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/sw&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;ne&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>44.53<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>4.22<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/ne&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/boundingBox&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;boundingBox&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;sw&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>50.23<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>-13.89<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/sw&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;ne&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>59.27<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>1.85<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/ne&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/boundingBox&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;boundingBox&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;sw&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>54.72<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>6.24<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/sw&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;ne&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;latitude&gt;</span>57.61<span style="color: #bb0066; font-weight: bold">&lt;/latitude&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;longitude&gt;</span>12.83<span style="color: #bb0066; font-weight: bold">&lt;/longitude&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/ne&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/boundingBox&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/boundingBoxes&gt;</span></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/b2pick-main-screen.png" alt="Imagen de la pantalla principal de b2pick">
</div>
<div class="title">Figure 29. Captura de la pantalla principal de B2pick</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/b2pick-lightbox.png" alt="Ejemplo del lightbox de salida con los bounding boxes seleccionados">
</div>
<div class="title">Figure 30. Ejemplo del lightbox de resultados con los <em>bounding boxes</em> seleccionados</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tweetheat_mapas_de_calor_sobre_ficheros_tsv_de_puntuación">Appendix F: TweetHeat, mapas de calor sobre ficheros TSV de puntuación</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>TweetHeat</strong> (<a href="http://sergioalvarezsuarez.com/utilities/tweetheat/">http://sergioalvarezsuarez.com/utilities/tweetheat/</a>) es una aplicación web desarrollada con el objetivo de poder visualizar de manera rápida y sencilla cuándo un conjunto de puntuaciones para una determinada localización en formato TSV están dentro de un área específica.</p>
</div>
<div class="paragraph">
<p>En el presente proyecto, esta aplicación fue realmente útil en el proceso de refinamiento de datos, en donde se quería entrenar al clasificador con datos 100% válidos, eliminando aquellos tuits con puntuación positiva que se encontrasen fuera del área local y viceversa.</p>
</div>
<div class="paragraph">
<p>Para su desarrollo se utilizaron únicamente tecnologías front-end como HTML5, CSS3 y JavaScript, con algunas de las nuevas características como la API de JavaScript para la gestión de ficheros y la API de <em>drag&amp;drop</em> para HTML5.</p>
</div>
<div class="paragraph">
<p>El funcionamiento de la aplicación es realmente sencillo, a partir de un fichero TSV con el siguiente formato:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[puntuacion_llr]  latitud  longitud  contenido_del_tuit</pre>
</div>
</div>
<div class="paragraph">
<p>Se debe arrastrar sobre la zona de <em>drag&amp;drop</em> superior y automáticamente la aplicación mostrará, utilizando un mapa de calor y la API de Google Maps, las zonas cubiertas por los tuits contenidos en dicho fichero.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/tweetheat-home.png" alt="Pantalla de inicio de la aplicación TweetHeat">
</div>
<div class="title">Figure 31. Pantalla de inicio de la aplicación TweetHeat</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../assets/appendixes/tweetheat-asturias-results.png" alt="Resultados tras soltar un fichero TSV con puntuaciones para tuits localizados en Asturias">
</div>
<div class="title">Figure 32. Resultados tras cargar un fichero TSV con puntuaciones para tuits localizados en Asturias</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_código_fuente_de_los_prototipos_y_em_scripts_em_desarrollados">Appendix G: Código fuente de los prototipos y <em>scripts</em> desarrollados</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_falcon">Falcon</h3>
<div class="listingblock">
<div class="title">Main.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">main</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.streaming.Collector</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.util.Util</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.main</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
object Main {
  def <span style="color: #0066bb; font-weight: bold">main</span>(<span style="color: #336699; font-style: italic">args:</span> Array[String]): Unit = {
    CLIParser.<span style="color: #336699">parse</span>(args, Configuration()) map { config =&gt; run(config) }
  }

  def <span style="color: #0066bb; font-weight: bold">run</span>(<span style="color: #336699; font-style: italic">config:</span> Configuration) = {
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;========================================&quot;</span>)
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;                 falcon                 &quot;</span>)
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;========================================&quot;</span>)
    println()

    Util.<span style="color: #336699">loadConfiguration</span>(config)
    val collector = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Collector</span>()
    collector.<span style="color: #336699">collect</span>
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configuration.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">main</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io.File</span>

<span style="color: #008800; font-weight: bold">case</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Configuration</span>(<span style="color: #336699; font-style: italic">language:</span>String = <span style="color: #dd2200; background-color: #fff0f0">&quot;es&quot;</span>, <span style="color: #336699; font-style: italic">keywords:</span>File = <span style="color: #008800; font-weight: bold">null</span>, <span style="color: #336699; font-style: italic">boundingBoxes:</span>File = <span style="color: #008800; font-weight: bold">null</span>, <span style="color: #336699; font-style: italic">timeMeasure:</span>String = <span style="color: #dd2200; background-color: #fff0f0">&quot;SECONDS&quot;</span>,
    <span style="color: #336699; font-style: italic">timeToCollect:</span>Int = <span style="color: #0000DD; font-weight: bold">10</span>, <span style="color: #336699; font-style: italic">output:</span>String = <span style="color: #dd2200; background-color: #fff0f0">&quot;falcon_collection.xml&quot;</span>, <span style="color: #336699; font-style: italic">coordinatesMandatory:</span>Boolean = <span style="color: #008800; font-weight: bold">false</span>, <span style="color: #336699; font-style: italic">credentials:</span>File = <span style="color: #008800; font-weight: bold">null</span>) {}

object CLIParser {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val parser = <span style="color: #008800; font-weight: bold">new</span> scopt.<span style="color: #336699">OptionParser</span>[Configuration](<span style="color: #dd2200; background-color: #fff0f0">&quot;Falcon&quot;</span>) {
    head(<span style="color: #dd2200; background-color: #fff0f0">&quot;Falcon&quot;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;1.0&quot;</span>)
    opt[String](<span style="color: #dd2200; background-color: #fff0f0">&#39;l&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;language&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(language = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Specifies the language, in ISO 639-1 format, for the tweets to collect.&quot;</span>)
    opt[File](<span style="color: #dd2200; background-color: #fff0f0">&#39;k&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;keywords&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(keywords = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Specifies the file for the keywords.&quot;</span>)
    opt[String](<span style="color: #dd2200; background-color: #fff0f0">&#39;t&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;time-in&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(timeMeasure = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;The time measure for collecting tweets (SECONDS, MINUTES, HOURS, DAYS).&quot;</span>)
    opt[Int](<span style="color: #dd2200; background-color: #fff0f0">&#39;n&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;timestamp&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(timeToCollect = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Units of time for collecting tweets.&quot;</span>)
    opt[String](<span style="color: #dd2200; background-color: #fff0f0">&#39;o&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;output&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(output = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;The output filename where store the collection results.&quot;</span>)
    opt[File](<span style="color: #dd2200; background-color: #fff0f0">&#39;c&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;credentials&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(credentials = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Properties file with the Twitter credentials&quot;</span>)
    opt[File](<span style="color: #dd2200; background-color: #fff0f0">&#39;b&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;bounding-boxes&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(boundingBoxes = x) } text (<span style="color: #dd2200; background-color: #fff0f0">&quot;Specifies the file which contains the bounding boxes.&quot;</span>)
  }

  def <span style="color: #0066bb; font-weight: bold">parse</span>(<span style="color: #336699; font-style: italic">args:</span>Array[String], <span style="color: #336699; font-style: italic">conf:</span>Configuration):Option[Configuration] = <span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">parser</span>.<span style="color: #336699">parse</span>(args, conf)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tweet.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">model</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.model</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
  <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Tweet</span>(<span style="color: #336699; font-style: italic">id:</span>String, <span style="color: #336699; font-style: italic">username:</span> String, <span style="color: #336699; font-style: italic">name:</span>String, <span style="color: #336699; font-style: italic">location:</span> String, <span style="color: #336699; font-style: italic">timezone:</span> String, <span style="color: #336699; font-style: italic">createdAt:</span>String, <span style="color: #336699; font-style: italic">latitude:</span> String,
              <span style="color: #336699; font-style: italic">longitude:</span> String, <span style="color: #336699; font-style: italic">text:</span> String) {
    def toXML =
      &lt;tweet&gt;
        &lt;id&gt;
          {id}
        &lt;/id&gt;
        &lt;username&gt;
          {username}
        &lt;/username&gt;
        &lt;name&gt;
          {name}
        &lt;/name&gt;
        &lt;location&gt;
          {location}
        &lt;/location&gt;
        &lt;timezone&gt;
          {timezone}
        &lt;/timezone&gt;
        &lt;createdAt&gt;
          {createdAt}
        &lt;/createdAt&gt;
        &lt;latitude&gt;
          {latitude}
        &lt;/latitude&gt;
        &lt;longitude&gt;
          {longitude}
        &lt;/longitude&gt;
        &lt;text&gt;
          {text}
        &lt;/text&gt;
      &lt;/tweet&gt;
  }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">FilterFactory.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">streaming</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">twitter4j.FilterQuery</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.util.Util</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.streaming.filter</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 02/2014</span>
<span style="color: #888888">*/</span>
object FilterFactory {
  def <span style="color: #336699; font-style: italic">createFilterQuery:</span> FilterQuery = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FilterQuery</span>().<span style="color: #336699">language</span>(Util.<span style="color: #336699">language</span>).<span style="color: #336699">track</span>(Util.<span style="color: #336699">keywords</span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Collector.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">streaming</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.writer.Writer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.util.Util</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.streaming.filter.FilterFactory</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.streaming</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 02/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #bb0066; font-weight: bold">Collector</span> {
  def <span style="color: #0066bb; font-weight: bold">collect</span>() = {
    val twitterStreaming = <span style="color: #008800; font-weight: bold">new</span> TwitterStreaming
    twitterStreaming.<span style="color: #336699">filter</span>(FilterFactory.<span style="color: #336699">createFilterQuery</span>)
    <span style="color: #008800; font-weight: bold">try</span>{
      Writer.<span style="color: #336699">open</span>(Util.<span style="color: #336699">fileName</span>)
      Writer.<span style="color: #336699">write</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;tweets&gt;\n&quot;</span>)
      twitterStreaming.<span style="color: #336699">run</span>()

      val top = System.<span style="color: #336699">currentTimeMillis</span>() + Util.<span style="color: #336699">timeToCollect</span>
      <span style="color: #0066bb; font-weight: bold">while</span>(System.<span style="color: #336699">currentTimeMillis</span>() &lt;= top) {}

      twitterStreaming.<span style="color: #336699">close</span>()
      Writer.<span style="color: #336699">write</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/tweets&gt;&quot;</span>)
      Writer.<span style="color: #336699">close</span>()
    } <span style="color: #008800; font-weight: bold">finally</span> {
      Writer.<span style="color: #336699">close</span>()
      twitterStreaming.<span style="color: #336699">close</span>()
    }

  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">TwitterStreaming.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">streaming</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">twitter4j._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.model.Tweet</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.writer.Writer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.util.Util</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.util.</span>{Date, TimeZone}
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.text.SimpleDateFormat</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.streaming</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
 <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">TwitterStreaming</span>() {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_filter:</span> FilterQuery = _
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_twitter:</span> TwitterStream = _

  def <span style="color: #0066bb; font-weight: bold">filter</span>(<span style="color: #336699; font-style: italic">filter:</span> FilterQuery): Unit = _filter = filter

  def <span style="color: #0066bb; font-weight: bold">run</span>() = {
    _twitter =
      <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">TwitterStreamFactory</span>(Util.<span style="color: #336699">twitterConfiguration</span>).<span style="color: #336699">getInstance</span>()
    _twitter.<span style="color: #336699">addListener</span>(myTwitterStatusListener)
    _twitter.<span style="color: #336699">filter</span>(_filter)
  }

  def <span style="color: #0066bb; font-weight: bold">close</span>() = <span style="color: #008800; font-weight: bold">if</span> (_twitter != <span style="color: #008800; font-weight: bold">null</span>) _twitter.<span style="color: #336699">shutdown</span>()

  <span style="color: #008800; font-weight: bold">private</span> def myTwitterStatusListener = <span style="color: #008800; font-weight: bold">new</span> StatusListener {
    def <span style="color: #0066bb; font-weight: bold">onStatus</span>(<span style="color: #336699; font-style: italic">status:</span> Status) {
      <span style="color: #008800; font-weight: bold">if</span>(status.<span style="color: #336699">getGeoLocation</span> == <span style="color: #008800; font-weight: bold">null</span>) <span style="color: #008800; font-weight: bold">return</span>;

      val <span style="color: #336699; font-style: italic">id:</span>String        = status.<span style="color: #336699">getId</span>.<span style="color: #336699">toString</span>
      val <span style="color: #336699; font-style: italic">username:</span>String  = status.<span style="color: #336699">getUser</span>.<span style="color: #336699">getScreenName</span>
      val <span style="color: #336699; font-style: italic">name:</span>String      = status.<span style="color: #336699">getUser</span>.<span style="color: #336699">getName</span>
      val <span style="color: #336699; font-style: italic">location:</span>String  = status.<span style="color: #336699">getUser</span>.<span style="color: #336699">getLocation</span>
      val <span style="color: #336699; font-style: italic">timezone:</span>String  = status.<span style="color: #336699">getUser</span>.<span style="color: #336699">getTimeZone</span>
      val <span style="color: #336699; font-style: italic">createdAt:</span>String = toUTC(status.<span style="color: #336699">getCreatedAt</span>)
      val <span style="color: #336699; font-style: italic">text:</span>String      = status.<span style="color: #336699">getText</span>
      val <span style="color: #336699; font-style: italic">latitude:</span>String  = status.<span style="color: #336699">getGeoLocation</span>.<span style="color: #336699">getLatitude</span>.<span style="color: #336699">toString</span>
      val <span style="color: #336699; font-style: italic">longitude:</span>String = status.<span style="color: #336699">getGeoLocation</span>.<span style="color: #336699">getLongitude</span>.<span style="color: #336699">toString</span>

      <span style="color: #0066bb; font-weight: bold">if</span>(Util.<span style="color: #336699">isInBoundingBoxes</span>(latitude, longitude)){
        val tweet = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Tweet</span>(id, username, name, location, timezone, createdAt, latitude, longitude, text)
        Writer.<span style="color: #336699">write</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;\t${tweet.toXML.toString()}\n&quot;</span>)
      }
    }

    def <span style="color: #0066bb; font-weight: bold">onStallWarning</span>(<span style="color: #336699; font-style: italic">p1:</span> StallWarning) {}

    def <span style="color: #0066bb; font-weight: bold">onException</span>(<span style="color: #336699; font-style: italic">p1:</span> Exception) {}

    def <span style="color: #0066bb; font-weight: bold">onDeletionNotice</span>(<span style="color: #336699; font-style: italic">p1:</span> StatusDeletionNotice) {}

    def <span style="color: #0066bb; font-weight: bold">onScrubGeo</span>(<span style="color: #336699; font-style: italic">p1:</span> Long, <span style="color: #336699; font-style: italic">p2:</span> Long) {}

    def <span style="color: #0066bb; font-weight: bold">onTrackLimitationNotice</span>(<span style="color: #336699; font-style: italic">p1:</span> Int) {}

    <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">toUTC</span>(<span style="color: #336699; font-style: italic">date:</span> Date): String = {
      val f = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleDateFormat</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;yyyy-MM-dd HH:mm&quot;</span>)
      f.<span style="color: #336699">setTimeZone</span>(TimeZone.<span style="color: #336699">getTimeZone</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;UTC&quot;</span>))
      f.<span style="color: #336699">format</span>(date)
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Util.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">util</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.util.Properties</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.Array</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.JavaConverters._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.concurrent.duration._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.util.concurrent.TimeUnit</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.XML</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.falcon.main.Configuration</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.util</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
object Util {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val AccessTokenSecret = <span style="color: #dd2200; background-color: #fff0f0">&quot;access_token_secret&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val AccessToken = <span style="color: #dd2200; background-color: #fff0f0">&quot;access_token&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val ConsumerSecret = <span style="color: #dd2200; background-color: #fff0f0">&quot;consumer_secret&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val ConsumerKey = <span style="color: #dd2200; background-color: #fff0f0">&quot;consumer_key&quot;</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val <span style="color: #336699; font-style: italic">_locations:</span> Array[Array[Double]] = <span style="color: #008800; font-weight: bold">null</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">configuration:</span> Configuration = <span style="color: #008800; font-weight: bold">null</span>

  def <span style="color: #0066bb; font-weight: bold">loadConfiguration</span>(<span style="color: #336699; font-style: italic">config:</span> Configuration): Unit =
    <span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">configuration</span> = config

  def <span style="color: #336699; font-style: italic">twitterConfiguration:</span> twitter4j.<span style="color: #336699">conf</span>.<span style="color: #336699">Configuration</span> = {
    val props = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Properties</span>()
    props
      .<span style="color: #336699">load</span>(Source.<span style="color: #336699">fromFile</span>(configuration.<span style="color: #336699">credentials</span>)
      .<span style="color: #336699">bufferedReader</span>())

    <span style="color: #008800; font-weight: bold">new</span> twitter4j.<span style="color: #336699">conf</span>.<span style="color: #336699">ConfigurationBuilder</span>()
      .<span style="color: #336699">setOAuthConsumerKey</span>(props.<span style="color: #336699">getProperty</span>(ConsumerKey))
      .<span style="color: #336699">setOAuthConsumerSecret</span>(props.<span style="color: #336699">getProperty</span>(ConsumerSecret))
      .<span style="color: #336699">setOAuthAccessToken</span>(props.<span style="color: #336699">getProperty</span>(AccessToken))
      .<span style="color: #336699">setOAuthAccessTokenSecret</span>(props.<span style="color: #336699">getProperty</span>(AccessTokenSecret))
      .<span style="color: #336699">build</span>
  }

  def <span style="color: #336699; font-style: italic">keywords:</span> Array[String] =
    Source.<span style="color: #336699">fromFile</span>(configuration.<span style="color: #336699">keywords</span>).<span style="color: #336699">getLines</span>().<span style="color: #336699">toArray</span>

  def <span style="color: #336699; font-style: italic">locations:</span> Array[Array[Double]] =
    <span style="color: #008800; font-weight: bold">if</span> (_locations != <span style="color: #008800; font-weight: bold">null</span>) _locations <span style="color: #008800; font-weight: bold">else</span> getBoundingBoxes

  def <span style="color: #336699; font-style: italic">language:</span> Array[String] = Array(configuration.<span style="color: #336699">language</span>)

  def <span style="color: #336699; font-style: italic">timeToCollect:</span> Long = {
    val timeMeasure = configuration.<span style="color: #336699">timeMeasure</span>
    val timeToCollect = configuration.<span style="color: #336699">timeToCollect</span>
    <span style="color: #0066bb; font-weight: bold">Duration</span>(timeToCollect, TimeUnit.<span style="color: #336699">valueOf</span>(timeMeasure)).<span style="color: #336699">toMillis</span>
  }

  def <span style="color: #336699; font-style: italic">fileName:</span> String = configuration.<span style="color: #336699">output</span>

  def <span style="color: #336699; font-style: italic">areCoordinatesMandatory:</span> Boolean =
    configuration.<span style="color: #336699">coordinatesMandatory</span>

  def <span style="color: #0066bb; font-weight: bold">isInBoundingBoxes</span>(<span style="color: #336699; font-style: italic">latitude:</span> String, <span style="color: #336699; font-style: italic">longitude:</span> String): Boolean = {
    val lat = latitude.<span style="color: #336699">toDouble</span>
    val lng = longitude.<span style="color: #336699">toDouble</span>

    Util.<span style="color: #336699">locations</span>.<span style="color: #336699">grouped</span>(<span style="color: #0000DD; font-weight: bold">2</span>).<span style="color: #336699">exists</span>(group =&gt; {
      val sw = group(<span style="color: #0000DD; font-weight: bold">0</span>)
      val ne = group(<span style="color: #0000DD; font-weight: bold">1</span>)
      sw(<span style="color: #0000DD; font-weight: bold">0</span>) &lt;= lat &amp;&amp; ne(<span style="color: #0000DD; font-weight: bold">0</span>) &gt;= lat &amp;&amp; sw(<span style="color: #0000DD; font-weight: bold">1</span>) &lt;= lng &amp;&amp; ne(<span style="color: #0000DD; font-weight: bold">1</span>) &gt;= lng
    })
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">getBoundingBoxes:</span> Array[Array[Double]] = {
    val root = XML.<span style="color: #336699">loadFile</span>(configuration.<span style="color: #336699">boundingBoxes</span>)
    var boundingBoxes = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[Array[Double]]
    (root <span style="color: #a61717; background-color: #e3d2d2">\\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;boundingBox&quot;</span>).<span style="color: #336699">foreach</span>(b =&gt; {
      val sw_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
      val sw_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>
      val ne_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
      val ne_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>

      boundingBoxes += Array(sw_lat.<span style="color: #336699">toDouble</span>, sw_long.<span style="color: #336699">toDouble</span>)
      boundingBoxes += Array(ne_lat.<span style="color: #336699">toDouble</span>, ne_long.<span style="color: #336699">toDouble</span>)
    })
    boundingBoxes.<span style="color: #336699">toArray</span>
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Writer.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">falcon</span>.<span style="color: #336699">writer</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.nio.charset.Charset</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: falcon</span>
<span style="color: #888888"> * Package: org.falcon.writer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
object Writer {
  <span style="color: #008800; font-weight: bold">private</span> var <span style="color: #336699; font-style: italic">writer:</span> BufferedWriter = <span style="color: #008800; font-weight: bold">null</span>

  def <span style="color: #0066bb; font-weight: bold">open</span>(<span style="color: #336699; font-style: italic">file:</span> String) ={
    <span style="color: #008800; font-weight: bold">if</span> (writer == <span style="color: #008800; font-weight: bold">null</span>){
      val charset = Charset.<span style="color: #336699">forName</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;UTF-8&quot;</span>).<span style="color: #336699">newEncoder</span>()
      writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(file, <span style="color: #008800; font-weight: bold">true</span>), charset))
    }
  }

  def <span style="color: #0066bb; font-weight: bold">close</span>() = {
    <span style="color: #008800; font-weight: bold">if</span> (writer != <span style="color: #008800; font-weight: bold">null</span>) { writer.<span style="color: #336699">close</span>(); writer = <span style="color: #008800; font-weight: bold">null</span> }
  }

  def <span style="color: #0066bb; font-weight: bold">write</span>(<span style="color: #336699; font-style: italic">string:</span> String) = {
    <span style="color: #008800; font-weight: bold">if</span> (writer != <span style="color: #008800; font-weight: bold">null</span>) { writer.<span style="color: #336699">flush</span>(); writer.<span style="color: #336699">write</span>(string) }
  }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_puma_sistema_de_análisis">Puma (sistema de análisis)</h3>
<div class="listingblock">
<div class="title">Main.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">main</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.generator.GeneratorFactory</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.</span>{Configuration, ConfigurationUtil, CLIParser}

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.main</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * User: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
object Main {
  def <span style="color: #0066bb; font-weight: bold">main</span>(<span style="color: #336699; font-style: italic">args:</span> Array[String]): Unit = CLIParser.<span style="color: #336699">parse</span>(args, Configuration()) map { config =&gt; run(config) }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">run</span>(<span style="color: #336699; font-style: italic">config:</span> Configuration) {
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;==============================================&quot;</span>)
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;                    puma                      &quot;</span>)
    println(<span style="color: #dd2200; background-color: #fff0f0">&quot;==============================================&quot;</span>)
    println()

    ConfigurationUtil.<span style="color: #336699">load</span>(config)
    val generator = GeneratorFactory.<span style="color: #336699">get</span>
    generator.<span style="color: #336699">generate</span>()
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GeneratorFactory.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">generator</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.generator</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
object GeneratorFactory {
  def <span style="color: #336699; font-style: italic">get:</span>Generator = {
    val mode = ConfigurationUtil.<span style="color: #336699">getMode</span>
    mode match {
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;scoreGenerator&quot;</span> =&gt; <span style="color: #008800; font-weight: bold">new</span> ScoreGenerator
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;llrGenerator&quot;</span> =&gt; <span style="color: #008800; font-weight: bold">new</span> LLRGenerator
      <span style="color: #008800; font-weight: bold">case</span> _ =&gt; <span style="color: #008800; font-weight: bold">throw</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">IllegalStateException</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Invalid mode&quot;</span>)
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generator.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">generator</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.generator</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
trait Generator {
  def <span style="color: #0066bb; font-weight: bold">generate</span>(): Unit
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LLRGenerator.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">generator</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.Analyzer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.filter.ExtractorFilter</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.util.Calendar</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.text.SimpleDateFormat</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.Console</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.generator</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #bb0066; font-weight: bold">LLRGenerator</span> <span style="color: #008800; font-weight: bold">extends</span> Generator {
  def <span style="color: #0066bb; font-weight: bold">generate</span>(): Unit = {
    <span style="color: #008800; font-weight: bold">try</span>{
      val files  = ConfigurationUtil.<span style="color: #336699">getFilesToAnalyze</span>
      val local  = files(<span style="color: #0000DD; font-weight: bold">0</span>)
      val global = files(<span style="color: #0000DD; font-weight: bold">1</span>)

      ConfigurationUtil.<span style="color: #336699">getFiltersToApply</span>.<span style="color: #336699">foreach</span>(f =&gt; {
        val analyzer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Analyzer</span>(local, global, f)
        val mostValuedTerms = analyzer.<span style="color: #336699">analyze</span>
        <span style="color: #0066bb; font-weight: bold">saveToFile</span>(mostValuedTerms, f)
      })
    }<span style="color: #008800; font-weight: bold">catch</span> {
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">ex:</span> FileNotFoundException =&gt; Console.<span style="color: #336699">err</span>.<span style="color: #336699">println</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;ERROR: The file does not exist. &quot;</span> + ex.<span style="color: #336699">getMessage</span>)
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">saveToFile</span>(<span style="color: #336699; font-style: italic">terms:</span>List[(List[String], Double)], <span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter): Unit = {
    val title =
      <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleDateFormat</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;yyyyMMddHHmmss&quot;</span>).<span style="color: #336699">format</span>(Calendar.<span style="color: #336699">getInstance</span>.<span style="color: #336699">getTime</span>)
    val filterName = filter.<span style="color: #336699">getClass</span>.<span style="color: #336699">getSimpleName</span>

    val file = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;${title}_$filterName.tsv&quot;</span>)
    <span style="color: #008800; font-weight: bold">if</span>(!file.<span style="color: #336699">exists</span>) file.<span style="color: #336699">createNewFile</span>

    val writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(file)))
    <span style="color: #008800; font-weight: bold">try</span>{
      terms.<span style="color: #336699">foreach</span>(t =&gt; writer.<span style="color: #336699">write</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;${t._2}\t${t._1.mkString(&quot;</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;)}\n&quot;</span>))
    }<span style="color: #008800; font-weight: bold">finally</span>{
      writer.<span style="color: #336699">flush</span>()
      writer.<span style="color: #336699">close</span>()
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ScoreGenerator.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">generator</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.filter._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.NgramExtractor</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io.</span>{FileOutputStream, OutputStreamWriter, BufferedWriter, File}
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull.</span>{EvElemEnd, EvText, EvElemStart, XMLEventReader}
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.XML</span>


<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.generator</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #bb0066; font-weight: bold">ScoreGenerator</span> <span style="color: #008800; font-weight: bold">extends</span> Generator{

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val resultFiles   = ConfigurationUtil.<span style="color: #336699">getLLRResultFiles</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val fileToAnalyze = ConfigurationUtil.<span style="color: #336699">getFileToAnalyze</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val scoreByTerm   = getScores.<span style="color: #336699">withDefaultValue</span>(<span style="color: #0000DD; font-weight: bold">0.0</span>)
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val boundingBoxes = getBoundingBoxes

  def <span style="color: #0066bb; font-weight: bold">generate</span>(): Unit = {
    val location, text, latitude, longitude, username = <span style="color: #008800; font-weight: bold">new</span> mutable.<span style="color: #336699">StringBuilder</span>()
    var insideLocation, insideText, insideLatitude, insideLongitude, insideUsername = <span style="color: #008800; font-weight: bold">false</span>

    val reader = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">XMLEventReader</span>(Source.<span style="color: #336699">fromFile</span>(fileToAnalyze))
    reader.<span style="color: #336699">foreach</span>({
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;username&quot;</span>, _, _)  =&gt; insideUsername = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;username&quot;</span>)          =&gt; insideUsername = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;location&quot;</span>, _, _)  =&gt; insideLocation = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;location&quot;</span>)          =&gt; insideLocation = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>, _, _)  =&gt; insideLatitude = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>)          =&gt; insideLatitude = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>, _, _) =&gt; insideLongitude = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>)         =&gt; insideLongitude = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>, _, _)      =&gt; insideText = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>)              =&gt; insideText = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvText</span>(nodeText) =&gt;
        {
          <span style="color: #008800; font-weight: bold">if</span>(insideLocation)
            location ++= nodeText
          <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">if</span>(insideLatitude)
            latitude ++= nodeText
          <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">if</span>(insideLongitude)
            longitude ++= nodeText
          <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">if</span>(insideText)
            text ++= nodeText
          <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">if</span>(insideUsername)
            username ++= nodeText
        }
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;tweet&quot;</span>) =&gt;
        {
          processXmlData(username.<span style="color: #336699">toString</span>(), location.<span style="color: #336699">toString</span>(), latitude.<span style="color: #336699">toString</span>(), longitude.<span style="color: #336699">toString</span>(), text.<span style="color: #336699">toString</span>())
          location.<span style="color: #336699">clear</span>()
          latitude.<span style="color: #336699">clear</span>()
          longitude.<span style="color: #336699">clear</span>()
          text.<span style="color: #336699">clear</span>()
          username.<span style="color: #336699">clear</span>()
        }
        <span style="color: #008800; font-weight: bold">case</span> _ =&gt; ;
    })
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">processXmlData</span>(<span style="color: #336699; font-style: italic">username:</span> String, <span style="color: #336699; font-style: italic">location:</span> String, <span style="color: #336699; font-style: italic">lat:</span> String, <span style="color: #336699; font-style: italic">lng:</span> String, <span style="color: #336699; font-style: italic">text:</span> String): Unit = {
    val locationKeywords = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">LocationFilter</span>().<span style="color: #336699">extract</span>(location)
    val mentionsHashtags = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">MentionFilter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">HashtagFilter</span>()).<span style="color: #336699">extract</span>(text)
    val bigrams  = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BigramsFilter</span>().<span style="color: #336699">extract</span>(text)
    val keywords = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">KeywordFilter</span>().<span style="color: #336699">extract</span>(text).<span style="color: #336699">filter</span>(keyword =&gt; {
      bigrams.<span style="color: #336699">find</span>(bigram =&gt; bigram.<span style="color: #336699">contains</span>(keyword)) == None
    })

    val terms = locationKeywords ++ mentionsHashtags ++ bigrams ++ keywords

    val score = terms.<span style="color: #336699">foldLeft</span>(<span style="color: #0000DD; font-weight: bold">0.0</span>)((acc, current) =&gt; acc + scoreByTerm(current.<span style="color: #336699">mkString</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span>)))
    <span style="color: #008800; font-weight: bold">if</span>(isValidScore(score, lat, lng)){
      saveScore(score, username, location, lat, lng, text)
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">isValidScore</span>(<span style="color: #336699; font-style: italic">score:</span>Double, <span style="color: #336699; font-style: italic">latitude:</span>String, <span style="color: #336699; font-style: italic">longitude:</span>String): Boolean = {
    <span style="color: #008800; font-weight: bold">if</span>(score == <span style="color: #0000DD; font-weight: bold">0.0</span>) <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span>

    val mustBeLocal = score &gt; <span style="color: #0000DD; font-weight: bold">0.0</span>
    mustBeLocal == isInBoundingBoxes(longitude, latitude)
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">saveScore</span>(<span style="color: #336699; font-style: italic">score:</span>Double, <span style="color: #336699; font-style: italic">username:</span>String, <span style="color: #336699; font-style: italic">location:</span>String, <span style="color: #336699; font-style: italic">latitude:</span>String, <span style="color: #336699; font-style: italic">longitude:</span>String, <span style="color: #336699; font-style: italic">text:</span>String) = {
    val file = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;${fileToAnalyze}_scores.tsv&quot;</span>)
    <span style="color: #008800; font-weight: bold">if</span>(!file.<span style="color: #336699">exists</span>) file.<span style="color: #336699">createNewFile</span>

    val writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(file, <span style="color: #008800; font-weight: bold">true</span>)))
    val line = score + <span style="color: #dd2200; background-color: #fff0f0">&quot;\t&quot;</span> + latitude.<span style="color: #336699">trim</span> + <span style="color: #dd2200; background-color: #fff0f0">&quot;\t&quot;</span> + longitude.<span style="color: #336699">trim</span> + <span style="color: #dd2200; background-color: #fff0f0">&quot;\t&quot;</span> + normalize(username, location, text) + <span style="color: #dd2200; background-color: #fff0f0">&quot;\n&quot;</span>
    <span style="color: #008800; font-weight: bold">try</span>{
      writer.<span style="color: #336699">write</span>(line)
    }<span style="color: #008800; font-weight: bold">finally</span>{
      writer.<span style="color: #336699">flush</span>()
      writer.<span style="color: #336699">close</span>()
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">normalize</span>(<span style="color: #336699; font-style: italic">username:</span>String, <span style="color: #336699; font-style: italic">location:</span>String, <span style="color: #336699; font-style: italic">text:</span>String): String = {
    val normalized = NgramExtractor.<span style="color: #336699">extract</span>(location.<span style="color: #336699">trim</span> + <span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span> + text.<span style="color: #336699">trim</span>(), <span style="color: #0000DD; font-weight: bold">1</span>, allowMentionsAndHashtags = <span style="color: #008800; font-weight: bold">true</span>).<span style="color: #336699">flatten</span>.<span style="color: #336699">mkString</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span>)
    <span style="color: #dd2200; background-color: #fff0f0">&quot;@&quot;</span> + username.<span style="color: #336699">toLowerCase</span>.<span style="color: #336699">trim</span> + <span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span> + normalized
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">getScores:</span> Map[String, Double] = {
    val scores = mutable.<span style="color: #336699">Map</span>.<span style="color: #336699">empty</span>[String, Double]
    resultFiles.<span style="color: #336699">foreach</span>(file =&gt; {
      val lines = Source.<span style="color: #336699">fromFile</span>(file).<span style="color: #336699">getLines</span>().<span style="color: #336699">toArray</span>
      lines.<span style="color: #336699">foreach</span>(line =&gt; {
       val fields = line.<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;\t&quot;</span>)
       scores(fields(<span style="color: #0000DD; font-weight: bold">1</span>)) = fields(<span style="color: #0000DD; font-weight: bold">0</span>).<span style="color: #336699">toDouble</span>
      })
    })
    scores.<span style="color: #336699">toMap</span>
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">getBoundingBoxes:</span> List[List[(Double, Double)]] = {
    val root = XML.<span style="color: #336699">loadFile</span>(ConfigurationUtil.<span style="color: #336699">getBoundingBoxesFile</span>)
    var boundingBoxes = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[List[(Double, Double)]]
    (root <span style="color: #a61717; background-color: #e3d2d2">\\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;boundingBox&quot;</span>).<span style="color: #336699">foreach</span>(b =&gt; {
      val sw_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
      val sw_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>
      val ne_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
      val ne_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>

      boundingBoxes += List((sw_lat.<span style="color: #336699">toDouble</span>, sw_long.<span style="color: #336699">toDouble</span>), (ne_lat.<span style="color: #336699">toDouble</span>, ne_long.<span style="color: #336699">toDouble</span>))
    })
    boundingBoxes.<span style="color: #336699">toList</span>
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">isInBoundingBoxes</span>(<span style="color: #336699; font-style: italic">lng:</span> String, <span style="color: #336699; font-style: italic">lat:</span> String): Boolean = {
    boundingBoxes.<span style="color: #336699">exists</span>(boundingBox =&gt; {
      val sw = boundingBox(<span style="color: #0000DD; font-weight: bold">0</span>)
      val ne = boundingBox(<span style="color: #0000DD; font-weight: bold">1</span>)
      sw.<span style="color: #336699">_1</span> &lt;= lat.<span style="color: #336699">toDouble</span> &amp;&amp; ne.<span style="color: #336699">_1</span> &gt;= lat.<span style="color: #336699">toDouble</span> &amp;&amp; sw.<span style="color: #336699">_2</span> &lt;= lng.<span style="color: #336699">toDouble</span> &amp;&amp; ne.<span style="color: #336699">_2</span> &gt;= lng.<span style="color: #336699">toDouble</span>
    })
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Extractor.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull.EvElemStart</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull.EvText</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.filter.ExtractorFilter</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">com.typesafe.scalalogging.slf4j.LazyLogging</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 09/2013</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #bb0066; font-weight: bold">Extractor</span> <span style="color: #008800; font-weight: bold">extends</span> LazyLogging{
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_path:</span> String = <span style="color: #008800; font-weight: bold">null</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_filter:</span> ExtractorFilter = <span style="color: #008800; font-weight: bold">null</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var results = mutable.<span style="color: #336699">Map</span>.<span style="color: #336699">empty</span>[List[String], Int]
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var minimumFreq = <span style="color: #0000DD; font-weight: bold">1</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val MaximumExtractedTerms = ConfigurationUtil.<span style="color: #336699">getMaximumExtractedTerms</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FactorToRemove = ConfigurationUtil.<span style="color: #336699">getFactorToRemove</span>

  def <span style="color: #0066bb; font-weight: bold">path</span>(<span style="color: #336699; font-style: italic">value:</span> String): Extractor = {
    _path = value
    <span style="color: #008800; font-weight: bold">this</span>
  }

  def <span style="color: #0066bb; font-weight: bold">filter</span>(<span style="color: #336699; font-style: italic">value:</span> ExtractorFilter): Extractor = {
    _filter = value
    <span style="color: #008800; font-weight: bold">this</span>
  }

  def <span style="color: #336699; font-style: italic">extract:</span> Map[List[String], Int] = {
    <span style="color: #008800; font-weight: bold">if</span>(_filter == <span style="color: #008800; font-weight: bold">null</span> || _path == <span style="color: #008800; font-weight: bold">null</span>){
      <span style="color: #008800; font-weight: bold">throw</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">IllegalArgumentException</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;You must provide a filter and valid path for making the extraction&quot;</span>)
    }

    logger.<span style="color: #336699">debug</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Extracting: &quot;</span> + _path + <span style="color: #dd2200; background-color: #fff0f0">&quot; with filter: &quot;</span> + _filter.<span style="color: #336699">getClass</span>.<span style="color: #336699">getSimpleName</span>)

    val reader = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">XMLEventReader</span>(Source.<span style="color: #336699">fromFile</span>(_path))
    var in = <span style="color: #008800; font-weight: bold">false</span>
    reader.<span style="color: #336699">foreach</span>({
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemStart <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> == _filter.<span style="color: #336699">field</span> =&gt; in = <span style="color: #008800; font-weight: bold">true</span>
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvText</span>(text) <span style="color: #008800; font-weight: bold">if</span> in =&gt; applyFilter(text)
        <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemEnd <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> == _filter.<span style="color: #336699">field</span> =&gt; in = <span style="color: #008800; font-weight: bold">false</span>
        <span style="color: #008800; font-weight: bold">case</span> _ =&gt; ;
    })
    results.<span style="color: #336699">toMap</span>
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">applyFilter</span>(<span style="color: #336699; font-style: italic">tweet:</span> String) = {
    checkMemoryStatus()
    _filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">foreach</span>(term =&gt; {
      <span style="color: #008800; font-weight: bold">if</span>(results.<span style="color: #336699">contains</span>(term)){
        results(term) += <span style="color: #0000DD; font-weight: bold">1</span>
      }<span style="color: #008800; font-weight: bold">else</span>{
        results(term) = minimumFreq
      }
    })
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">checkMemoryStatus</span>() = {
    <span style="color: #008800; font-weight: bold">if</span>(results.<span style="color: #336699">keys</span>.<span style="color: #336699">size</span> &gt;= MaximumExtractedTerms) {
      logger.<span style="color: #336699">debug</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Memory overload. Maximum limit for extracted terms have been reached. Reducing map...&quot;</span>)
      reduceMapLoad()
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">reduceMapLoad</span>() = {
    val itemsToRemove = (results.<span style="color: #336699">keys</span>.<span style="color: #336699">size</span> * FactorToRemove).<span style="color: #336699">toInt</span>
    logger.<span style="color: #336699">debug</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;They are going to be removed &quot;</span> + itemsToRemove + <span style="color: #dd2200; background-color: #fff0f0">&quot; items&quot;</span>)

    val orderedList = results.<span style="color: #336699">toList</span>.<span style="color: #336699">sortBy</span>({_.<span style="color: #336699">_2</span>})
    minimumFreq = orderedList(itemsToRemove - <span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">_2</span>
    logger.<span style="color: #336699">debug</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;New minimum frequency is &quot;</span> + minimumFreq)

    val reduced = orderedList.<span style="color: #336699">slice</span>(itemsToRemove - <span style="color: #0000DD; font-weight: bold">1</span>, orderedList.<span style="color: #336699">size</span>)
    results = collection.<span style="color: #336699">mutable</span>.<span style="color: #336699">Map</span>(reduced.<span style="color: #336699">toMap</span>[List[String], Int].<span style="color: #336699">toSeq</span>: _*) <span style="color: #888888">// converting to mutable map</span>
    logger.<span style="color: #336699">debug</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Reduced map contains &quot;</span> + results.<span style="color: #336699">keys</span>.<span style="color: #336699">size</span> + <span style="color: #dd2200; background-color: #fff0f0">&quot; terms&quot;</span>)
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">NgramExtractor.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer.filter</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
object NgramExtractor {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val SymbolsToClean = Array(<span style="color: #dd2200; background-color: #fff0f0">&#39;\\&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;,&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;(&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;\&#39;&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;)&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;{&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;}&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;?&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;¿&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;¡&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;!&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;.&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;&amp;&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;%&#39;</span>,
    <span style="color: #dd2200; background-color: #fff0f0">&#39;$&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;;&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;:&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;+&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;-&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;*&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;^&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;/&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;_&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;\n&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;\t&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;=&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;|&#39;</span>)

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span>String, <span style="color: #336699; font-style: italic">count:</span>Int, <span style="color: #336699; font-style: italic">allowMentionsAndHashtags:</span>Boolean = <span style="color: #008800; font-weight: bold">false</span>): List[List[String]] = {
    var result = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[List[String]]
    val ngrams = getNgrams(clear(tweet), count)
    ngrams.<span style="color: #336699">foreach</span>(ngram =&gt; {
      <span style="color: #008800; font-weight: bold">if</span> (isValidNgram(ngram, count, allowMentionsAndHashtags)) {
        val termToAdd = ngram.<span style="color: #336699">map</span>(ngram =&gt; ngram.<span style="color: #336699">trim</span>).<span style="color: #336699">toList</span>
        <span style="color: #008800; font-weight: bold">if</span>(!result.<span style="color: #336699">contains</span>(termToAdd)) result += termToAdd
      }
    })
    result.<span style="color: #336699">toList</span>
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">isValidNgram</span>(<span style="color: #336699; font-style: italic">ngram:</span>Array[String], <span style="color: #336699; font-style: italic">count:</span>Int, <span style="color: #336699; font-style: italic">allowMentionsAndHashtags:</span>Boolean): Boolean = {
    ngram.<span style="color: #336699">size</span> == count &amp;&amp;
    ngram.<span style="color: #336699">find</span>(term =&gt; term.<span style="color: #336699">trim</span>.<span style="color: #336699">isEmpty</span>) == None &amp;&amp;
    ngram.<span style="color: #336699">find</span>(term =&gt; term.<span style="color: #336699">trim</span>.<span style="color: #336699">length</span> == <span style="color: #0000DD; font-weight: bold">1</span>) == None &amp;&amp;
    isValidCharSequence(ngram, allowMentionsAndHashtags) &amp;&amp;
    !ngram.<span style="color: #336699">forall</span>(term =&gt; <span style="color: #008800; font-weight: bold">if</span>(count &gt; <span style="color: #0000DD; font-weight: bold">1</span>) term.<span style="color: #336699">trim</span> == ngram(<span style="color: #0000DD; font-weight: bold">0</span>).<span style="color: #336699">trim</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">false</span>) &amp;&amp;
    !hasStopWords(ngram, allowMentionsAndHashtags)
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">isValidCharSequence</span>(<span style="color: #336699; font-style: italic">ngram:</span>Array[String], <span style="color: #336699; font-style: italic">allowMentionsAndHashtags:</span>Boolean): Boolean = {
    <span style="color: #008800; font-weight: bold">if</span>(allowMentionsAndHashtags) {
      ngram.<span style="color: #336699">find</span>(term =&gt; !term.<span style="color: #336699">trim</span>.<span style="color: #336699">matches</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;^(@|#)?[a-záéíóú]*&quot;</span>)) == None
    }<span style="color: #008800; font-weight: bold">else</span> {
      ngram.<span style="color: #336699">find</span>(term =&gt; !term.<span style="color: #336699">trim</span>.<span style="color: #336699">matches</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;[a-záéíóú]*&quot;</span>)) == None
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">hasStopWords</span>(<span style="color: #336699; font-style: italic">ngram:</span>Array[String], <span style="color: #336699; font-style: italic">allowMentionsAndHashtags:</span>Boolean): Boolean = {
    ngram.<span style="color: #336699">exists</span>(term =&gt; {
      <span style="color: #008800; font-weight: bold">if</span>(allowMentionsAndHashtags &amp;&amp; (term.<span style="color: #336699">startsWith</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;@&quot;</span>) || term.<span style="color: #336699">startsWith</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;#&quot;</span>))) {
        <span style="color: #008800; font-weight: bold">false</span>
      }<span style="color: #008800; font-weight: bold">else</span> {
        ConfigurationUtil.<span style="color: #336699">stopWords</span>.<span style="color: #336699">contains</span>(term.<span style="color: #336699">trim</span>)
      }
    })
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">clear</span>(<span style="color: #336699; font-style: italic">raw:</span>String): String = {
    raw.<span style="color: #336699">toLowerCase</span>.<span style="color: #336699">trim</span>.<span style="color: #336699">map</span>[Char, String](<span style="color: #888888; font-weight: bold">char</span> =&gt; <span style="color: #008800; font-weight: bold">if</span>(SymbolsToClean.<span style="color: #336699">contains</span>(<span style="color: #888888; font-weight: bold">char</span>)) <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #888888; font-weight: bold">char</span>)
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">getNgrams</span>(<span style="color: #336699; font-style: italic">tweet:</span>String, <span style="color: #336699; font-style: italic">count:</span> Int): List[Array[String]] = {
    val words = tweet.<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span>)
    words.<span style="color: #336699">combinations</span>(count).<span style="color: #336699">toList</span>
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ExtractorFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>


<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
trait ExtractorFilter {
  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]]
  def <span style="color: #336699; font-style: italic">field:</span> String
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">SimpleTermExtractorFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #bb0066; font-weight: bold">SimpleTermExtractorFilter</span> <span style="color: #008800; font-weight: bold">extends</span> ExtractorFilter{
  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    List.<span style="color: #336699">empty</span>[List[String]]
  }

  def <span style="color: #336699; font-style: italic">field:</span>String = <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ExtractorFilterDecorator.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer.filter</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">abstract</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> ExtractorFilter{
  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">MentionFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.JavaConverters._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">MentionFilter</span>(<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(filter) {
  def <span style="color: #0066bb; font-weight: bold">this</span>() = <span style="color: #008800; font-weight: bold">this</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleTermExtractorFilter</span>())

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val extractor = <span style="color: #008800; font-weight: bold">new</span> com.<span style="color: #336699">twitter</span>.<span style="color: #336699">Extractor</span>

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    val mentions = filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">to</span>[ListBuffer] <span style="color: #888888">// initializing with previous extraction</span>
    extractor.<span style="color: #336699">extractMentionedScreennames</span>(tweet).<span style="color: #336699">asScala</span>.<span style="color: #336699">foreach</span>(term =&gt; {
      mentions += List(term.<span style="color: #336699">toLowerCase</span>)
    })
    mentions.<span style="color: #336699">toList</span>
  }

  def <span style="color: #336699; font-style: italic">field:</span> String = <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">HashtagFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.JavaConverters._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">HashtagFilter</span>(<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(filter){
  def <span style="color: #0066bb; font-weight: bold">this</span>() = <span style="color: #008800; font-weight: bold">this</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleTermExtractorFilter</span>())

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val extractor = <span style="color: #008800; font-weight: bold">new</span> com.<span style="color: #336699">twitter</span>.<span style="color: #336699">Extractor</span>

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    val hashtags = filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">to</span>[ListBuffer] <span style="color: #888888">// initializing with previous extraction</span>
    extractor.<span style="color: #336699">extractHashtags</span>(tweet).<span style="color: #336699">asScala</span>.<span style="color: #336699">foreach</span>(term =&gt; {
      hashtags += List(term.<span style="color: #336699">toLowerCase</span>)
    })
    hashtags.<span style="color: #336699">toList</span>
  }

  def <span style="color: #336699; font-style: italic">field:</span> String = <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">BigramsFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.NgramExtractor</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">BigramsFilter</span>(<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(filter) {
  def <span style="color: #0066bb; font-weight: bold">this</span>() = <span style="color: #008800; font-weight: bold">this</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleTermExtractorFilter</span>())

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    val results = filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">to</span>[ListBuffer] <span style="color: #888888">// initializing with previous extraction</span>
    NgramExtractor.<span style="color: #336699">extract</span>(tweet, <span style="color: #0000DD; font-weight: bold">2</span>).<span style="color: #336699">foreach</span>(ngram =&gt; results += ngram)
    results.<span style="color: #336699">toList</span>
  }

  def <span style="color: #336699; font-style: italic">field:</span> String = <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">KeywordFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.NgramExtractor</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer.filter</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">KeywordFilter</span> (<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(filter) {
  def <span style="color: #0066bb; font-weight: bold">this</span>() = <span style="color: #008800; font-weight: bold">this</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleTermExtractorFilter</span>())

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    val results = filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">to</span>[ListBuffer] <span style="color: #888888">// initializing with previous extraction</span>
    NgramExtractor.<span style="color: #336699">extract</span>(tweet, <span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">foreach</span>(ngram =&gt; results += ngram)
    results.<span style="color: #336699">toList</span>
  }

  def <span style="color: #336699; font-style: italic">field:</span> String = <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LocationFilter.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>.<span style="color: #336699">filter</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.NgramExtractor</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer.filter</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 03/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">LocationFilter</span>(<span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) <span style="color: #008800; font-weight: bold">extends</span> <span style="color: #0066bb; font-weight: bold">ExtractorFilterDecorator</span>(filter) {
  def <span style="color: #0066bb; font-weight: bold">this</span>() = <span style="color: #008800; font-weight: bold">this</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">SimpleTermExtractorFilter</span>())

  def <span style="color: #0066bb; font-weight: bold">extract</span>(<span style="color: #336699; font-style: italic">tweet:</span> String): List[List[String]] = {
    val results = filter.<span style="color: #336699">extract</span>(tweet).<span style="color: #336699">to</span>[ListBuffer] <span style="color: #888888">// initializing with previous extraction</span>
    NgramExtractor.<span style="color: #336699">extract</span>(tweet, <span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">foreach</span>(ngram =&gt; results += ngram)
    results.<span style="color: #336699">toList</span>
  }

  def <span style="color: #336699; font-style: italic">field:</span> String = <span style="color: #dd2200; background-color: #fff0f0">&quot;location&quot;</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Analyzer.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">analyzer</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.configuration.ConfigurationUtil</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.stat.Dunning</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.filter.ExtractorFilter</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.analyzer</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Analyzer</span>(<span style="color: #336699; font-style: italic">local:</span> String, <span style="color: #336699; font-style: italic">global:</span> String, <span style="color: #336699; font-style: italic">filter:</span> ExtractorFilter) {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val localTerms =
    <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Extractor</span>().<span style="color: #336699">filter</span>(filter).<span style="color: #336699">path</span>(local).<span style="color: #336699">extract</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val globalTerms =
    <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">Extractor</span>().<span style="color: #336699">filter</span>(filter).<span style="color: #336699">path</span>(global).<span style="color: #336699">extract</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val totalLocalFrequencies = localTerms.<span style="color: #336699">foldLeft</span>(<span style="color: #0000DD; font-weight: bold">0</span>)(_+_.<span style="color: #336699">_2</span>)
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val totalGlobalFrequencies = globalTerms.<span style="color: #336699">foldLeft</span>(<span style="color: #0000DD; font-weight: bold">0</span>)(_+_.<span style="color: #336699">_2</span>)

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val results = mutable.<span style="color: #336699">Map</span>.<span style="color: #336699">empty</span>[List[String], Double]
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val commonFreq = mutable.<span style="color: #336699">Map</span>.<span style="color: #336699">empty</span>[Int, Int]
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val minFrequencyLLR = ConfigurationUtil.<span style="color: #336699">getMinFrequencyForLLR</span>

  def <span style="color: #336699; font-style: italic">analyze:</span> List[(List[String], Double)] = {
    localTerms.<span style="color: #336699">keys</span>.<span style="color: #336699">foreach</span>(terms =&gt; {
      val localFreq = localTerms.<span style="color: #336699">get</span>(terms).<span style="color: #336699">get</span>.<span style="color: #336699">toLong</span>
      <span style="color: #008800; font-weight: bold">if</span>(localFreq &gt; minFrequencyLLR) {
        val globalOption = globalTerms.<span style="color: #336699">get</span>(terms)
        val <span style="color: #336699; font-style: italic">globalFreq:</span>Long =
          <span style="color: #008800; font-weight: bold">if</span> (globalOption.<span style="color: #336699">isDefined</span>) globalOption.<span style="color: #336699">get</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">averageGlobalFrequency</span>(terms)

        <span style="color: #008800; font-weight: bold">if</span>(globalFreq &gt; <span style="color: #0000DD; font-weight: bold">0</span>) {
          val k11 = localFreq
          val k12 = globalFreq
          val k21 = totalLocalFrequencies
          val k22 = totalGlobalFrequencies
          val llr = Dunning.<span style="color: #336699">normalizedRootLogLikelihoodRatio</span>(k11, k12, k21, k22)
          results.<span style="color: #336699">put</span>(terms, llr)
        }
      }
    })
    results.<span style="color: #336699">toList</span>.<span style="color: #336699">sortBy</span>({ _.<span style="color: #336699">_2</span> })
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">averageGlobalFrequency</span>(<span style="color: #336699; font-style: italic">terms:</span> List[String]): Int = {
    <span style="color: #008800; font-weight: bold">if</span>(commonFreq.<span style="color: #336699">get</span>(localTerms.<span style="color: #336699">get</span>(terms).<span style="color: #336699">get</span>).<span style="color: #336699">isDefined</span>) {
      <span style="color: #008800; font-weight: bold">return</span> commonFreq.<span style="color: #336699">get</span>(localTerms.<span style="color: #336699">get</span>(terms).<span style="color: #336699">get</span>).<span style="color: #336699">get</span>
    }

    val sameFreq = localTerms.<span style="color: #336699">filterKeys</span>((localTerm) =&gt;
      globalTerms.<span style="color: #336699">get</span>(localTerm).<span style="color: #336699">isDefined</span> &amp;&amp; localTerms.<span style="color: #336699">get</span>(localTerm).<span style="color: #336699">get</span> == localTerms.<span style="color: #336699">get</span>(terms).<span style="color: #336699">get</span>
    )

    val avg = <span style="color: #008800; font-weight: bold">if</span>(!sameFreq.<span style="color: #336699">isEmpty</span>) sameFreq.<span style="color: #336699">foldLeft</span>(<span style="color: #0000DD; font-weight: bold">0</span>)(_+_.<span style="color: #336699">_2</span>) / sameFreq.<span style="color: #336699">size</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0000DD; font-weight: bold">0</span>
    commonFreq.<span style="color: #336699">put</span>(localTerms.<span style="color: #336699">get</span>(terms).<span style="color: #336699">get</span>, avg)

    avg
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dunning.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">stat</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.stat</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Daniel Gayo-Avello</span>
<span style="color: #888888"> * Date: 02/2014</span>
<span style="color: #888888"> */</span>
object Dunning {

  def <span style="color: #0066bb; font-weight: bold">rootLogLikelihoodRatio</span>(<span style="color: #336699; font-style: italic">a:</span> Long, <span style="color: #336699; font-style: italic">b:</span> Long, <span style="color: #336699; font-style: italic">c:</span> Long, <span style="color: #336699; font-style: italic">d:</span> Long): Double = {
    val E1 = c * ((a + b) / (c + d).<span style="color: #336699">toDouble</span>)
    val E2 = d * ((a + b) / (c + d).<span style="color: #336699">toDouble</span>)

    val E3 = <span style="color: #008800; font-weight: bold">if</span>(a == <span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #0000DD; font-weight: bold">1</span>/E1 <span style="color: #008800; font-weight: bold">else</span> a/E1
    val E4 = <span style="color: #008800; font-weight: bold">if</span>(b == <span style="color: #0000DD; font-weight: bold">0</span>) <span style="color: #0000DD; font-weight: bold">1</span>/E2 <span style="color: #008800; font-weight: bold">else</span> b/E2
    val result = Math.<span style="color: #336699">sqrt</span>(<span style="color: #0000DD; font-weight: bold">2</span> * (a * Math.<span style="color: #336699">log</span>(E3) + b * Math.<span style="color: #336699">log</span>(E4)))

    <span style="color: #008800; font-weight: bold">if</span> ((a / c.<span style="color: #336699">toDouble</span>) &lt; (b / d.<span style="color: #336699">toDouble</span>)) -result <span style="color: #008800; font-weight: bold">else</span> result
  }

  def <span style="color: #0066bb; font-weight: bold">normalizedRootLogLikelihoodRatio</span> (<span style="color: #336699; font-style: italic">a:</span> Long, <span style="color: #336699; font-style: italic">b:</span> Long, <span style="color: #336699; font-style: italic">c:</span> Long, <span style="color: #336699; font-style: italic">d:</span> Long): Double = {
    val min    = rootLogLikelihoodRatio(<span style="color: #0000DD; font-weight: bold">0</span>,d,c,d)
    val max    = rootLogLikelihoodRatio(c,<span style="color: #0000DD; font-weight: bold">0</span>,c,d)

    val a_norm = a / c.<span style="color: #336699">toDouble</span>
    val b_norm = b / d.<span style="color: #336699">toDouble</span>
    val llr    = rootLogLikelihoodRatio(a,b,c,d)

    <span style="color: #008800; font-weight: bold">if</span> (llr &gt; <span style="color: #0000DD; font-weight: bold">0</span>) llr / (max * a_norm) <span style="color: #008800; font-weight: bold">else</span> -llr / (min * b_norm)
  }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configuration.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">configuration</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io.File</span>

<span style="color: #008800; font-weight: bold">case</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Configuration</span>(<span style="color: #336699; font-style: italic">config:</span> File = <span style="color: #008800; font-weight: bold">null</span>) {}

object CLIParser {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val parser = <span style="color: #008800; font-weight: bold">new</span> scopt.<span style="color: #336699">OptionParser</span>[Configuration](<span style="color: #dd2200; background-color: #fff0f0">&quot;Puma&quot;</span>) {
    head(<span style="color: #dd2200; background-color: #fff0f0">&quot;Puma&quot;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;1.0&quot;</span>)
    opt[File](<span style="color: #dd2200; background-color: #fff0f0">&#39;c&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;config&quot;</span>)
      .<span style="color: #336699">required</span>() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(config = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Configuration XML file for executing Puma.&quot;</span>)
  }

  def <span style="color: #0066bb; font-weight: bold">parse</span>(<span style="color: #336699; font-style: italic">args:</span>Array[String], <span style="color: #336699; font-style: italic">conf:</span>Configuration):Option[Configuration] = <span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">parser</span>.<span style="color: #336699">parse</span>(args, conf)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ConfigurationUtil.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">package</span> org.<span style="color: #336699">puma</span>.<span style="color: #336699">configuration</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">org.puma.analyzer.filter.ExtractorFilter</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.</span>{Elem, XML}
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io.</span>{BufferedReader, File, InputStream}

<span style="color: #888888">/**</span>
<span style="color: #888888"> * Project: puma</span>
<span style="color: #888888"> * Package: org.puma.configuration</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * Author: Sergio Álvarez</span>
<span style="color: #888888"> * Date: 01/2014</span>
<span style="color: #888888"> */</span>
object ConfigurationUtil {

  <span style="color: #888888">/* ===========================================================</span>
<span style="color: #888888">   *                     CONSTANTS</span>
<span style="color: #888888">   * =========================================================== */</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val ModePropertyKey              = <span style="color: #dd2200; background-color: #fff0f0">&quot;mode&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val LocalFilePropertyKey         = <span style="color: #dd2200; background-color: #fff0f0">&quot;local&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val GlobalFilePropertyKey        = <span style="color: #dd2200; background-color: #fff0f0">&quot;global&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FiltersPropertyKey           = <span style="color: #dd2200; background-color: #fff0f0">&quot;filters&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FilterPropertyKey            = <span style="color: #dd2200; background-color: #fff0f0">&quot;filter&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val MinFrequencyForLLRKey        = <span style="color: #dd2200; background-color: #fff0f0">&quot;minimumFrequency&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val MaximumExtractedTermsKey     = <span style="color: #dd2200; background-color: #fff0f0">&quot;maximumExtractedTerms&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FactorToRemoveKey            = <span style="color: #dd2200; background-color: #fff0f0">&quot;factorToRemove&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FilePropertyKey              = <span style="color: #dd2200; background-color: #fff0f0">&quot;file&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val FileToAnalyzePropertyKey     = <span style="color: #dd2200; background-color: #fff0f0">&quot;fileToAnalyze&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val BoundingBoxesFilePropertyKey = <span style="color: #dd2200; background-color: #fff0f0">&quot;localBoundingBoxes&quot;</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val LLRGeneratorKey              = <span style="color: #dd2200; background-color: #fff0f0">&quot;llrGenerator&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val ScoreGeneratorKey            = <span style="color: #dd2200; background-color: #fff0f0">&quot;scoreGenerator&quot;</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val LLRFilesPropertyKey          = <span style="color: #dd2200; background-color: #fff0f0">&quot;llrFiles&quot;</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val StopWordsFileName            = <span style="color: #dd2200; background-color: #fff0f0">&quot;common-stop-words.txt&quot;</span>

  <span style="color: #888888">/* =========================================================== */</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">config:</span> Configuration     = <span style="color: #008800; font-weight: bold">null</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_XmlConfiguration:</span> Elem   = <span style="color: #008800; font-weight: bold">null</span>
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] var <span style="color: #336699; font-style: italic">_stopWords:</span> Array[String] = <span style="color: #008800; font-weight: bold">null</span>

  def <span style="color: #0066bb; font-weight: bold">load</span>(<span style="color: #336699; font-style: italic">config:</span> Configuration): Unit = <span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">config</span> = config

  def <span style="color: #336699; font-style: italic">getMode:</span> String = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> ModePropertyKey).<span style="color: #336699">text</span>

  def <span style="color: #336699; font-style: italic">getFilesToAnalyze:</span> List[String] = {
    val local  = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> LocalFilePropertyKey).<span style="color: #336699">text</span>
    val global = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> GlobalFilePropertyKey).<span style="color: #336699">text</span>
    List(local, global)
  }

  def <span style="color: #336699; font-style: italic">getFiltersToApply:</span> Seq[ExtractorFilter] = {
    (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> FiltersPropertyKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> FilterPropertyKey)
      .<span style="color: #336699">map</span>(n =&gt; Class.<span style="color: #336699">forName</span>(n.<span style="color: #336699">text</span>).<span style="color: #336699">newInstance</span>.<span style="color: #336699">asInstanceOf</span>[ExtractorFilter])
  }

  def <span style="color: #336699; font-style: italic">getMinFrequencyForLLR:</span> Int = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> MinFrequencyForLLRKey).<span style="color: #336699">text</span>.<span style="color: #336699">toInt</span>

  def <span style="color: #336699; font-style: italic">getMaximumExtractedTerms:</span> Int = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> MaximumExtractedTermsKey).<span style="color: #336699">text</span>.<span style="color: #336699">toInt</span>

  def <span style="color: #336699; font-style: italic">getFactorToRemove:</span> Float = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> FactorToRemoveKey).<span style="color: #336699">text</span>.<span style="color: #336699">toFloat</span>

  def <span style="color: #336699; font-style: italic">stopWords:</span> Array[String] = {
    <span style="color: #008800; font-weight: bold">if</span>(_stopWords == <span style="color: #008800; font-weight: bold">null</span>) { _stopWords = loadStopWords }
    _stopWords
  }

  def <span style="color: #336699; font-style: italic">getLLRResultFiles:</span> Seq[String] = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> ScoreGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> LLRFilesPropertyKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> FilePropertyKey).<span style="color: #336699">map</span>(n =&gt; n.<span style="color: #336699">text</span>)

  def <span style="color: #336699; font-style: italic">getFileToAnalyze:</span>String = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> ScoreGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> FileToAnalyzePropertyKey).<span style="color: #336699">text</span>

  def <span style="color: #336699; font-style: italic">getBoundingBoxesFile:</span> String = (XmlConfiguration <span style="color: #a61717; background-color: #e3d2d2">\\</span> ScoreGeneratorKey <span style="color: #a61717; background-color: #e3d2d2">\\</span> BoundingBoxesFilePropertyKey).<span style="color: #336699">text</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">XmlConfiguration:</span> Elem = {
    <span style="color: #008800; font-weight: bold">if</span>(_XmlConfiguration == <span style="color: #008800; font-weight: bold">null</span>) { _XmlConfiguration = XML.<span style="color: #336699">loadFile</span>(config.<span style="color: #336699">config</span>) }
    _XmlConfiguration
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">loadStopWords:</span> Array[String] =
    Source.<span style="color: #336699">fromInputStream</span>(ConfigurationUtil.<span style="color: #336699">getClass</span>.<span style="color: #336699">getResourceAsStream</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;/$StopWordsFileName&quot;</span>)).<span style="color: #336699">getLines</span>().<span style="color: #336699">toArray</span>
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="__em_scripts_em_de_utilidad"><em>Scripts</em> de utilidad</h3>
<div class="listingblock">
<div class="title">training_dataset_divisor.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #a61717; background-color: #e3d2d2">#</span>!/bin/sh
exec scala <span style="color: #dd2200; background-color: #fff0f0">&quot;$0&quot;</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;$@&quot;</span>
!<span style="color: #a61717; background-color: #e3d2d2">#</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>

val TRAINING_PERCENT = <span style="color: #0000DD; font-weight: bold">0.8</span>

val dataset = args(<span style="color: #0000DD; font-weight: bold">0</span>)
val lines = Source.<span style="color: #336699">fromFile</span>(dataset).<span style="color: #336699">getLines</span>.<span style="color: #336699">toArray</span>

val (trainingUsers, testingUsers) = divideUsersForDatasets(lines)

writeLines(dataset + <span style="color: #dd2200; background-color: #fff0f0">&quot;_train&quot;</span>, trainingUsers, lines)
writeLines(dataset + <span style="color: #dd2200; background-color: #fff0f0">&quot;_test&quot;</span>, testingUsers, lines)

<span style="color: #888888">/* ==================================================</span>
<span style="color: #888888"> *                   FUNCTIONS</span>
<span style="color: #888888"> * ================================================== */</span>

def <span style="color: #0066bb; font-weight: bold">divideUsersForDatasets</span>(<span style="color: #336699; font-style: italic">lines:</span>Array[String]):(Array[String], Array[String]) = {
  val users = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[String]
  lines.<span style="color: #336699">foreach</span>(line =&gt; {
      val username = getUserByLine(line)
      <span style="color: #008800; font-weight: bold">if</span>(!users.<span style="color: #336699">contains</span>(username)) users += username
  })

  val forTraining = (users.<span style="color: #336699">length</span> * TRAINING_PERCENT).<span style="color: #336699">toInt</span>
  val train = users.<span style="color: #336699">slice</span>(<span style="color: #0000DD; font-weight: bold">0</span>, forTraining)
  val test  = users.<span style="color: #336699">slice</span>(forTraining, users.<span style="color: #336699">length</span>)

  (train.<span style="color: #336699">toArray</span>, test.<span style="color: #336699">toArray</span>)
}

def <span style="color: #0066bb; font-weight: bold">writeLines</span>(<span style="color: #336699; font-style: italic">datasetName:</span>String, <span style="color: #336699; font-style: italic">users:</span>Array[String], <span style="color: #336699; font-style: italic">lines:</span>Array[String]):Unit = {
  val out = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(datasetName)
  <span style="color: #008800; font-weight: bold">if</span>(!out.<span style="color: #336699">exists</span>) out.<span style="color: #336699">createNewFile</span>
  val writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(out, <span style="color: #008800; font-weight: bold">true</span>)))
  <span style="color: #008800; font-weight: bold">try</span> {
    lines.<span style="color: #336699">foreach</span>(line =&gt; <span style="color: #008800; font-weight: bold">if</span>(users.<span style="color: #336699">contains</span>(getUserByLine(line))) writer.<span style="color: #336699">write</span>(line + <span style="color: #dd2200; background-color: #fff0f0">&quot;\n&quot;</span>))
  } <span style="color: #008800; font-weight: bold">finally</span> {
    writer.<span style="color: #336699">flush</span>()
    writer.<span style="color: #336699">close</span>()
  }
}

def <span style="color: #0066bb; font-weight: bold">getUserByLine</span>(<span style="color: #336699; font-style: italic">line:</span>String):String = {
  val features = line.<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;\\|&quot;</span>);
  val fields = features(<span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span>)
  fields(<span style="color: #0000DD; font-weight: bold">1</span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">tweets_by_location.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #a61717; background-color: #e3d2d2">#</span>!/bin/sh
exec scala <span style="color: #dd2200; background-color: #fff0f0">&quot;$0&quot;</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;$@&quot;</span>
!<span style="color: #a61717; background-color: #e3d2d2">#</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml._</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>

def <span style="color: #0066bb; font-weight: bold">getBoundingBoxes</span>(<span style="color: #336699; font-style: italic">root:</span> Elem): List[List[(Double, Double)]] = {
  var boundingBoxes = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[List[(Double, Double)]]
  (root <span style="color: #a61717; background-color: #e3d2d2">\\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;boundingBox&quot;</span>).<span style="color: #336699">foreach</span>(b =&gt; {
    val sw_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
    val sw_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;sw&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>
    val ne_long = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>).<span style="color: #336699">text</span>
    val ne_lat = (b <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;ne&quot;</span> <span style="color: #a61717; background-color: #e3d2d2">\</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>).<span style="color: #336699">text</span>

    boundingBoxes += List((sw_lat.<span style="color: #336699">toDouble</span>, sw_long.<span style="color: #336699">toDouble</span>), (ne_lat.<span style="color: #336699">toDouble</span>, ne_long.<span style="color: #336699">toDouble</span>))
  })
  boundingBoxes.<span style="color: #336699">toList</span>
}

def <span style="color: #0066bb; font-weight: bold">isInBoundingBoxes</span>(<span style="color: #336699; font-style: italic">latitude:</span> String, <span style="color: #336699; font-style: italic">longitude:</span> String): Boolean = {
  boundingBoxes.<span style="color: #336699">foreach</span>(b =&gt; {
    val sw = b(<span style="color: #0000DD; font-weight: bold">0</span>)
    val ne = b(<span style="color: #0000DD; font-weight: bold">1</span>)
    <span style="color: #008800; font-weight: bold">if</span>(sw.<span style="color: #336699">_1</span> &lt;= latitude.<span style="color: #336699">toDouble</span> &amp;&amp; ne.<span style="color: #336699">_1</span> &gt;= latitude.<span style="color: #336699">toDouble</span> &amp;&amp; sw.<span style="color: #336699">_2</span> &lt;= longitude.<span style="color: #336699">toDouble</span> &amp;&amp; ne.<span style="color: #336699">_2</span> &gt;= longitude.<span style="color: #336699">toDouble</span>) <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span>
  })
  <span style="color: #008800; font-weight: bold">false</span>
}

def <span style="color: #0066bb; font-weight: bold">isIncludable</span>(<span style="color: #336699; font-style: italic">latitude:</span> String, <span style="color: #336699; font-style: italic">longitude:</span> String): Boolean = {
  <span style="color: #008800; font-weight: bold">if</span>(mustBeIn) isInBoundingBoxes(latitude, longitude) <span style="color: #008800; font-weight: bold">else</span> !isInBoundingBoxes(latitude, longitude)
}

def <span style="color: #0066bb; font-weight: bold">buildTweet</span>(<span style="color: #336699; font-style: italic">values:</span> List[String]): String = {
  val tweet =
  &lt;tweet&gt;
    &lt;id&gt;{values(<span style="color: #0000DD; font-weight: bold">0</span>)}&lt;/id&gt;
    &lt;username&gt;{values(<span style="color: #0000DD; font-weight: bold">1</span>)}&lt;/username&gt;
    &lt;name&gt;{values(<span style="color: #0000DD; font-weight: bold">2</span>)}&lt;/name&gt;
    &lt;location&gt;{values(<span style="color: #0000DD; font-weight: bold">3</span>)}&lt;/location&gt;
    &lt;timezone&gt;{values(<span style="color: #0000DD; font-weight: bold">4</span>)}&lt;/timezone&gt;
    &lt;createdAt&gt;{values(<span style="color: #0000DD; font-weight: bold">5</span>)}&lt;/createdAt&gt;
    &lt;latitude&gt;{values(<span style="color: #0000DD; font-weight: bold">6</span>)}&lt;/latitude&gt;
    &lt;longitude&gt;{values(<span style="color: #0000DD; font-weight: bold">7</span>)}&lt;/longitude&gt;
    &lt;text&gt;{values(<span style="color: #0000DD; font-weight: bold">8</span>)}&lt;/text&gt;
  &lt;/tweet&gt;

  s<span style="color: #dd2200; background-color: #fff0f0">&quot;\n${tweet.toString}\n&quot;</span>
}

def <span style="color: #0066bb; font-weight: bold">serialize</span>(<span style="color: #336699; font-style: italic">tweet:</span> String) = { writer.<span style="color: #336699">write</span>(tweet) }

<span style="color: #888888">// id, username, name, location, timezone, createdAt, latitude, longitude, text</span>
def <span style="color: #0066bb; font-weight: bold">save</span>(<span style="color: #336699; font-style: italic">values:</span> List[String]) = {
  val latitude  = values(<span style="color: #0000DD; font-weight: bold">6</span>)
  val longitude = values(<span style="color: #0000DD; font-weight: bold">7</span>)
  <span style="color: #008800; font-weight: bold">if</span>(isIncludable(latitude, longitude)){
    serialize(buildTweet(values))
  }
}

def <span style="color: #0066bb; font-weight: bold">appendToLastValue</span>(<span style="color: #336699; font-style: italic">text:</span>String, <span style="color: #336699; font-style: italic">values:</span>ListBuffer[String]): Unit = {
  var last = values(values.<span style="color: #336699">size</span> - <span style="color: #0000DD; font-weight: bold">1</span>)
  values(values.<span style="color: #336699">size</span> - <span style="color: #0000DD; font-weight: bold">1</span>) = last + text;
}

def <span style="color: #0066bb; font-weight: bold">getWriter</span>(): BufferedWriter = {
  val suffix = <span style="color: #008800; font-weight: bold">if</span>(mustBeIn) <span style="color: #dd2200; background-color: #fff0f0">&quot;_in_bounding_boxes&quot;</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;_no_bounding_boxes&quot;</span>
  val out = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(tweetsFile + <span style="color: #dd2200; background-color: #fff0f0">&quot;_tweets_by_location&quot;</span> + suffix + <span style="color: #dd2200; background-color: #fff0f0">&quot;.xml&quot;</span>)
  <span style="color: #008800; font-weight: bold">if</span>(!out.<span style="color: #336699">exists</span>) out.<span style="color: #336699">createNewFile</span>

  <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(out)))
}

val tweetsFile        = args(<span style="color: #0000DD; font-weight: bold">0</span>).<span style="color: #336699">toString</span>
val boundingBoxesFile = args(<span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">toString</span>
val mustBeIn          = args(<span style="color: #0000DD; font-weight: bold">2</span>).<span style="color: #336699">toBoolean</span>

val boundingBoxes = getBoundingBoxes(XML.<span style="color: #336699">loadFile</span>(boundingBoxesFile))

val tweets = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">XMLEventReader</span>(Source.<span style="color: #336699">fromFile</span>(tweetsFile))
var values = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[String]

val <span style="color: #336699; font-style: italic">writer:</span> BufferedWriter = getWriter()

<span style="color: #008800; font-weight: bold">try</span> {
  var current = <span style="color: #dd2200; background-color: #fff0f0">&quot;&quot;</span>
  var last = <span style="color: #dd2200; background-color: #fff0f0">&quot;&quot;</span>

  writer.<span style="color: #336699">write</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;tweets&gt;&quot;</span>)
  tweets.<span style="color: #336699">foreach</span>(event =&gt; {
    event match {
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemStart <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> != <span style="color: #dd2200; background-color: #fff0f0">&quot;tweets&quot;</span> &amp;&amp; e.<span style="color: #336699">label</span> != <span style="color: #dd2200; background-color: #fff0f0">&quot;tweet&quot;</span> =&gt;
      current = e.<span style="color: #336699">label</span>
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #336699; font-style: italic">e:</span> EvElemEnd <span style="color: #008800; font-weight: bold">if</span> e.<span style="color: #336699">label</span> != <span style="color: #dd2200; background-color: #fff0f0">&quot;tweets&quot;</span> &amp;&amp; e.<span style="color: #336699">label</span> != <span style="color: #dd2200; background-color: #fff0f0">&quot;tweet&quot;</span> =&gt;
      current = <span style="color: #dd2200; background-color: #fff0f0">&quot;&quot;</span>
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;tweet&quot;</span>) =&gt;
      save(values.<span style="color: #336699">toList</span>)
      values.<span style="color: #336699">clear</span>
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvText</span>(text) <span style="color: #008800; font-weight: bold">if</span>
        <span style="color: #0066bb; font-weight: bold">Array</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;id&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;username&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;name&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;location&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;latitude&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;longitude&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;timezone&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;createdAt&quot;</span>,
              <span style="color: #dd2200; background-color: #fff0f0">&quot;text&quot;</span>
        ).<span style="color: #336699">contains</span>(current) =&gt;
      <span style="color: #008800; font-weight: bold">if</span>(current == last) appendToLastValue(text, values) <span style="color: #008800; font-weight: bold">else</span> values += text
      last = current
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvEntityRef</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;amp&quot;</span>) =&gt;
      <span style="color: #008800; font-weight: bold">if</span>(current == last) appendToLastValue(<span style="color: #dd2200; background-color: #fff0f0">&quot;&amp;&quot;</span>, values) <span style="color: #008800; font-weight: bold">else</span> values += <span style="color: #dd2200; background-color: #fff0f0">&quot;&amp;&quot;</span>
      last = current
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvEntityRef</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;lt&quot;</span>)  =&gt;
      <span style="color: #008800; font-weight: bold">if</span>(current == last) appendToLastValue(<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;&quot;</span>, values) <span style="color: #008800; font-weight: bold">else</span> values += <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;&quot;</span>
      last = current
      <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvEntityRef</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;gt&quot;</span>)  =&gt;
      <span style="color: #008800; font-weight: bold">if</span>(current == last) appendToLastValue(<span style="color: #dd2200; background-color: #fff0f0">&quot;&gt;&quot;</span>, values) <span style="color: #008800; font-weight: bold">else</span> values += <span style="color: #dd2200; background-color: #fff0f0">&quot;&gt;&quot;</span>
      last = current
      <span style="color: #008800; font-weight: bold">case</span> _ =&gt; ;
    }
  })
  writer.<span style="color: #336699">write</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/tweets&gt;&quot;</span>)
} <span style="color: #008800; font-weight: bold">finally</span> {
  writer.<span style="color: #336699">flush</span>()
  writer.<span style="color: #336699">close</span>()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">tweets_by_time.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #a61717; background-color: #e3d2d2">#</span>!/bin/sh
exec scala <span style="color: #dd2200; background-color: #fff0f0">&quot;$0&quot;</span> <span style="color: #dd2200; background-color: #fff0f0">&quot;$@&quot;</span>
!<span style="color: #a61717; background-color: #e3d2d2">#</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull.EvElemStart</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.xml.pull.EvText</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>


val fileToAnalyze = args(<span style="color: #0000DD; font-weight: bold">0</span>).<span style="color: #336699">toString</span>
var freq = collection.<span style="color: #336699">mutable</span>.<span style="color: #336699">Map</span>[String, Int]().<span style="color: #336699">withDefaultValue</span>(<span style="color: #0000DD; font-weight: bold">0</span>)
var isCreatedAtElement = <span style="color: #008800; font-weight: bold">false</span>

<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">XMLEventReader</span>(Source.<span style="color: #336699">fromFile</span>(fileToAnalyze)).<span style="color: #336699">foreach</span>(event =&gt; {
  event match {
    <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemStart</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;createdAt&quot;</span>, _, _) =&gt; isCreatedAtElement = <span style="color: #008800; font-weight: bold">true</span>
    <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvText</span>(text) <span style="color: #008800; font-weight: bold">if</span> isCreatedAtElement =&gt; {
      val hour = text.<span style="color: #336699">trim</span>.<span style="color: #336699">slice</span>(text.<span style="color: #336699">trim</span>.<span style="color: #336699">lastIndexOf</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot; &quot;</span>), text.<span style="color: #336699">trim</span>.<span style="color: #336699">length</span> - <span style="color: #0000DD; font-weight: bold">1</span>)
      freq(hour) += <span style="color: #0000DD; font-weight: bold">1</span>
    }
    <span style="color: #008800; font-weight: bold">case</span> <span style="color: #0066bb; font-weight: bold">EvElemEnd</span>(_, <span style="color: #dd2200; background-color: #fff0f0">&quot;createdAt&quot;</span>) =&gt; isCreatedAtElement = <span style="color: #008800; font-weight: bold">false</span>
    <span style="color: #008800; font-weight: bold">case</span> _ =&gt; ;
  }
})

val sorted = freq.<span style="color: #336699">toList</span>.<span style="color: #336699">sortBy</span>({ _.<span style="color: #336699">_1</span>})

val file = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;${fileToAnalyze}_tweetsByTime.tsv&quot;</span>)
<span style="color: #008800; font-weight: bold">if</span>(!file.<span style="color: #336699">exists</span>) file.<span style="color: #336699">createNewFile</span>

val writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(file)))
<span style="color: #008800; font-weight: bold">try</span>{
  sorted.<span style="color: #336699">foreach</span>(t =&gt; writer.<span style="color: #336699">write</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;${t._2}\t${t._1}0\n&quot;</span>))
}<span style="color: #008800; font-weight: bold">finally</span>{
  writer.<span style="color: #336699">flush</span>()
  writer.<span style="color: #336699">close</span>()
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_vowpal_wabbit_input_translator">Vowpal Wabbit Input Translator</h3>
<div class="listingblock">
<div class="title">Configuration.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io.File</span>

<span style="color: #008800; font-weight: bold">case</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">Configuration</span>(<span style="color: #336699; font-style: italic">inout:</span>Boolean = <span style="color: #008800; font-weight: bold">false</span>, <span style="color: #336699; font-style: italic">decimals:</span>Int = -<span style="color: #0000DD; font-weight: bold">1</span>, <span style="color: #336699; font-style: italic">file:</span>File = <span style="color: #008800; font-weight: bold">null</span>) {}

object CLIParser {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val parser = <span style="color: #008800; font-weight: bold">new</span> scopt.<span style="color: #336699">OptionParser</span>[Configuration](<span style="color: #dd2200; background-color: #fff0f0">&quot;vw-input-translator&quot;</span>) {
    head(<span style="color: #dd2200; background-color: #fff0f0">&quot;vw-input-translator&quot;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;1.0&quot;</span>)
    opt[Unit](<span style="color: #dd2200; background-color: #fff0f0">&quot;inout&quot;</span>) action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(inout = <span style="color: #008800; font-weight: bold">true</span>) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Flag for creating an input file for binary classification&quot;</span>)
    opt[Int](<span style="color: #dd2200; background-color: #fff0f0">&#39;d&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&quot;decimals&quot;</span>) action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(decimals = x) } validate { x =&gt;
      <span style="color: #008800; font-weight: bold">if</span> (x &gt; <span style="color: #0000DD; font-weight: bold">0</span>) success <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">failure</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Option --decimals must be &gt; 0&quot;</span>) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Creates an input file for multi-class classification.&quot;</span> +
        <span style="color: #dd2200; background-color: #fff0f0">&quot; Each sample will have the selected number of decimals on latitude and longitude coordinates&quot;</span>)
    arg[File](<span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;file&gt;&quot;</span>) unbounded() action { (x, c) =&gt; c.<span style="color: #336699">copy</span>(file = x) } text(<span style="color: #dd2200; background-color: #fff0f0">&quot;Source file&quot;</span>)
    checkConfig { c =&gt; <span style="color: #008800; font-weight: bold">if</span> (c.<span style="color: #336699">inout</span> &amp;&amp; c.<span style="color: #336699">decimals</span> &gt; -<span style="color: #0000DD; font-weight: bold">1</span>) failure(<span style="color: #dd2200; background-color: #fff0f0">&quot;You cannot use --inout and --decimals at the same time&quot;</span>) <span style="color: #008800; font-weight: bold">else</span> success }
    checkConfig { c =&gt; <span style="color: #008800; font-weight: bold">if</span> (!c.<span style="color: #336699">inout</span> &amp;&amp; c.<span style="color: #336699">decimals</span> == -<span style="color: #0000DD; font-weight: bold">1</span>) failure(<span style="color: #dd2200; background-color: #fff0f0">&quot;You have to provide the --inout OR --decimals parameter&quot;</span>) <span style="color: #008800; font-weight: bold">else</span> success }
  }

  def <span style="color: #0066bb; font-weight: bold">parse</span>(<span style="color: #336699; font-style: italic">args:</span>Array[String], <span style="color: #336699; font-style: italic">conf:</span>Configuration):Option[Configuration] = <span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">parser</span>.<span style="color: #336699">parse</span>(args, conf)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Main.scala</div>
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.io._</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.io.Source</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">scala.collection.mutable.ListBuffer</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #bb0066; font-weight: bold">java.security.MessageDigest</span>

object Main {
  def <span style="color: #0066bb; font-weight: bold">main</span>(<span style="color: #336699; font-style: italic">args:</span> Array[String]): Unit = {
    CLIParser.<span style="color: #336699">parse</span>(args, Configuration()) map { config =&gt;
      val translator = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">VWTranslator</span>(config)
      Source.<span style="color: #336699">fromFile</span>(config.<span style="color: #336699">file</span>).<span style="color: #336699">getLines</span>.<span style="color: #336699">foreach</span>(line =&gt; translator.<span style="color: #336699">translate</span>(line))
      translator.<span style="color: #336699">saveDictionary</span>

      <span style="color: #0066bb; font-weight: bold">println</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;Number of classes extracted: &quot;</span> + translator.<span style="color: #336699">numberOfClasses</span>)
    }
  }
}

object Writer {
  def <span style="color: #0066bb; font-weight: bold">write</span>(<span style="color: #336699; font-style: italic">line:</span> String, <span style="color: #336699; font-style: italic">file:</span> String):Unit = {
    val out = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">File</span>(file)
    <span style="color: #008800; font-weight: bold">if</span>(!out.<span style="color: #336699">exists</span>) out.<span style="color: #336699">createNewFile</span>

    val writer = <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">BufferedWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">OutputStreamWriter</span>(<span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066bb; font-weight: bold">FileOutputStream</span>(out, <span style="color: #008800; font-weight: bold">true</span>)))
    <span style="color: #008800; font-weight: bold">try</span> {
      writer.<span style="color: #336699">write</span>(line)
    } <span style="color: #008800; font-weight: bold">finally</span> {
      writer.<span style="color: #336699">flush</span>()
      writer.<span style="color: #336699">close</span>()
    }
  }
}

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #0066bb; font-weight: bold">VWTranslator</span>(<span style="color: #336699; font-style: italic">config:</span> Configuration) {
  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] val dictionary = <span style="color: #008800; font-weight: bold">new</span> ListBuffer[(String, Int)]()

  def <span style="color: #0066bb; font-weight: bold">translate</span>(<span style="color: #336699; font-style: italic">raw:</span> String): Unit = {
    val columns       = raw.<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;\t&quot;</span>)
    val classLabel    = getClass(columns)
    val formattedLine = s<span style="color: #dd2200; background-color: #fff0f0">&quot;$classLabel |Tweet ${columns(3)}\n&quot;</span>

    Writer.<span style="color: #336699">write</span>(formattedLine, outputFileName)
  }

  def <span style="color: #336699; font-style: italic">numberOfClasses:</span> Int = dictionary.<span style="color: #336699">size</span>

  def <span style="color: #336699; font-style: italic">saveDictionary:</span> Unit = {
    val fileName = s<span style="color: #dd2200; background-color: #fff0f0">&quot;${outputFileName}_dictionary&quot;</span>
    dictionary.<span style="color: #336699">foreach</span> { <span style="color: #008800; font-weight: bold">case</span> (k, c) =&gt; Writer.<span style="color: #336699">write</span>(s<span style="color: #dd2200; background-color: #fff0f0">&quot;$c\t$k\n&quot;</span>, fileName) }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #336699; font-style: italic">outputFileName:</span> String = {
    var file = config.<span style="color: #336699">file</span>
    <span style="color: #0066bb; font-weight: bold">if</span>(<span style="color: #008800; font-weight: bold">this</span>.<span style="color: #336699">config</span>.<span style="color: #336699">inout</span>) s<span style="color: #dd2200; background-color: #fff0f0">&quot;${file}_vw_inout&quot;</span> <span style="color: #008800; font-weight: bold">else</span> s<span style="color: #dd2200; background-color: #fff0f0">&quot;${file}_vw_${config.decimals}_decimals&quot;</span>
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">getClass</span>(<span style="color: #336699; font-style: italic">columns:</span> Array[String]): Int =
    <span style="color: #008800; font-weight: bold">if</span>(config.<span style="color: #336699">inout</span>) getBinaryClass(columns(<span style="color: #0000DD; font-weight: bold">0</span>).<span style="color: #336699">toDouble</span>) <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066bb; font-weight: bold">getMultiClassLabel</span>(columns(<span style="color: #0000DD; font-weight: bold">1</span>), columns(<span style="color: #0000DD; font-weight: bold">2</span>))

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">getBinaryClass</span>(<span style="color: #336699; font-style: italic">score:</span> Double): Int = <span style="color: #008800; font-weight: bold">if</span>(score &lt; <span style="color: #0000DD; font-weight: bold">0.0</span>) <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0000DD; font-weight: bold">1</span>

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">getMultiClassLabel</span>(<span style="color: #336699; font-style: italic">lat:</span>String, <span style="color: #336699; font-style: italic">lng:</span>String): Int = {
    val trunkedLat = trunkCoordinate(lat)
    val trunkedLng = trunkCoordinate(lng)

    val key = trunkedLat + <span style="color: #dd2200; background-color: #fff0f0">&quot;,&quot;</span> + trunkedLng

    <span style="color: #0066bb; font-weight: bold">if</span>(dictionary.<span style="color: #336699">isEmpty</span>) {
      dictionary += key -&gt; <span style="color: #0000DD; font-weight: bold">1</span>
      <span style="color: #0000DD; font-weight: bold">1</span>
    } <span style="color: #008800; font-weight: bold">else</span>{
      val storedClassLabel = getClassLabelInDictionary(key)
      <span style="color: #008800; font-weight: bold">if</span>(storedClassLabel.<span style="color: #336699">isEmpty</span>) {
        val last = dictionary.<span style="color: #336699">last</span>.<span style="color: #336699">_2</span>
        dictionary += key -&gt; (last + <span style="color: #0000DD; font-weight: bold">1</span>)
        last + <span style="color: #0000DD; font-weight: bold">1</span>
      }<span style="color: #008800; font-weight: bold">else</span> {
        storedClassLabel.<span style="color: #336699">get</span>.<span style="color: #336699">_2</span>
      }
    }
  }

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">getClassLabelInDictionary</span>(<span style="color: #336699; font-style: italic">key:</span> String): Option[(String, Int)] = dictionary.<span style="color: #336699">find</span>(t =&gt; t.<span style="color: #336699">_1</span> == key)

  <span style="color: #008800; font-weight: bold">private</span>[<span style="color: #008800; font-weight: bold">this</span>] def <span style="color: #0066bb; font-weight: bold">trunkCoordinate</span>(<span style="color: #336699; font-style: italic">coordinate:</span> String): String = {
    val parts = coordinate.<span style="color: #336699">split</span>(<span style="color: #dd2200; background-color: #fff0f0">&quot;\\.&quot;</span>)
    parts(<span style="color: #0000DD; font-weight: bold">0</span>) + <span style="color: #dd2200; background-color: #fff0f0">&quot;.&quot;</span> + parts(<span style="color: #0000DD; font-weight: bold">1</span>).<span style="color: #336699">slice</span>(<span style="color: #0000DD; font-weight: bold">0</span>, config.<span style="color: #336699">decimals</span>)
  }
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_b2pick">B2pick</h3>
<div class="listingblock">
<div class="title">map.html</div>
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span style="color: #cc0000; font-weight: bold">&lt;!DOCTYPE html&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;html&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;head&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;meta</span> <span style="color: #336699">charset=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;UTF-8&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;meta</span> <span style="color: #336699">name=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;description&quot;</span> <span style="color: #336699">content=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;Bounding boxes picker&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;meta</span> <span style="color: #336699">name=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;keywords&quot;</span> <span style="color: #336699">content=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;bounding, boxes, twitter, locations, georeference, coordinates, maps&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;meta</span> <span style="color: #336699">name=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;author&quot;</span> <span style="color: #336699">content=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;Sergio Álvarez Suárez&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>

  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;icon&quot;</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;../favicon.png&quot;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;image/png&quot;</span> <span style="color: #bb0066; font-weight: bold">/&gt;</span>

  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;stylesheet&quot;</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./fancybox/source/jquery.fancybox.css&quot;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/css&quot;</span> <span style="color: #336699">media=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;screen&quot;</span> <span style="color: #bb0066; font-weight: bold">/&gt;</span>

  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;http://fonts.googleapis.com/css?family=Neucha&#39;</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;stylesheet&#39;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;text/css&#39;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;http://fonts.googleapis.com/css?family=Signika+Negative:300,400&#39;</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;stylesheet&#39;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;text/css&#39;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;http://fonts.googleapis.com/css?family=Ubuntu+Mono&#39;</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;stylesheet&#39;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&#39;text/css&#39;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>

  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;stylesheet&quot;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/css&quot;</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;style.css&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>

  <span style="color: #bb0066; font-weight: bold">&lt;title&gt;</span> b2pick: picking bounding-boxes<span style="color: #bb0066; font-weight: bold">&lt;/title&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/head&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;body&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;header&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;h1&gt;</span>b2pick<span style="color: #bb0066; font-weight: bold">&lt;/h1&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;h2&gt;</span>Bounding Boxes picker<span style="color: #bb0066; font-weight: bold">&lt;/h2&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/header&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;section</span> <span style="color: #336699">id=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;main_content&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;section</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;column&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;section&gt;</span>
        <span style="color: #bb0066; font-weight: bold">&lt;p&gt;</span>b2pick allows to picking up bounding boxes directly from Google Maps.<span style="color: #bb0066; font-weight: bold">&lt;/p&gt;</span>
        <span style="color: #bb0066; font-weight: bold">&lt;p&gt;</span>You can draw rectangles around the desired locations. Coordinates from the bounding boxes will be shown down taking the following form:<span style="color: #bb0066; font-weight: bold">&lt;/p&gt;</span>
        <span style="color: #bb0066; font-weight: bold">&lt;p&gt;&lt;span</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;code&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>SW_long, SW_lat, NE_long, NE_lat<span style="color: #bb0066; font-weight: bold">&lt;/span&gt;&lt;/p&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;button</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;button&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>Print in XML<span style="color: #bb0066; font-weight: bold">&lt;/button&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;section</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;boxes&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;section</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;column&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;div</span> <span style="color: #336699">id=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;map_canvas&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/div&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;div</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;clear_both&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/div&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;a</span> <span style="color: #336699">id=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;inline&quot;</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;#xml&quot;</span> <span style="color: #336699">style=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;display:none&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/a&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;div</span> <span style="color: #336699">style=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;display:none&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;div</span> <span style="color: #336699">id=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;xml&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/div&gt;&lt;/div&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;footer&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;p&gt;</span>Developed by <span style="color: #bb0066; font-weight: bold">&lt;a</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;http://www.sergioalvarezsuarez.com&quot;</span> <span style="color: #336699">target=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;blank&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>Sergio Álvarez<span style="color: #bb0066; font-weight: bold">&lt;/a&gt;&lt;/p&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/footer&gt;</span>

  <span style="color: #888888">&lt;!-- loading scripts --&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./fancybox/source/jquery.fancybox.pack.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false&amp;libraries=drawing&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;index.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/body&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">style.css</div>
<div class="content">
<pre class="pygments highlight"><code class="css language-css">* {
  <span style="color: #008800; font-weight: bold">margin</span>: <span style="color: #0000DD; font-weight: bold">0</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">0</span>;
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">10px</span>;

  <span style="color: #008800; font-weight: bold">font-family</span>: <span style="color: #dd2200; background-color: #fff0f0">&#39;Signika Negative&#39;</span>, <span style="color: #008800; font-weight: bold">sans-serif</span>;
}

<span style="color: #bb0066; font-weight: bold">body</span>{
  <span style="color: #008800; font-weight: bold">background-color</span>: rgba(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, .<span style="color: #0000DD; font-weight: bold">7</span>);
}

<span style="color: #bb0066; font-weight: bold">header</span>{
  <span style="color: #008800; font-weight: bold">width</span>: <span style="color: #0000DD; font-weight: bold">100%</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">1em</span> <span style="color: #0000DD; font-weight: bold">0</span>;

  <span style="color: #008800; font-weight: bold">background-color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">0</span>);
  <span style="color: #008800; font-weight: bold">color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>);
}

<span style="color: #bb0066; font-weight: bold">header</span> <span style="color: #bb0066; font-weight: bold">h1</span> { <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">3em</span>;  <span style="color: #008800; font-weight: bold">margin-left</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;  <span style="color: #008800; font-weight: bold">font-family</span>: <span style="color: #dd2200; background-color: #fff0f0">&#39;Neucha&#39;</span>, <span style="color: #008800; font-weight: bold">cursive</span>;}
<span style="color: #bb0066; font-weight: bold">header</span> <span style="color: #bb0066; font-weight: bold">h2</span> { <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.5em</span>;  <span style="color: #008800; font-weight: bold">margin-left</span>: <span style="color: #0000DD; font-weight: bold">30px</span>;  <span style="color: #008800; font-weight: bold">font-family</span>: <span style="color: #dd2200; background-color: #fff0f0">&#39;Neucha&#39;</span>, <span style="color: #008800; font-weight: bold">cursive</span>;}

<span style="color: #0066bb; font-weight: bold">#main_content</span> {
  <span style="color: #008800; font-weight: bold">overflow</span>: <span style="color: #008800; font-weight: bold">hidden</span>;
  <span style="color: #008800; font-weight: bold">width</span>: <span style="color: #0000DD; font-weight: bold">100%</span>;
}

<span style="color: #bb0066; font-weight: bold">section.column</span>{
  <span style="color: #008800; font-weight: bold">float</span>: <span style="color: #008800; font-weight: bold">left</span>;
  <span style="color: #008800; font-weight: bold">padding-bottom</span>: <span style="color: #0000DD; font-weight: bold">9999px</span>;
  <span style="color: #008800; font-weight: bold">margin-bottom</span>: <span style="color: #0000DD; font-weight: bold">-9999px</span>;
}

<span style="color: #0066bb; font-weight: bold">#main_content</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span>  { <span style="color: #008800; font-weight: bold">width</span>: <span style="color: #0000DD; font-weight: bold">40em</span>; }
<span style="color: #0066bb; font-weight: bold">#main_content</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:last-of-type</span> { <span style="color: #008800; font-weight: bold">width</span>: calc(<span style="color: #0000DD; font-weight: bold">100%</span> - <span style="color: #0000DD; font-weight: bold">40em</span>); }

<span style="color: #0066bb; font-weight: bold">#main_content</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span> {
  <span style="color: #008800; font-weight: bold">overflow-y</span>: <span style="color: #008800; font-weight: bold">scroll</span>;
  <span style="color: #008800; font-weight: bold">height</span>: <span style="color: #0000DD; font-weight: bold">600px</span>;
  <span style="color: #008800; font-weight: bold">background-color</span>: rgba(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, .<span style="color: #0000DD; font-weight: bold">7</span>);
}

<span style="color: #0066bb; font-weight: bold">#main_content</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span> {
  <span style="color: #008800; font-weight: bold">margin</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
  <span style="color: #008800; font-weight: bold">background-color</span>: rgba(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, .<span style="color: #0000DD; font-weight: bold">4</span>);

  <span style="color: #008800; font-weight: bold">font-weight</span>: <span style="color: #008800; font-weight: bold">lighter</span>;
}

<span style="color: #0066bb; font-weight: bold">#main_content</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span> &gt; <span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span> <span style="color: #bb0066; font-weight: bold">p</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.4em</span>;
}

<span style="color: #bb0066; font-weight: bold">span.code</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
  <span style="color: #008800; font-weight: bold">font-family</span>: <span style="color: #dd2200; background-color: #fff0f0">&#39;Ubuntu Mono&#39;</span>, <span style="color: #008800; font-weight: bold">sans-serif</span>;
}

<span style="color: #bb0066; font-weight: bold">div.box</span> {
  <span style="color: #008800; font-weight: bold">margin</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
  <span style="color: #008800; font-weight: bold">background-color</span>: rgba(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, .<span style="color: #0000DD; font-weight: bold">4</span>);

  <span style="color: #008800; font-weight: bold">font-weight</span>: <span style="color: #008800; font-weight: bold">lighter</span>;
}

<span style="color: #bb0066; font-weight: bold">div.box</span> <span style="color: #bb0066; font-weight: bold">h3</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.6em</span>;
}

<span style="color: #bb0066; font-weight: bold">div.box</span> <span style="color: #bb0066; font-weight: bold">p</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.4em</span>;
}

<span style="color: #0066bb; font-weight: bold">#map_canvas</span> {
  <span style="color: #008800; font-weight: bold">width</span>: <span style="color: #0000DD; font-weight: bold">100%</span>;
  <span style="color: #008800; font-weight: bold">height</span>: <span style="color: #0000DD; font-weight: bold">600px</span>;
}

<span style="color: #bb0066; font-weight: bold">.clear_both</span> {
  <span style="color: #008800; font-weight: bold">clear</span>: <span style="color: #008800; font-weight: bold">both</span>;
}

<span style="color: #bb0066; font-weight: bold">button</span> {
  <span style="color: #008800; font-weight: bold">background-image</span>: -webkit-linear-gradient(<span style="color: #0000DD; font-weight: bold">#88af39</span>, <span style="color: #0000DD; font-weight: bold">#690</span>);
  <span style="color: #008800; font-weight: bold">border</span>-radius: <span style="color: #0000DD; font-weight: bold">4px</span>;
  <span style="color: #008800; font-weight: bold">border</span>: <span style="color: #0000DD; font-weight: bold">1px</span> <span style="color: #008800; font-weight: bold">solid</span> <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">45</span>, <span style="color: #0000DD; font-weight: bold">128</span>, <span style="color: #0000DD; font-weight: bold">19</span>);
  <span style="color: #008800; font-weight: bold">color</span>: <span style="color: #0000DD; font-weight: bold">#FFF</span>;
  <span style="color: #008800; font-weight: bold">cursor</span>: <span style="color: #008800; font-weight: bold">pointer</span>;
  <span style="color: #008800; font-weight: bold">display</span>: <span style="color: #008800; font-weight: bold">block</span>;
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.3em</span>;
  <span style="color: #008800; font-weight: bold">margin</span>: <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #008800; font-weight: bold">auto</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">10px</span>;
  <span style="color: #008800; font-weight: bold">width</span>: <span style="color: #0000DD; font-weight: bold">100px</span>;
}

<span style="color: #0066bb; font-weight: bold">#xml</span> <span style="color: #bb0066; font-weight: bold">pre</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.5em</span>;
}

<span style="color: #888888">/* FOOTER</span>
<span style="color: #888888">******************************************* */</span>

<span style="color: #bb0066; font-weight: bold">footer</span> {
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">5em</span>;

  <span style="color: #008800; font-weight: bold">color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>);
  <span style="color: #008800; font-weight: bold">text-align</span>: <span style="color: #008800; font-weight: bold">center</span>;
  <span style="color: #008800; font-weight: bold">font-weight</span>: <span style="color: #008800; font-weight: bold">lighter</span>;
}

<span style="color: #bb0066; font-weight: bold">footer</span> <span style="color: #bb0066; font-weight: bold">p</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1.5em</span>;
}

<span style="color: #bb0066; font-weight: bold">footer</span> <span style="color: #bb0066; font-weight: bold">p</span> <span style="color: #bb0066; font-weight: bold">a</span> {
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">1em</span>;
}

<span style="color: #bb0066; font-weight: bold">footer</span> <span style="color: #bb0066; font-weight: bold">p</span> <span style="color: #bb0066; font-weight: bold">a</span><span style="color: #555555">:link</span>, <span style="color: #bb0066; font-weight: bold">footer</span> <span style="color: #bb0066; font-weight: bold">p</span> <span style="color: #bb0066; font-weight: bold">a</span><span style="color: #555555">:visited</span> {
  <span style="color: #008800; font-weight: bold">color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>, <span style="color: #0000DD; font-weight: bold">255</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">index.js</div>
<div class="content">
<pre class="pygments highlight"><code class="javascript language-javascript">$(<span style="color: #003388">document</span>).ready(<span style="color: #008800; font-weight: bold">function</span>(){
  salvarezsuar.MapModule.install();

  $(<span style="color: #dd2200; background-color: #fff0f0">&#39;button&#39;</span>).click(<span style="color: #008800; font-weight: bold">function</span>() {
    <span style="color: #008800; font-weight: bold">var</span> xml = salvarezsuar.BoundingBoxesManager.toXML();
    $xml = $(<span style="color: #dd2200; background-color: #fff0f0">&#39;#xml&#39;</span>);
    $xml.empty();

    $output = $(<span style="color: #dd2200; background-color: #fff0f0">&#39;&lt;pre&gt;&lt;/pre&gt;&#39;</span>).text(xml);
    $xml.append($output);

    $(<span style="color: #dd2200; background-color: #fff0f0">&#39;a#inline&#39;</span>).click();
  });

  $(<span style="color: #dd2200; background-color: #fff0f0">&#39;a#inline&#39;</span>).fancybox({
    <span style="color: #dd2200; background-color: #fff0f0">&#39;width&#39;</span>: <span style="color: #0000DD; font-weight: bold">500</span>,
    <span style="color: #dd2200; background-color: #fff0f0">&#39;autoDimensions&#39;</span>: <span style="color: #008800; font-weight: bold">false</span>,
    <span style="color: #dd2200; background-color: #fff0f0">&#39;autoSize&#39;</span>: <span style="color: #008800; font-weight: bold">false</span>
  });
});

<span style="color: #008800; font-weight: bold">var</span> salvarezsuar = salvarezsuar || {};
salvarezsuar.BoundingBoxesManager = (<span style="color: #008800; font-weight: bold">function</span>() {
  <span style="color: #008800; font-weight: bold">var</span> boundingBoxes = [];

  <span style="color: #008800; font-weight: bold">var</span> add = <span style="color: #008800; font-weight: bold">function</span>(boundingBox) {
    boundingBoxes.push(boundingBox);
  };

  <span style="color: #008800; font-weight: bold">var</span> clear = <span style="color: #008800; font-weight: bold">function</span>() {
    boundingBoxes.length = <span style="color: #0000DD; font-weight: bold">0</span>;
  };

  <span style="color: #008800; font-weight: bold">var</span> toXML = <span style="color: #008800; font-weight: bold">function</span>() {
    <span style="color: #008800; font-weight: bold">var</span> boundingBoxes2xml = boundingBoxes.map(<span style="color: #008800; font-weight: bold">function</span>(boundingBox){
      <span style="color: #008800; font-weight: bold">var</span> xml = <span style="color: #dd2200; background-color: #fff0f0">&quot;&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\n\t&lt;boundingBox&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t&lt;sw&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t\t&lt;latitude&gt;&quot;</span> + boundingBox.sw.latitude + <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/latitude&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t\t&lt;longitude&gt;&quot;</span> + boundingBox.sw.longitude + <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/longitude&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t&lt;/sw&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t&lt;ne&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t\t&lt;latitude&gt;&quot;</span> + boundingBox.ne.latitude + <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/latitude&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t\t&lt;longitude&gt;&quot;</span> + boundingBox.ne.longitude + <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;/longitude&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t\t&lt;/ne&gt;\n&quot;</span>;
      xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\t&lt;/boundingBox&gt;&quot;</span>;

      <span style="color: #008800; font-weight: bold">return</span> xml;
    });

    <span style="color: #008800; font-weight: bold">var</span> xml = <span style="color: #dd2200; background-color: #fff0f0">&quot;&lt;boundingBoxes&gt;&quot;</span>;
    xml += boundingBoxes2xml.join(<span style="color: #dd2200; background-color: #fff0f0">&quot;&quot;</span>);
    xml += <span style="color: #dd2200; background-color: #fff0f0">&quot;\n&lt;/boundingBoxes&gt;&quot;</span>;

    <span style="color: #008800; font-weight: bold">return</span> xml;
  };

  <span style="color: #008800; font-weight: bold">return</span> {
    add: add,
    toXML: toXML,
    clear: clear
  };
})();

salvarezsuar.MapModule = (<span style="color: #008800; font-weight: bold">function</span>(){
  <span style="color: #008800; font-weight: bold">var</span> rectangles = [];
  <span style="color: #008800; font-weight: bold">var</span> currentRectangle = <span style="color: #008800; font-weight: bold">null</span>;
  <span style="color: #008800; font-weight: bold">var</span> isMovingRectangle = <span style="color: #008800; font-weight: bold">false</span>;

  <span style="color: #008800; font-weight: bold">var</span> createMap = <span style="color: #008800; font-weight: bold">function</span>(){
    <span style="color: #008800; font-weight: bold">var</span> centerPoint = <span style="color: #008800; font-weight: bold">new</span> google.maps.LatLng(<span style="color: #0000DD; font-weight: bold">43.354810</span>, -<span style="color: #0000DD; font-weight: bold">5.851805</span>); <span style="color: #888888">// Oviedo, Asturias, Spain.</span>
    <span style="color: #008800; font-weight: bold">var</span> options = {
      zoom : <span style="color: #0000DD; font-weight: bold">3</span>,
      heading : <span style="color: #0000DD; font-weight: bold">90</span>,
      tilt : <span style="color: #0000DD; font-weight: bold">45</span>,
      center : centerPoint,
      mapTypeControl : <span style="color: #008800; font-weight: bold">false</span>
    };

    <span style="color: #888888">// Initialize variables</span>
    <span style="color: #008800; font-weight: bold">var</span> map = <span style="color: #008800; font-weight: bold">new</span> google.maps.Map($(<span style="color: #dd2200; background-color: #fff0f0">&#39;#map_canvas&#39;</span>)[<span style="color: #0000DD; font-weight: bold">0</span>], options);
    <span style="color: #008800; font-weight: bold">var</span> drawingManager = <span style="color: #008800; font-weight: bold">new</span> google.maps.drawing.DrawingManager({
      drawingControl: <span style="color: #008800; font-weight: bold">true</span>,
      drawingControlOptions: {
        position: google.maps.ControlPosition.TOP_CENTER,
        drawingModes: [google.maps.drawing.OverlayType.RECTANGLE]
      },
      rectangleOptions : {
        draggable: <span style="color: #008800; font-weight: bold">true</span>,
        clickable: <span style="color: #008800; font-weight: bold">true</span>,
        editable: <span style="color: #008800; font-weight: bold">true</span>
      }
    });
    drawingManager.setMap(map);

    google.maps.event.addListener(
      drawingManager, <span style="color: #dd2200; background-color: #fff0f0">&#39;rectanglecomplete&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(rectangle){
        appendBoundingBoxInfo(rectangle);
        rectangles.push(rectangle);
        google.maps.event.addListener(
          rectangle, <span style="color: #dd2200; background-color: #fff0f0">&#39;bounds_changed&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(){
            $(<span style="color: #dd2200; background-color: #fff0f0">&#39;section.boxes&#39;</span>).empty();
            salvarezsuar.BoundingBoxesManager.clear();

            $(rectangles).each(<span style="color: #008800; font-weight: bold">function</span>(index, rectangle){
              appendBoundingBoxInfo(rectangle);
            });
          }
        );
      }
    );
  };

  <span style="color: #008800; font-weight: bold">var</span> appendBoundingBoxInfo = <span style="color: #008800; font-weight: bold">function</span> (rectangle){
    <span style="color: #888888">//Obtainig bouding boxes</span>
    <span style="color: #008800; font-weight: bold">var</span> swLong = rectangle.getBounds().getSouthWest().lng().toFixed(<span style="color: #0000DD; font-weight: bold">2</span>);
    <span style="color: #008800; font-weight: bold">var</span> swLat  = rectangle.getBounds().getSouthWest().lat().toFixed(<span style="color: #0000DD; font-weight: bold">2</span>);
    <span style="color: #008800; font-weight: bold">var</span> neLong = rectangle.getBounds().getNorthEast().lng().toFixed(<span style="color: #0000DD; font-weight: bold">2</span>);
    <span style="color: #008800; font-weight: bold">var</span> neLat  = rectangle.getBounds().getNorthEast().lat().toFixed(<span style="color: #0000DD; font-weight: bold">2</span>);

    salvarezsuar.BoundingBoxesManager.add({
      sw: {
        latitude: swLat,
        longitude: swLong
      },
      ne: {
        latitude: neLat,
        longitude: neLong
      }
    });

    <span style="color: #888888">//Creating element for the info panel</span>
    <span style="color: #008800; font-weight: bold">var</span> newBox = $(<span style="color: #003388">document</span>.createElement(<span style="color: #dd2200; background-color: #fff0f0">&#39;div&#39;</span>));
    $(newBox).addClass(<span style="color: #dd2200; background-color: #fff0f0">&#39;box&#39;</span>);
    $(newBox).append(<span style="color: #dd2200; background-color: #fff0f0">&#39;&lt;h3&gt;Bounding Box&lt;/h3&gt;&#39;</span>);
    $(newBox).append(<span style="color: #dd2200; background-color: #fff0f0">&#39;&lt;p&gt;Coordinates:&lt;/p&gt;&#39;</span>);
    $(newBox).append(<span style="color: #dd2200; background-color: #fff0f0">&#39;&lt;p&gt;&#39;</span> + swLong + <span style="color: #dd2200; background-color: #fff0f0">&#39;, &#39;</span> + swLat + <span style="color: #dd2200; background-color: #fff0f0">&#39;, &#39;</span> + neLong + <span style="color: #dd2200; background-color: #fff0f0">&#39;, &#39;</span> + neLat + <span style="color: #dd2200; background-color: #fff0f0">&#39;&lt;/p&gt;&#39;</span>);
    $(<span style="color: #dd2200; background-color: #fff0f0">&#39;section.boxes&#39;</span>).append(newBox);
  };

  <span style="color: #008800; font-weight: bold">return</span> {
    install: createMap
  };
})();</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_tweetheat">Tweetheat</h3>
<div class="listingblock">
<div class="title">index.html</div>
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span style="color: #cc0000; font-weight: bold">&lt;!DOCTYPE html&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;html&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;head&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;link</span> <span style="color: #336699">href=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./stylesheet/main.css&quot;</span> <span style="color: #336699">rel=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;stylesheet&quot;</span> <span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/css&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false&amp;libraries=visualization&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./javascript/lib/jquery.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./javascript/map.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;script </span><span style="color: #336699">type=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;text/javascript&quot;</span> <span style="color: #336699">src=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;./javascript/index.js&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/script&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/head&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;body&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;section&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;div</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;drop_zone&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;</span>
      <span style="color: #bb0066; font-weight: bold">&lt;p&gt;</span>Drop here your TSV file!<span style="color: #bb0066; font-weight: bold">&lt;/p&gt;</span>
    <span style="color: #bb0066; font-weight: bold">&lt;/div&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;/section&gt;</span>
  <span style="color: #bb0066; font-weight: bold">&lt;div</span> <span style="color: #336699">class=</span><span style="color: #dd2200; background-color: #fff0f0">&quot;map&quot;</span><span style="color: #bb0066; font-weight: bold">&gt;&lt;/div&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/body&gt;</span>
<span style="color: #bb0066; font-weight: bold">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.css</div>
<div class="content">
<pre class="pygments highlight"><code class="css language-css">* {
  <span style="color: #008800; font-weight: bold">margin</span>: <span style="color: #0000DD; font-weight: bold">0</span>;
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">0</span>;
}

<span style="color: #bb0066; font-weight: bold">html</span>, <span style="color: #bb0066; font-weight: bold">body</span> { <span style="color: #008800; font-weight: bold">height</span>: <span style="color: #0000DD; font-weight: bold">100%</span>; }

<span style="color: #bb0066; font-weight: bold">section</span><span style="color: #555555">:first-child</span>{
  <span style="color: #008800; font-weight: bold">background-color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">0</span>, <span style="color: #0000DD; font-weight: bold">154</span>, <span style="color: #0000DD; font-weight: bold">206</span>);
  <span style="color: #008800; font-weight: bold">padding</span>: <span style="color: #0000DD; font-weight: bold">10px</span>;
  <span style="color: #008800; font-weight: bold">height</span>: <span style="color: #0000DD; font-weight: bold">130px</span>;
}

<span style="color: #bb0066; font-weight: bold">.drop_zone</span> {
  <span style="color: #008800; font-weight: bold">height</span>: calc(<span style="color: #0000DD; font-weight: bold">100%</span> - <span style="color: #0000DD; font-weight: bold">20px</span>);
  <span style="color: #008800; font-weight: bold">border</span>: <span style="color: #0000DD; font-weight: bold">10px</span> <span style="color: #008800; font-weight: bold">dashed</span> <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">159</span>, <span style="color: #0000DD; font-weight: bold">221</span>, <span style="color: #0000DD; font-weight: bold">237</span>);
  <span style="color: #008800; font-weight: bold">text-align</span>: <span style="color: #008800; font-weight: bold">center</span>;
  <span style="color: #008800; font-weight: bold">line-height</span>: <span style="color: #0000DD; font-weight: bold">110px</span>;
}

<span style="color: #bb0066; font-weight: bold">.drop_zone</span> {
  <span style="color: #008800; font-weight: bold">color</span>: <span style="color: #008800; font-weight: bold">rgb</span>(<span style="color: #0000DD; font-weight: bold">159</span>, <span style="color: #0000DD; font-weight: bold">221</span>, <span style="color: #0000DD; font-weight: bold">237</span>);
  <span style="color: #008800; font-weight: bold">font-size</span>: <span style="color: #0000DD; font-weight: bold">32px</span>;
  <span style="color: #008800; font-weight: bold">font-weight</span>: <span style="color: #008800; font-weight: bold">bold</span>;
  <span style="color: #008800; font-weight: bold">font-family</span>: <span style="color: #008800; font-weight: bold">sans-serif</span>;
}

<span style="color: #bb0066; font-weight: bold">.hover</span> {
  <span style="color: #008800; font-weight: bold">opacity</span>: <span style="color: #0000DD; font-weight: bold">0</span>.<span style="color: #0000DD; font-weight: bold">6</span>;
  transition: <span style="color: #008800; font-weight: bold">opacity</span> <span style="color: #0000DD; font-weight: bold">0.2s</span> linear;
}

<span style="color: #bb0066; font-weight: bold">.map</span> {
  <span style="color: #008800; font-weight: bold">height</span>: calc(<span style="color: #0000DD; font-weight: bold">100%</span> - <span style="color: #0000DD; font-weight: bold">150px</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">index.js</div>
<div class="content">
<pre class="pygments highlight"><code class="javascript language-javascript">$(<span style="color: #003388">document</span>).ready(<span style="color: #008800; font-weight: bold">function</span>(){
  $(<span style="color: #dd2200; background-color: #fff0f0">&#39;body&#39;</span>).on(<span style="color: #dd2200; background-color: #fff0f0">&#39;dragover&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(event){
    event.stopPropagation();
    event.preventDefault();
    $(<span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>).addClass(<span style="color: #dd2200; background-color: #fff0f0">&#39;hover&#39;</span>);
  });

  $(<span style="color: #dd2200; background-color: #fff0f0">&#39;body&#39;</span>).on(<span style="color: #dd2200; background-color: #fff0f0">&#39;dragleave&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(event){
    event.stopPropagation();
    event.preventDefault();
    $(<span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>).removeClass(<span style="color: #dd2200; background-color: #fff0f0">&#39;hover&#39;</span>);
  });

  $(<span style="color: #dd2200; background-color: #fff0f0">&#39;body&#39;</span>).on(<span style="color: #dd2200; background-color: #fff0f0">&#39;drop&#39;</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>, <span style="color: #008800; font-weight: bold">function</span>(event){
    <span style="color: #008800; font-weight: bold">if</span>(event.originalEvent.dataTransfer &amp;&amp; event.originalEvent.dataTransfer.files.length &gt; <span style="color: #0000DD; font-weight: bold">0</span>) {
        event.stopPropagation();
        event.preventDefault();
        <span style="color: #008800; font-weight: bold">var</span> files = event.originalEvent.dataTransfer.files;
        MapModule.loadFiles(files);
    }
    $(<span style="color: #dd2200; background-color: #fff0f0">&#39;section:first-child&#39;</span>).removeClass(<span style="color: #dd2200; background-color: #fff0f0">&#39;hover&#39;</span>);
  });

  google.maps.event.addDomListener(<span style="color: #003388">window</span>, <span style="color: #dd2200; background-color: #fff0f0">&#39;load&#39;</span>, MapModule.install());
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">map.js</div>
<div class="content">
<pre class="pygments highlight"><code class="javascript language-javascript"><span style="color: #008800; font-weight: bold">var</span> MapModule = (<span style="color: #008800; font-weight: bold">function</span>(){
  <span style="color: #008800; font-weight: bold">var</span> heatpoints = <span style="color: #008800; font-weight: bold">new</span> google.maps.MVCArray([]);

  <span style="color: #008800; font-weight: bold">var</span> addPointToHeatmap = <span style="color: #008800; font-weight: bold">function</span>(lat, lng) {
    <span style="color: #008800; font-weight: bold">var</span> point = <span style="color: #008800; font-weight: bold">new</span> google.maps.LatLng(lat, lng);
    heatpoints.push(point);
  };

  <span style="color: #008800; font-weight: bold">var</span> processTsvFile = <span style="color: #008800; font-weight: bold">function</span>(event){
    <span style="color: #008800; font-weight: bold">var</span> tsv = event.target.result;
    tsv.split(<span style="color: #dd2200; background-color: #fff0f0">&quot;\n&quot;</span>).forEach(<span style="color: #008800; font-weight: bold">function</span>(row){
      <span style="color: #008800; font-weight: bold">var</span> columns = row.split(<span style="color: #dd2200; background-color: #fff0f0">&#39;\t&#39;</span>);
      <span style="color: #008800; font-weight: bold">var</span> lat = <span style="color: #003388">parseFloat</span>(columns[<span style="color: #0000DD; font-weight: bold">1</span>]);
      <span style="color: #008800; font-weight: bold">var</span> lng = <span style="color: #003388">parseFloat</span>(columns[<span style="color: #0000DD; font-weight: bold">2</span>]);
      addPointToHeatmap(lat, lng);
    });
  };

  <span style="color: #008800; font-weight: bold">var</span> install = <span style="color: #008800; font-weight: bold">function</span>(){
    <span style="color: #008800; font-weight: bold">var</span> mapOptions = { zoom: <span style="color: #0000DD; font-weight: bold">2</span>, center: <span style="color: #008800; font-weight: bold">new</span> google.maps.LatLng(<span style="color: #0000DD; font-weight: bold">43.354810</span>, -<span style="color: #0000DD; font-weight: bold">5.851805</span>)};
    <span style="color: #008800; font-weight: bold">var</span> map = <span style="color: #008800; font-weight: bold">new</span> google.maps.Map($(<span style="color: #dd2200; background-color: #fff0f0">&#39;.map&#39;</span>)[<span style="color: #0000DD; font-weight: bold">0</span>], mapOptions);
    <span style="color: #008800; font-weight: bold">var</span> heatmap = <span style="color: #008800; font-weight: bold">new</span> google.maps.visualization.HeatmapLayer({
      data: heatpoints
    });
    heatmap.setMap(map);
  };

  <span style="color: #008800; font-weight: bold">var</span> loadFiles = <span style="color: #008800; font-weight: bold">function</span>(files) {
    <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #008800; font-weight: bold">var</span> i = <span style="color: #0000DD; font-weight: bold">0</span>; i &lt; files.length; i++) {
      <span style="color: #008800; font-weight: bold">var</span> currentFile = files[i];
      <span style="color: #008800; font-weight: bold">var</span> reader = <span style="color: #008800; font-weight: bold">new</span> FileReader();
      reader.onload = processTsvFile;
      reader.readAsText(currentFile);
    }
  };

  <span style="color: #008800; font-weight: bold">return</span> {
    install: install,
    loadFiles: loadFiles
  };
})();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Disponible en: <a href="http://aisl.umbc.edu/resources/369.pdf">http://aisl.umbc.edu/resources/369.pdf</a> (ver tablas y ecuaciones en la página 7)
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. <strong>ana botella</strong> obtuvo una puntuación LLR de 134.13897 sobre un máximo de 175.30144
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. <a href="http://perldesignpatterns.com/?word=decorator+pattern">http://perldesignpatterns.com/?word=decorator+pattern</a>
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. <a href="http://www.saxproject.org/">http://www.saxproject.org/</a>
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. <a href="http://www.xmlpull.org/">http://www.xmlpull.org/</a>
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. <a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a>
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. <a href="http://www.butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">http://www.butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod</a>
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. Denominados <em>Dynos</em> en Heroku (<a href="https://www.heroku.com/features">https://www.heroku.com/features</a>) o <em>Gears</em> en OpenShift (<a href="https://www.openshift.com/products/pricing">https://www.openshift.com/products/pricing</a>)
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. <a href="http://martinfowler.com/bliki/TestDrivenDevelopment.html">http://martinfowler.com/bliki/TestDrivenDevelopment.html</a>
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. <a href="http://www.scalatest.org/">http://www.scalatest.org/</a>
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. <a href="https://dev.twitter.com/discussions/2752">https://dev.twitter.com/discussions/2752</a>
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. <a href="http://gnip.com/">http://gnip.com/</a>
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. <a href="http://datasift.com/">http://datasift.com/</a>
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. <a href="https://www.scrum.org/resources/what-is-scrum/">https://www.scrum.org/resources/what-is-scrum/</a>
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. <a href="http://daringfireball.net/projects/markdown/">http://daringfireball.net/projects/markdown/</a>
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. <a href="http://guardgem.org/">http://guardgem.org/</a> - gema de Ruby para detectar cambios en ficheros de un directorio
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. <a href="http://www.docbook.org/whatis">http://www.docbook.org/whatis</a>
</div>
<div class="footnote" id="_footnote_18">
<a href="#_footnoteref_18">18</a>. <a href="http://hunch.net/~vw/">http://hunch.net/~vw/</a>
</div>
<div class="footnote" id="_footnote_19">
<a href="#_footnoteref_19">19</a>. <a href="https://dev.twitter.com/docs/api/streaming">https://dev.twitter.com/docs/api/streaming</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-06-29 19:16:46 CEST
</div>
</div>
</body>
</html>